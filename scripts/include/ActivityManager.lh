---------------------------------------------------------------------->
-- 脚本名称:	scripts/Include/ActivityManager.lh
-- 更新时间:	2017/5/2 16:39:32
-- 更新用户:	qingfupei
-- 脚本说明:
----------------------------------------------------------------------<

-- 必须 Include 这个头文件
-- 此文件的Include文件都只能在ActivityMangerInclude.lh文件中Include
Include("scripts/Include/ActivityMangerInclude.lh")

-- -------------------------------------------------------------------------------------
-- 下面是编号分配或者数据定义
-- -------------------------------------------------------------------------------------

ACTIVITY_MANAGER = {ConvertProxiedTable = ConvertProxiedTable,
	TONG_POPULATION = {0, 0}, -- 帮会满级人数数量活动 2009.09.08
	TONG_EQUIPMENT = {1, 1}, -- 帮会成员装备比拼活动 2009.09.08
	REMEDY_MIDAUT_ACT = {2, 2}, -- 中秋节活动BUG矫正	2009.09.29
	NONLICET_HEART = {3, 3}, -- 非法的增加修为		2009.10.12
	COMPENSATE_MAJU = {4, 4}, -- 补偿更新时堆叠的马具丢失 2009.11.19
	DONGZHI_BUG_PUNISH = {5, 5}, -- 冬至节刷钱BUG处理	2009.12.22
	DONGZHI_MALAIXIYA_SHENGWANG = {6, 6}, -- 冬至马来西亚刷声望处理 2010.01.24
	CANGJIAN_XIUWEI_SONG = {7, 7}, -- 藏剑补偿赠送修为处理 2010.05.24
	CANGJIAN_XIUWEI_SECOND = {8, 8}, -- 藏剑补偿赠送修为二期处理 2010.06.13
	SHITU_CHUSHIBUCHANG_BAICAOYUAN = {9, 9}, -- 百草园导致的师徒出师金钱补偿 2010.06.28
	CHONGZHI_SONGGUANJIANMAJU = {10, 10}, --充值赠送活动补偿 2010.08.30
	CHONGZHI_CHUNJIEHUODONG = {11, 11}, --充值赠送活动春节补偿包包不足导致的添加失败 2011,1,25
	SHUJIKOUCUODAOJU_BUCHANG = {12, 12}, --转换书籍ID扣错道具的补偿 2011,1,26
	LEITAISAIJIANGLI = {13, 13}, --擂台赛奖励2011.2.24
	CHUNJIEHUOBIBUCHANG = {14, 14}, -- 春节活动提前消失的货币补偿 2012,2,18
	DHBUG_DEL175WEAPON = {15, 15}, -- 荻花刷箱子bug处理:删除175武器2011.2.24-2013.2.24
	DHBUG_DELMOSHIANQI = {16, 16}, -- 荻花刷箱子bug处理:删除磨石和暗器，并算钱。2011.2.24-2013.2.24
	LEITAISAIJIANGLI_GUANJUN = {17, 17}, --擂台赛奖励2011.2.24
	DHBUG_DELMOSHIANQI_2 = {18, 18}, -- 荻花刷箱子bug处理:删除磨石和暗器，并算钱。第二批。2011.2.24-2013.2.24
	DHBUG_DEL175WEAPON_2 = {19, 19}, -- 荻花刷箱子bug处理:删除175武器2011.2.24-2013.2.24
	TONG_GOLDACHIEVEMENT = {20, 20}, -- 帮会捐钱成就补偿：2011.3.31-2011.5.16
	TONG_GOLDACHIEVEMENT_2 = {21, 21}, -- 帮会捐钱成就二次补偿：2011.4.14-2011.5.16
	SERVER_RECYCLE_WEAPON_1 = {22, 22}, -- 血龙出渊、太极广场服务器回档武器回档：2011.5.13-2011.6.13
	SERVER_RECYCLE_ARMOR_7_1 = {23, 23}, -- 血龙出渊、太极广场服务器回档装备回档：2011.5.13-2011.6.13
	SERVER_RECYCLE_ARMOR_8_1 = {24, 24}, -- 血龙出渊、太极广场服务器回档饰品回档：2011.5.13-2011.6.13
	SERVER_RECYCLE_ITEM_5 = {25, 25}, -- 血龙出渊、太极广场服务器回档物品补偿：2011.5.19-2011.6.13
	SERVER_RECYCLE_MIJI_5_1 = {26, 26}, -- 血龙出渊、太极广场服务器回档秘籍补偿：2011.5.19-2011.6.13
	SERVER_RECYCLE_MIJI_5_2 = {27, 27}, -- 血龙出渊、太极广场服务器回档秘籍补偿：2011.5.19-2011.6.13
	SERVER_RECYCLE_MIJI_5_3 = {28, 28}, -- 血龙出渊、太极广场服务器回档秘籍补偿：2011.5.19-2011.6.13
	SERVER_RECYCLE_MIJI_5_4 = {29, 29}, -- 血龙出渊、太极广场服务器回档秘籍补偿：2011.5.19-2011.6.13
	SERVER_RECYCLE_MIJI_5_5 = {30, 30}, -- 血龙出渊、太极广场服务器回档秘籍补偿：2011.5.19-2011.6.13
	SERVER_RECYCLE_MIJI_5_6 = {31, 31}, -- 血龙出渊、太极广场服务器回档秘籍补偿：2011.5.19-2011.6.13
	SERVER_RECYCLE_MIJI_5_7 = {32, 32}, -- 血龙出渊、太极广场服务器回档秘籍补偿：2011.5.19-2011.6.13
	SERVER_RECYCLE_MIJI_5_8 = {33, 33}, -- 血龙出渊、太极广场服务器回档秘籍补偿：2011.5.19-2011.6.13
	SERVER_RECYCLE_MIJI_5_9 = {34, 34}, -- 血龙出渊、太极广场服务器回档秘籍补偿：2011.5.19-2011.6.13
	SERVER_RECYCLE_MIJI_5_10 = {35, 35}, -- 血龙出渊、太极广场服务器回档秘籍补偿：2011.5.19-2011.6.13
	BASHU_DROP_ERROR = {36, 36}, -- 巴蜀掉落异常回收处理：2011.5.23-2011.11.23
	SERVER_RECYCLE_2011_6_3 = {37, 37}, -- 2011.6.3日服务器回档，补偿寄售通宝的金钱。
	SERVEROFBEAUTY_2011_7_29 = {38, 38}, -- 2011.7.26日美女服道具。截止9.26日。
	LEITAISAIJIANGLI_2 = {39, 39}, -- 2011.8.10日发送第二届跨服擂台赛冠亚季军奖励。截止2011.10.8日。
	TONG_PERSONAL_GMAE_20110815 = {40, 40}, -- 帮会个人擂台赛八月赛季补偿。
	TONGBAO_RECYCLE_20110915 = {41, 41}, -- 2011.09.15回档通宝金钱处理
	TONGBAO_CUT_20110915 = {42, 42}, -- 2011.09.15回档通宝金钱处理，扣金币
	TONGBAO_RECYCLE_20110916 = {43, 43}, -- 2011.09.16通宝后续处理，加金币 * 2
	TONGBAO_CUT_20110916 = {44, 44}, -- 2011.09.16通宝后续处理，扣金币 * 2
	TONGBAO_RECYCLE_20110920 = {45, 45}, -- 2011.09.20通宝后续处理，第三弹
	TONGBAO_CUT_20110920 = {46, 46}, -- 2011.09.20通宝后续处理，第三弹
	ZHANJIE_PUNISH_20110921 = {47, 47}, -- 2011.09.21战阶处罚
	PRESTIGE_ARMOR_TAIWAN = {48, 48}, -- 2011.11.14台湾版本威望装价格不等
	PRESTIGE_ARMOR_2011_11_22 = {49, 49}, -- 2011.11.22同品装备兑换纯阳255品装备兑换与结果不一致补偿
	MALAYSIA_REWARD_20111124 = {50, 50}, -- 2011.11.24马来友人合服补偿
	KOR_CBT_REWARD_20111222 = {51, 51}, -- 2011.12.22台湾版CBT活动称号奖励
	BSFY_TitleRank_20120112 = {52, 52}, -- 2012.1.12 国内版流失老玩家战阶加速处理
	TONGBAO_RECYCLE_20120117 = {53, 53}, -- 2012.01.17回档通宝金钱处理，加金币
	TONGBAO_CUT_20120117 = {54, 54}, -- 2011.01.17回档通宝金钱处理，扣金币
	FENGGUBADAO_20120209 = {55, 55}, -- 2012.02.09送风骨霸刀
	CHUNJIE_ZHONGJIANG_20120211 = {56, 56}, -- 2012.02.11补偿重奖年后迎归客
	CHUNJIE_HAISHISHANMENG_20120211 = {57, 57}, -- 2012.02.13补偿海誓山盟
	BSFY_JJC_20120227 = {58, 58}, -- 2012.2.27 国内版更新名剑大会组队规则BUG补偿处理
	YYL_SERVER_20120529 = {59, 59}, -- 2012.5.29 忆盈楼补偿
	BACK_ACCOUNT_20120910 = {60, 60}, -- 2012.09.10回归账号补偿
	GEC_RESEARCH_20120917 = {61, 61}, -- 2012.09.17调研奖励发送
	GEC_RESEARCH_20120918 = {62, 62}, -- 2012.09.18调研奖励发送
	--JJC_REWARD_2V2_20121129 = {63, 63}, -- 2012.11.29竞技场奖励发送
	--JJC_REWARD_3V3_20121129 = {64, 64}, -- 2012.11.29竞技场奖励发送
	--JJC_REWARD_5V5_20121129 = {65, 65}, -- 2012.11.29竞技场奖励发送
	ACTIVITY_REDEEM_20121129 = {66, 66}, -- 明教预热活动补偿
	JJC_PUNISHMENT_20121218 = {67, 67}, -- 竞技场恶性代打惩罚
	JJC_PUNISHMENT_20130130 = {68, 68}, -- 竞技场恶性代打惩罚_二期
	JJC_REWARD_TW2V2_20130219 = {69, 69}, -- 台湾版竞技场奖励发送
	JJC_REWARD_TW3V3_20130219 = {70, 70}, -- 台湾版竞技场奖励发送
	JJC_REWARD_TW5V5_20130219 = {71, 71}, -- 台湾版竞技场奖励发送
	JJC_PUNISHMENT_20130322 = {72, 72}, -- 2013年3月竞技场恶性代打惩罚
	JJC_PUNISHMENT_20130325 = {73, 73}, -- 2013年3月竞技场恶性代打惩罚
	JJC_PUNISHMENT_20130423 = {74, 74}, -- 2013年4月竞技场恶性代打惩罚
	JJC_PUNISHMENT_20130424 = {75, 75}, -- 2013年4月竞技场恶性代打惩罚
	WAIGUAN_REDEEM_20130609 = {76, 76}, -- 外观相关补偿
	CODE_ITEM_20130607 = {77, 77}, -- 充值促销激活码BUG补偿
	DMG_WEAPON_20130618 = {78, 78}, -- 2013年6月大明宫装备回收
	TITLE_POINT_PUNISH_20130625 = {79, 79}, -- 2013年6月刷战阶惩罚
--	JJC_REWARD_2V2_20130701 = {80, 80}, -- 2013.7.1竞技场奖励发送,废弃可复用
--	JJC_REWARD_3V3_20130701 = {81, 81}, -- 2013.7.1竞技场奖励发送,废弃可复用
--	JJC_REWARD_5V5_20130701 = {82, 82}, -- 2013.7.1竞技场奖励发送,废弃可复用
	QiXUE_SKILL_20130625 = {83, 83}, -- 20130625 奇穴技能处理
	COLORDIAMOND_RETRIEVE_20130715 = {84, 84}, -- 吸蓝五彩石第一次回收补偿
	ACT_TRAILVALLY_CLEARDATA_20130729 = {85, 85}, -- 20130729试炼之地清除作弊者数据
	ARENAAWARD_BUG_20130729 = {86, 86}, -- 刷名剑币BUG第一次回收处理
	XUANLONGSHI_20130726 = {87, 87}, -- 2013年7月玄龙石金币补偿
	XUANLONGSHI_DEL_20130729 = {88, 88}, -- 2013年7月玄龙石扣金币
	XUANLONGSHI_ADD_20130729 = {89, 89}, -- 2013年7月玄龙石发金币
	JJC_PUNISHMENT_1_20130729 = {90, 90}, -- 2013年7月竞技场恶性代打惩罚
	JJC_PUNISHMENT_2_20130729 = {91, 91}, -- 2013年7月竞技场恶性代打惩罚
	JJC_PUNISHMENT_3_20130729 = {92, 92}, -- 2013年7月竞技场恶性代打惩罚
	JJC_PUNISHMENT_4_20130729 = {93, 93}, -- 2013年7月竞技场恶性代打惩罚
	JJC_PUNISHMENT_20130916 = {94, 94}, -- 2013年9月竞技场恶性代打惩罚
	BANGHUIZIJIN_20130916 = {95, 95}, -- 2013.9.16涅分支BUG帮会资金补偿
	--JJC_PUNISHMENT_20131016 = {96, 96}, -- 2013年10月竞技场恶性代打惩罚
	--JJC_PUNISHMENT_20131212 = {97, 97}, -- 2013年12月竞技场恶性代打惩罚
	XIAOAOJIANGHULU_20140120 = {98, 98}, -- 2014年1月重复刷笑傲江湖路惩罚
	JJC_PUNISHMENT_20140220 = {99, 99}, -- 2014年2月竞技场恶性代打惩罚
	JJC_REWARD_2V2_20140428 = {100, 100}, -- 2014.4.28竞技场奖励发送
	JJC_REWARD_3V3_20140428 = {101, 101}, -- 2014.4.28竞技场奖励发送
	JJC_REWARD_5V5_20140428 = {102, 102}, -- 2014.4.28竞技场奖励发送
	JJC_REPAIR_2V2_20140428 = {103, 103}, -- 2014.4.28竞技场赛季前200的漏发、改名、转服的补发奖励
	JJC_REPAIR_3V3_20140428 = {104, 104}, -- 2014.4.28竞技场赛季前200的漏发、改名、转服的补发奖励
	JJC_REPAIR_5V5_20140428 = {105, 105}, -- 2014.4.28竞技场赛季前200的漏发、改名、转服的补发奖励
	JJC_PUNISHMENT_20140616 = {106, 106}, -- 2014年6月竞技场恶性代打惩罚
	JJC_PUNISHMENT_20140630 = {107, 107}, -- 2014年6月竞技场恶性代打惩罚第二次处理
	JJC_PUNISHEMNT_20140801 = {108, 108}, -- 2014年7月竞技场恶性代打惩罚处理
	QiXi_REWARD_201408014 = {109, 109}, -- 2014年8月18日七夕礼物补偿-9月18日
	QiXi_REWARD_20140821 = {110, 110}, -- 2014年8月21日七夕礼物补偿-9月21日
	JJC_PUNISHEMNT_20140901 = {111, 111}, -- 2014年8月竞技场恶性代打惩罚处理
	JJC_PUNISHEMNT_20140929 = {112, 112}, -- 2014年9月竞技场恶性代打惩罚处理
	COMPENSATE_20141013 = {113, 113}, -- 2014年9月21日外装调查问卷漏发奖励补偿
	JJC_REWARD_2V2_20141202 = {114, 114}, -- 20141202竞技场奖励发送
	JJC_REWARD_3V3_20141202 = {115, 115}, -- 20141202竞技场奖励发送
	JJC_REWARD_5V5_20141202 = {116, 116}, -- 20141202竞技场奖励发送
	JJC_PUNISHEMNT_20141223 = {117, 117}, -- 2014年12月竞技场恶性代打惩罚处理
	JJC_PUNISHEMNT_20150107 = {118, 118}, -- 2015年1月竞技场恶性代打惩罚缘定三生服务器遗漏问题
	JJC_PUNISHEMNT_20150108 = {119, 119}, -- 2015年1月竞技场恶性代打惩罚缘定三生服务器遗漏问题
	JJC_REWARD_3V3_20150420 = {120, 120}, -- 20150420竞技场奖励发送
	JJC_REWARD_5V5_20150420 = {121, 121}, -- 20150420竞技场奖励发送
	GARAGEKITS_20150512 = {122, 122}, -- 20150512手办消失补偿表一部分
	DUNGEONTITLE_20150521 = {123, 123}, -- 20150521挑战副本竞速称号发放
	JJC_PUNISHMENT_20150615 = {124, 124}, -- 2015年5月竞技场恶性代打惩罚
	JJC_PUNISHMENT_20150716 = {125, 125}, -- 2015年6月竞技场恶性代打惩罚
	ZHONGQIU_YANHUA_20150928 = {126, 126}, -- 2015年中秋节补偿玩家的烟花和宴席
	ZHONGQIU_YANHUA_20150928_1 = {127, 127}, -- 2015年中秋节补偿玩家的烟花和宴席
	ZHONGQIU_YANHUA_20151006 = {128, 128}, -- 2015年中秋节补偿玩家的烟花和宴席
	ZHONGQIU_YANHUA_20151006_1 = {129, 129}, -- 2015年中秋节补偿玩家的烟花和宴席
	ZHONGQIU_YANHUA_20151018 = {130, 130}, -- 2015年中秋节补偿玩家的烟花
	ZHONGQIU_YANHUA_20151023 = {131, 131}, -- 2015年中秋节补偿玩家的烟花
	JJC_REWARD_3V3_20151102 = {132, 132}, -- 20151102竞技场奖励发送
	JJC_REWARD_5V5_20151102 = {133, 133}, -- 20151102竞技场奖励发送
	JJC_REWARD_3V3_20151221 = {134, 134}, -- 20151221台湾3V3竞技场奖励发送
	JJC_REWARD_5V5_20151221 = {135, 135}, -- 20151221台湾5V5竞技场奖励发送
	TW_GZ_Compensate_20160307 = {136, 136}, -- 20160307台湾共战BUFF补偿
	JJC_PUNISHMENT_20160301 = {137, 137}, -- 2016年2月竞技场恶性代打惩罚
	JINGUZHOU_GUAJIA_20160303 = {138, 138}, -- 20160303紧箍咒道具替换
	JINGUZHOU_NEW_20160317 = {139, 139}, -- 20160317紧箍咒道具替换新增
	NIANPO_20160624 = {140, 140}, -- 念破挂机惩罚
	JJC_REWARD_2V2_20161027 = {141, 141}, -- 20161027竞技场奖励发送
	JJC_REWARD_3V3_20161027 = {142, 142}, -- 20161027竞技场奖励发送
	JJC_REWARD_5V5_20161027 = {143, 143}, -- 20161027竞技场奖励发送
	JJC_GUAJIANCOMPENSATE_20161027 = {144, 144}, -- 20161027竞技场发放挂件反了的更正
	JJC_REPAIR_2V2_20161027 = {145, 145}, -- 20161027竞技场赛季前200的漏发、改名、转服的补发奖励
	JJC_REPAIR_3V3_20161027 = {146, 146}, -- 20161027竞技场赛季前200的漏发、改名、转服的补发奖励
	JJC_REPAIR_5V5_20161027 = {147, 147}, -- 20161027竞技场赛季前200的漏发、改名、转服的补发奖励
	SHOP_REPAIR_20161208 = {148, 148}, --20161027商店价格异常补发金币
	JDZD_REPAIR_20161214 = {149, 149}, --20161214据点争夺恶人老谢的注视无法删除补偿
	JDZD_REPAIR_20170106 = {150, 150}, --20170106大攻防直接添加3次凝视被踢出地图的补偿
	JDZD_REPAIR_20170112 = {151, 151}, --20170112大攻防直接添加3次凝视被踢出地图的补偿
	JJC_MJB_COST_20170428 = {152, 152}, --透支名剑币
	JJC_REWARD_2V2_20170504 = {153, 153}, -- 20170504竞技场赛季前200发奖 2V2
	JJC_REWARD_3V3_20170504 = {154, 154}, -- 20170504竞技场赛季前200发奖 3V3
	JJC_REWARD_5V5_20170504 = {155, 155}, -- 20170504竞技场赛季前200发奖 5V5
	JJC_MACROS_PUNISHMENT_20170504 = {156, 156}, -- 2017年第八赛季第二次非法宏与外挂封停计划
	JJC_MJB_COST_RETRUN_20170505 = {157, 157}, -- 名剑币扣除回滚
	JJC_REWARD_2V2_20170508 = {158, 158}, -- 20170504竞技场赛季前200发奖 2V2	补发异常漏掉的
	JJC_REWARD_3V3_20170508 = {159, 159}, -- 20170504竞技场赛季前200发奖 3V3	补发异常漏掉的
	JJC_REWARD_5V5_20170508 = {160, 160}, -- 20170504竞技场赛季前200发奖 5V5	补发异常漏掉的

};ACTIVITY_MANAGER = ACTIVITY_MANAGER:ConvertProxiedTable()

tActivityDate = {}
tActivityRecall = {}

-- -------------------------------------------------------------------------------------
-- 下面是一些功能函数
-- -------------------------------------------------------------------------------------
function ActivityRosterCheckRequest(player, tActivityIndexList, nRecallID, bDelRecord, bNotReturn)
	-- bNotReturn：如果有这个标记为true则只向center发远程调用清空活动表，不返回server做其他处理
	if not player then
		return
	end
	RemoteCallToCenter("OnActivityRosterCheckRequest", player.dwID, player.szName, tActivityIndexList, nRecallID, bDelRecord, bNotReturn)
end

function GetActivityTimes(nActivityIndex)
	local tDates = tActivityDate[nActivityIndex]
	if not tDates then
		return
	end
	local tActivityTimes = {}
	tActivityTimes.nCurrentTime = GetCurrentTime()
	if tDates.Start then
		tActivityTimes.nStartTime = DateToTime(tDates.Start.nYear, tDates.Start.nMonth, tDates.Start.nDay, tDates.Start.nHour, tDates.Start.nMin, tDates.Start.nSecond)
	end
	if tDates.End then
		tActivityTimes.nEndTime = DateToTime(tDates.End.nYear, tDates.End.nMonth, tDates.End.nDay, tDates.End.nHour, tDates.End.nMin, tDates.End.nSecond)
	end
	if tDates.AwardStart then
		tActivityTimes.nAwardStartTime = DateToTime(tDates.AwardStart.nYear, tDates.AwardStart.nMonth, tDates.AwardStart.nDay, tDates.AwardStart.nHour, tDates.AwardStart.nMin, tDates.AwardStart.nSecond)
	end
	if tDates.AwardEnd then
		tActivityTimes.nAwardEndTime = DateToTime(tDates.AwardEnd.nYear, tDates.AwardEnd.nMonth, tDates.AwardEnd.nDay, tDates.AwardEnd.nHour, tDates.AwardEnd.nMin, tDates.AwardEnd.nSecond)
	end
	return tActivityTimes
end

-- -------------------------------------------------------------------------------------
-- 下面接口中, nType 为 ACTIVITY_MANAGER 的值, nIndex 取值为 0~5 , 对应表中的 Value0 ~ Value5
--	x = GetActivityManager()
--	x.Add(dwPlayerID, nType, nTime)
--	x.Del(dwPlayerID, nType)
--	x.Get(dwPlayerID, nType, nIndex)
--	x.Set(dwPlayerID, nType, nIndex, nValue)

-- 下面接口判断玩家帮会以及增加贡献度
--	Center:Role.dwTongID ~= 0
--	Server:player.dwTongID ~= 0
--	Server:player.AddContribution(3000, "OTHER")
-- -------------------------------------------------------------------------------------
-- 下面是实际的内容部分
-- -------------------------------------------------------------------------------------

-- 函数入口（玩家登陆时调用）
function ActivityManager_Funcs(player)
	-- JJC_Punishment_20130322(player)		-- 2013年3月竞技场恶性代打惩罚
	-- JJC_Punishment_20130423(player)		-- 2013年4月竞技场恶性代打惩罚
	-- WaiGuan_Redeem_20130309(player)		-- 2013年3月外观补偿
	-- DMG_Weapon_20130618(player)		-- 2013年6月大明宫装备回收
	QiXueSkill_20130625(player)		-- 2013年6月安史之乱奇穴技能处理
	-- XuanLongShi_20130726(player)		-- 2013年7月玄龙石金币补偿
	-- XuanLongShi_20130729(player)		-- 2013年7月玄龙石金币处理
	-- JJC_Punishment_20130729(player)		-- 2013年7月竞技场恶性代打惩罚
	-- JJC_Punishment_20130916(player)		-- 2013年9月竞技场恶性代打惩罚
	--JJC_Punishment_20131016(player)		-- 2013年10月竞技场恶性代打惩罚
	--JJC_Punishment_20131212(player)		-- 2013年12月竞技场恶性代打惩罚
	--XIAOAOJIANGHULU_20140120(player)	-- 2014年1月重复刷笑傲江湖路惩罚
	--JJC_Punishment_20140220(player)		-- 2014年2月竞技场恶性代打惩罚
	--JJC_Reward_20140428(player)			-- 2014年4月21赛季排名前200的结算奖励
	--JJC_Repair_20140428(player)			-- 2014年4月21赛季排名前200的漏发、改名、转服的补发奖励
	--JJC_Punishment_20140616(player)		-- 2014年6月竞技场恶性代打惩罚
	--JJC_Punishment_20140630(player)		-- 2014年6月竞技场恶性代打惩罚第二次处理
	--JJC_Punishment_20140801(player)		-- 2014年7月竞技场恶性代打惩罚
	--QiXi_reward_201408014(player)-- 2014年8月18日七夕礼物补偿--2014年9月18日
	--QiXi_reward_20140821(player)-- 2014年8月21日七夕礼物补偿--2014年9月21日
	--JJC_Punishment_20140901(player)		-- 2014年8月竞技场恶性代打惩罚
	--JJC_Punishment_20140929(player)		-- 2014年8月竞技场恶性代打惩罚
	--Compensate_20141013(player)		-- 2014年9月21日外装调查问卷漏发奖励补偿
	--JJC_Reward_20141202(player)	-- 2014年12月竞技场赛季奖励
	--JJC_Punishment_20141223(player)	-- 2014年12月竞技场恶性代打惩罚
	--JJC_Punishment_20150107(player)	-- 2015年1月缘定三生服务器竞技场恶性代打惩罚
	--JJC_Reward_20150420(player)	-- 2015年4月竞技场赛季奖励
	--GarageKits_20150512(player)	-- 2015年5月手办消失补偿
	--DungeonTitle_20150521(player)	-- 2015年5月挑战本竞速称号发放
	--JJC_Punishment_20150615(player)   --2015年5月竞技场代打装备回收
	--JJC_Punishment_20150716(player)   --2015年6月竞技场代打装备回收
	--ZHONGQIU_Yanhua_20150928(player) -- 2015年中秋节补偿玩家的烟花和宴席
	--ZHONGQIU_Yanhua_20150928_1(player) -- 2015年中秋节补偿玩家的烟花和宴席

	--ZHONGQIU_YANHUA_20151006(player)
	--ZHONGQIU_YANHUA_20151006_1(player)
	--ZHONGQIU_YANHUA_20151018(player) -- 2015年中秋节补偿玩家的烟花和宴席
	--ZHONGQIU_YANHUA_20151023(player) -- 2015年中秋节补偿玩家的烟花和宴席
	--JJC_Reward_20151102(player)	-- 2015年11月竞技场赛季奖励
	--JJC_Reward_20151221(player)	-- 2015年12月台湾竞技场赛季奖励
	--TW_GongZhan_Compensate_20160307(player) -- 20160307台湾共战BUFF补偿
	--JJC_Punishment_20160201(player)  --2016年2月竞技场代打装备回收
	--GUAJIAN_JINGUZHOU_20160303(player)  --20160303紧箍咒处理
	--NEW_JINGUZHOU_20160317(player)  --20160317紧箍咒处理
	--NianPo20160624(player)	-- 念破挂机处理
	--JJC_Reward_20161027(player) --2016年10月竞技场赛季奖励
	--JJC_GUAJIANCOMPENSATE_20161027(player) -- 20161027竞技场发放挂件反了的更正
	--JJC_Repair_20161027(player) -- 20161027竞技场赛季前200的漏发、改名、转服的补发奖励
	--Shop_Repair_20161208(player) --20161208商店价格补偿
	--JDZD_REPAIR_20161214(player) -- 20161214据点争夺恶人老谢的注视无法删除补偿
	--JDZD_REPAIR_20170106(player) -- 20170106大攻防直接添加3次凝视被踢出地图的补偿
	--JDZD_REPAIR_20170112(player) -- 20170112大攻防直接添加3次凝视被踢出地图的补偿
	JJC_Reward_20170504(player) --2017年4月竞技场赛季奖励
	JJC_Macros_Punishment_20170504(player) -- 2017年第八赛季第二次非法宏与外挂封停计划
--	JJC_MJB_COST_20170428(player)
	JJC_MJB_COST_RETRUN_20170505(player) --名剑币扣除回滚
	JJC_Repair_20170508(player) --2017年4月竞技场赛季奖励 补发漏掉的
end

-- 函数入口（加载玩家角色数据之前调用）
function ActivityManager_PreLoad_Funcs(dwPlayerID)
	-- 注意，此时用dwPlayerID是取不到player的
	-- 2013年6月刷战阶惩罚
	-- TITLE_POINT_PUNISH_20130625(dwPlayerID)
end
--[[
tActivityDate[ACTIVITY_MANAGER.TONG_POPULATION] = {
	Start = {	nYear = 2009, nMonth = 9, nDay = 10, nHour = 7, nMin = 0, nSecond = 0, },
	End = {	nYear = 2009, nMonth = 9, nDay = 29, nHour = 7, nMin = 0, nSecond = 0, },
	AwardStart = {	nYear = 2009, nMonth = 9, nDay = 29, nHour = 8, nMin = 0, nSecond = 0, },
	AwardEnd = {	nYear = 2009, nMonth = 10, nDay = 29, nHour = 8, nMin = 0, nSecond = 0, },
}
-- 20090909 用来在活动期间奖励加入帮会或者上线后已经在帮会的玩家
function DoActivityReward_JoinTong_20090909(player)
	if not player or player.dwTongID == 0 then
		return
	end

	local nLevel = player.nLevel
	local nMinLevel = 20
	local nPresetFlag = 10
	local tReward = {8, 4035}
	local nPhase1Index = player.GetCustomInteger1(PLAYER_CUSTOM_VALUE.TONG_JOIN_FLAG)
	local tActivityTimes = GetActivityTimes(ACTIVITY_MANAGER.TONG_POPULATION)

	if nPhase1Index ~= nPresetFlag and tActivityTimes.nCurrentTime >= tActivityTimes.nStartTime and tActivityTimes.nCurrentTime <= tActivityTimes.nEndTime then
		if nLevel >= nMinLevel then
			player.SetCustomInteger1(PLAYER_CUSTOM_VALUE.TONG_JOIN_FLAG, nPresetFlag)
			Log(("[Activity #%d] %s (%d) Got item [%d, %d]."):format(ACTIVITY_MANAGER.TONG_POPULATION, player.szName, player.dwID, tReward[1], tReward[2]))
			SendSystemMail(GLOBAL_STRING_TABLE.ACTIVITY_MANAGER_STRING.JOINTONG_20090909.SENDER,
				player.szName,
				GLOBAL_STRING_TABLE.ACTIVITY_MANAGER_STRING.JOINTONG_20090909.TITLE,
				GLOBAL_STRING_TABLE.ACTIVITY_MANAGER_STRING.JOINTONG_20090909.CONTENT:format(player.szName),
			0, tReward[1], tReward[2], 1)
		end
	end
end

-- 20090909 帮会相关活动的处理, 这个函数在加入帮会和上线的时候都无条件调用
function DoActivityReward_StatTong_20090909(player)
	if not player then
		return
	end
	local tActivityTimes = GetActivityTimes(ACTIVITY_MANAGER.TONG_POPULATION)
	if tActivityTimes.nCurrentTime >= tActivityTimes.nAwardStartTime and tActivityTimes.nCurrentTime <= tActivityTimes.nAwardEndTime then
		tActivityIndexList = {ACTIVITY_MANAGER.TONG_POPULATION, ACTIVITY_MANAGER.TONG_EQUIPMENT}
		ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.TONG_POPULATION, true)
	end
end

-- 这里是收到服务器验证后将结果返回回来, 结果用来判断这次的帮会活动给什么奖励
tActivityRecall[ACTIVITY_MANAGER.TONG_POPULATION] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	if tActivityRosterList[ACTIVITY_MANAGER.TONG_POPULATION] then
		local nTongPlayerCountLevel = tActivityRosterList[ACTIVITY_MANAGER.TONG_POPULATION][0]
		local tTongPlayerCountReward = {[0] = 4895, [1] = 4896, [2] = 4892, [3] = 4894}		-- 帮会高级玩家数量奖励
		if nTongPlayerCountLevel and tTongPlayerCountReward[nTongPlayerCountLevel] then
			SendSystemMail(GLOBAL_STRING_TABLE.ACTIVITY_MANAGER_STRING.TONG_POPULATION_20090909.SENDER,
				szPlayerName,
				GLOBAL_STRING_TABLE.ACTIVITY_MANAGER_STRING.TONG_POPULATION_20090909.TITLE,
				GLOBAL_STRING_TABLE.ACTIVITY_MANAGER_STRING.TONG_POPULATION_20090909.CONTENT:format(szPlayerName),
			0, ITEM_TABLE_TYPE.OTHER, tTongPlayerCountReward[nTongPlayerCountLevel], 1)
			Log(("[Activity #%d] %s (%d) Got Reward : [%d, %d]."):format(ACTIVITY_MANAGER.TONG_POPULATION, szPlayerName, dwPlayerID, ITEM_TABLE_TYPE.OTHER, tTongPlayerCountReward[nTongPlayerCountLevel]))
		else
			Log(("[Activity #%d] %s (%d) Fail to get Reward by reward-level : [%d]."):format(ACTIVITY_MANAGER.TONG_POPULATION, szPlayerName, dwPlayerID, nTongPlayerCountLevel))
		end
	end

	if tActivityRosterList[ACTIVITY_MANAGER.TONG_EQUIPMENT] then
		local nTongEquipScoreLevel = tActivityRosterList[ACTIVITY_MANAGER.TONG_EQUIPMENT][0]
		local bTongEquipScoreMaster = tActivityRosterList[ACTIVITY_MANAGER.TONG_EQUIPMENT][1]
		local tTongEquipScoreReward = {														-- 帮会装备品质排名奖励
			[0] = {[0] = 4883, [1] = 4867, [2] = 4871, [3] = 4872, [4] = 4873},
			[1] = {[0] = 4889, [1] = 4890, [2] = 4871, [3] = 4872, [4] = 4873},
		}
		if nTongEquipScoreLevel and tTongEquipScoreReward[bTongEquipScoreMaster] and tTongEquipScoreReward[bTongEquipScoreMaster][nTongEquipScoreLevel] then
			SendSystemMail(GLOBAL_STRING_TABLE.ACTIVITY_MANAGER_STRING.TONG_EQUIPMENT_20090909.SENDER,
				szPlayerName,
				GLOBAL_STRING_TABLE.ACTIVITY_MANAGER_STRING.TONG_EQUIPMENT_20090909.TITLE,
				GLOBAL_STRING_TABLE.ACTIVITY_MANAGER_STRING.TONG_EQUIPMENT_20090909.CONTENT:format(szPlayerName),
			0, ITEM_TABLE_TYPE.OTHER, tTongEquipScoreReward[bTongEquipScoreMaster][nTongEquipScoreLevel], 1)
			Log(("[Activity #%d] %s (%d) Got Reward : [%d, %d]."):format(ACTIVITY_MANAGER.TONG_EQUIPMENT, szPlayerName, dwPlayerID, ITEM_TABLE_TYPE.OTHER, tTongEquipScoreReward[bTongEquipScoreMaster][nTongEquipScoreLevel]))
		else
			Log(("[Activity #%d] %s (%d) Fail to get Reward by reward-level : [%d, %d]."):format(ACTIVITY_MANAGER.TONG_EQUIPMENT, szPlayerName, dwPlayerID, nTongEquipScoreLevel, bTongEquipScoreMaster))
		end
	end
end

-- 20090929 中秋活动BUG的校正, 玩家上线时向GameCenter请求数据
function DoRemedyMidAutumnAction_20090929(player)
	if not player then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.REMEDY_MIDAUT_ACT}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.REMEDY_MIDAUT_ACT, true)
end

tActivityRecall[ACTIVITY_MANAGER.REMEDY_MIDAUT_ACT] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	if tActivityRosterList[ACTIVITY_MANAGER.REMEDY_MIDAUT_ACT] then
		local nCostShuangHuangMoonCakeCount = tActivityRosterList[ACTIVITY_MANAGER.REMEDY_MIDAUT_ACT][0]
		local nCostHongDouMoonCakeCount = tActivityRosterList[ACTIVITY_MANAGER.REMEDY_MIDAUT_ACT][1]
		local nCostClearGlazeCount = tActivityRosterList[ACTIVITY_MANAGER.REMEDY_MIDAUT_ACT][2]

		local player = GetPlayer(dwPlayerID)
		if not player then
			Log("RemedyMidAutumnAction failed, can't get player: "..dwPlayerID.." "..szPlayerName)
			return
		end

		player.CostItemInAllPackage(5, 4925, nCostShuangHuangMoonCakeCount)	-- 双黄月饼
		player.CostItemInAllPackage(5, 4929, nCostHongDouMoonCakeCount)		-- 红豆月饼
		player.CostItemInAllPackage(5, 4841, nCostClearGlazeCount)			-- 净琉璃

		player.AddBuff(0, 99, 1427, 1) -- 可恶的投机者

		Log("RemedyMidAutumnAction player: "..dwPlayerID.." "..szPlayerName.." 双黄: "..nCostShuangHuangMoonCakeCount.." 红豆: "..nCostHongDouMoonCakeCount.." 净琉璃: "..nCostClearGlazeCount)
	end
end

-- 非法的增加修为		2009.10.12
tActivityDate[ACTIVITY_MANAGER.NONLICET_HEART] = {
	Start = {	nYear = 2009, nMonth = 10, nDay = 10, nHour = 7, nMin = 0, nSecond = 0, },
	End = {	nYear = 2009, nMonth = 11, nDay = 12, nHour = 7, nMin = 0, nSecond = 0, },
	AwardStart = {	nYear = 2009, nMonth = 10, nDay = 10, nHour = 8, nMin = 0, nSecond = 0, },
	AwardEnd = {	nYear = 2009, nMonth = 11, nDay = 12, nHour = 8, nMin = 0, nSecond = 0, },
}
function DoNonlicetHeartAction_20091012(player)
	if not player then
		return
	end

	local tActivityTimes = GetActivityTimes(ACTIVITY_MANAGER.NONLICET_HEART)
	if tActivityTimes.nCurrentTime >= tActivityTimes.nAwardStartTime and tActivityTimes.nCurrentTime <= tActivityTimes.nAwardEndTime then
		tActivityIndexList = {ACTIVITY_MANAGER.NONLICET_HEART}
		ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.NONLICET_HEART, true)
	end
end

tActivityRecall[ACTIVITY_MANAGER.NONLICET_HEART] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	if tActivityRosterList[ACTIVITY_MANAGER.NONLICET_HEART] then
		local nNonlicetHeartCount = tActivityRosterList[ACTIVITY_MANAGER.NONLICET_HEART][0]
		local player = GetPlayer(dwPlayerID)
		if not player then
			Log("NonlicetHeartAction failed, can't get player: "..dwPlayerID.." "..szPlayerName)
			return
		end

		player.AddBuff(0, 99, 1443, 1)
		local buff = player.GetBuff(1443, 1)
		if buff then
			buff.nCustomValue = nNonlicetHeartCount
		end
		Log("RemedyMidAutumnAction player: "..dwPlayerID.." "..szPlayerName.." 修为惩罚: "..nNonlicetHeartCount)
	end
end

-- 日轮山城回档			2009.10.12
function DoRiLunShanChengCompensateAction_20091012(player)
	if not player then
		return
	end

	local nRalIP = GetLocalIP()
	if nRalIP ~= "121.14.64.72" then
		return
	end

	local tReward = {5, 4950}
	local nPhase1Index = player.GetCustomInteger1(PLAYER_CUSTOM_VALUE.RILUNSHANCHENG_COMPENSATE)

	if nPhase1Index ~= 0 then
		return
	else
		local nCreateTime = player.GetCreateTime()
		local nLimitTime = DateToTime(2009, 10, 10, 0, 0, 1)
		if nCreateTime > nLimitTime then
			return
		end
		SendSystemMail(GLOBAL_STRING_TABLE.ACTIVITY_MANAGER_STRING.RILUNSHANCHENG_COMPENSATE_20090909.SENDER,
			player.szName,
			GLOBAL_STRING_TABLE.ACTIVITY_MANAGER_STRING.RILUNSHANCHENG_COMPENSATE_20090909.TITLE,
			GLOBAL_STRING_TABLE.ACTIVITY_MANAGER_STRING.RILUNSHANCHENG_COMPENSATE_20090909.CONTENT:format(player.szName),
		0, tReward[1], tReward[2], 1)
		player.SetCustomInteger1(PLAYER_CUSTOM_VALUE.RILUNSHANCHENG_COMPENSATE, 1)
		Log(("[Activity #%s] %s (%d) Got Reward : [%d, %d]."):format("DoRiLunShanChengCompensateAction", player.szName, player.dwID, ITEM_TABLE_TYPE.OTHER, tReward[1], tReward[2]))
	end
end

-- 20091119 更新后，马具叠加数变为1导致马具丢失的补偿
tActivityDate[ACTIVITY_MANAGER.COMPENSATE_MAJU] = {
	AwardStart = {	nYear = 2009, nMonth = 11, nDay = 26, nHour = 8, nMin = 0, nSecond = 0, },
	AwardEnd = {	nYear = 2010, nMonth = 1, nDay = 26, nHour = 8, nMin = 0, nSecond = 0, },
}
function DoRemedyMaju_20091119(player)
	if not player then
		return
	end
	local tActivityTimes = GetActivityTimes(ACTIVITY_MANAGER.COMPENSATE_MAJU)
	if tActivityTimes.nCurrentTime >= tActivityTimes.nAwardStartTime and tActivityTimes.nCurrentTime <= tActivityTimes.nAwardEndTime then
		tActivityIndexList = {ACTIVITY_MANAGER.COMPENSATE_MAJU}
		ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.COMPENSATE_MAJU, true)
	end
end

tActivityRecall[ACTIVITY_MANAGER.COMPENSATE_MAJU] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	if tActivityRosterList[ACTIVITY_MANAGER.COMPENSATE_MAJU] then
		local player = GetPlayer(dwPlayerID)
		if not player then
			Log("RemedyMaju_20091126  failed, can't get player: "..dwPlayerID.." "..szPlayerName)
			return
		end
		local nCompensateMaju0 = tActivityRosterList[ACTIVITY_MANAGER.COMPENSATE_MAJU][0]
		local nCompensateMaju1 = tActivityRosterList[ACTIVITY_MANAGER.COMPENSATE_MAJU][1]
		local nCompensateMaju2 = tActivityRosterList[ACTIVITY_MANAGER.COMPENSATE_MAJU][2]
		local nCompensateMaju3 = tActivityRosterList[ACTIVITY_MANAGER.COMPENSATE_MAJU][3]
		local nCompensateMaju4 = tActivityRosterList[ACTIVITY_MANAGER.COMPENSATE_MAJU][4]
		local nCompensateMaju5 = tActivityRosterList[ACTIVITY_MANAGER.COMPENSATE_MAJU][5]

		-- 这个函数用来抽取数据，返回值为一个表，包含3个数据
		function SplitBitsData(nValue, nSectCount, nRank)
			nRank = nRank or 10
			nSectCount = nSectCount or 3

			local tSplitedData = {}
			for i = nSectCount, 1, -1 do
				tSplitedData[i] = math.floor(nValue / 2 ^ ((nSectCount - i) * nRank)) % (2 ^ nRank)
			end
			return tSplitedData
		end
		-- 	nCompensateList表用来存储对应的补偿列表，0表示不补偿，数字表示对应的马具补偿的个数
		local nCompensateList = {
			SplitBitsData(nCompensateMaju0)[1], SplitBitsData(nCompensateMaju0)[2], SplitBitsData(nCompensateMaju0)[3],
			SplitBitsData(nCompensateMaju1)[1], SplitBitsData(nCompensateMaju1)[2], SplitBitsData(nCompensateMaju1)[3],
			SplitBitsData(nCompensateMaju2)[1], SplitBitsData(nCompensateMaju2)[2], SplitBitsData(nCompensateMaju2)[3],
			SplitBitsData(nCompensateMaju3)[1], SplitBitsData(nCompensateMaju3)[2], SplitBitsData(nCompensateMaju3)[3],
			SplitBitsData(nCompensateMaju4)[1], SplitBitsData(nCompensateMaju4)[2], SplitBitsData(nCompensateMaju4)[3],
			SplitBitsData(nCompensateMaju5)[1], SplitBitsData(nCompensateMaju5)[2], SplitBitsData(nCompensateMaju5)[3],
		}

		-- tCompensateItemList表对应补偿的具体道具
		local tCompensateItemList = {
			{5, 2610, "铁纹鞍具"},
			{5, 2620, "铁纹兽皮笼套"},
			{5, 2622, "铁纹障泥"},
			{5, 2628, "铁纹蹄铁"},
			{5, 2647, "银龙笼套"},
			{5, 2648, "银龙蹄铁"},
			{5, 2649, "银龙鞍具"},
			{5, 2650, "银龙障泥"},
			{5, 2673, "银风笼套"},
			{5, 2674, "银风蹄铁"},
			{5, 2675, "银风鞍具"},
			{5, 2676, "银风障泥"},
			{5, 2677, "黑云笼套"},
			{5, 2678, "黑云蹄铁"},
			{5, 2679, "黑云鞍具"},
			{5, 2680, "黑云障泥"},
		}
		for i = 1, #tCompensateItemList do
			if nCompensateList[i] >= 1 then
				for j = 1, nCompensateList[i] do
					SendSystemMail(GLOBAL_STRING_TABLE.ACTIVITY_MANAGER_STRING.DoRemedyMaju_20091119.SENDER,
						szPlayerName,
						GLOBAL_STRING_TABLE.ACTIVITY_MANAGER_STRING.DoRemedyMaju_20091119.TITLE,
						GLOBAL_STRING_TABLE.ACTIVITY_MANAGER_STRING.DoRemedyMaju_20091119.CONTENT:format(szPlayerName),
					0, tCompensateItemList[i][1], tCompensateItemList[i][2], 1)
					Log("RemedyMaju_20091126  to player: "..dwPlayerID.." "..szPlayerName.." 返还马具: "..tCompensateItemList[i][3])
				end
			end
		end
	end
end
---  20091119 更新后，马具叠加数变为1导致马具丢失的补偿处理结束

-- 2009.12.22 冬至节日活动刷钱BUG处理
tActivityDate[ACTIVITY_MANAGER.DONGZHI_BUG_PUNISH] = {
	AwardStart = {	nYear = 2009, nMonth = 12, nDay = 22, nHour = 0, nMin = 0, nSecond = 0, },
	AwardEnd = {	nYear = 2010, nMonth = 6, nDay = 22, nHour = 0, nMin = 0, nSecond = 0, },
}
function DongzhiBugPunish_20091222(player)
	if not player then
		return
	end
	local tActivityTimes = GetActivityTimes(ACTIVITY_MANAGER.DONGZHI_BUG_PUNISH)
	if tActivityTimes.nCurrentTime >= tActivityTimes.nAwardStartTime and tActivityTimes.nCurrentTime <= tActivityTimes.nAwardEndTime then
		tActivityIndexList = {ACTIVITY_MANAGER.DONGZHI_BUG_PUNISH}
		ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.DONGZHI_BUG_PUNISH, false)
	end
end

tActivityRecall[ACTIVITY_MANAGER.DONGZHI_BUG_PUNISH] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if tActivityRosterList[ACTIVITY_MANAGER.DONGZHI_BUG_PUNISH] then
		local nAddonTrainPointFlag = player.GetCustomInteger1(PLAYER_CUSTOM_VALUE.DONGZHI_BUG_PUNISH)
		local bNewServerFlag = tonumber(tActivityRosterList[ACTIVITY_MANAGER.DONGZHI_BUG_PUNISH][4])

		if nAddonTrainPointFlag == 0 or (bNewServerFlag == 1 and nAddonTrainPointFlag == 1) then
			local nCountFu = tonumber(tActivityRosterList[ACTIVITY_MANAGER.DONGZHI_BUG_PUNISH][0])
			local nCountLu = tonumber(tActivityRosterList[ACTIVITY_MANAGER.DONGZHI_BUG_PUNISH][1])
			local nCountShou = tonumber(tActivityRosterList[ACTIVITY_MANAGER.DONGZHI_BUG_PUNISH][2])
			local nMoney = (nCountFu or 0) * 100 + (nCountLu or 0) * 10 + (nCountShou or 0)
			player.AddBuff(dwPlayerID, 99, 1634, 1)
			local buff = player.GetBuff(1634, 1)
			if buff then
				local nMoneyRealPunish = nMoney
				local nCurrentCountFu = player.GetItemAmountInAllPackages(5, 5274)
				local nCurrentCountLu = player.GetItemAmountInAllPackages(5, 5275)
				local nCurrentCountShou = player.GetItemAmountInAllPackages(5, 5276)

				local nPunishFu = math.min(math.floor(nMoneyRealPunish / 100), nCurrentCountFu)
				nMoneyRealPunish = nMoneyRealPunish - nPunishFu * 100

				local nPunishLu = math.min(math.floor(nMoneyRealPunish / 10), nCurrentCountLu)
				nMoneyRealPunish = nMoneyRealPunish - nPunishLu * 10

				local nPunishShou = math.min(nMoneyRealPunish, nCurrentCountShou)
				nMoneyRealPunish = nMoneyRealPunish - nPunishShou

				player.CostItemInAllPackage(5, 5274, nPunishFu)
				player.CostItemInAllPackage(5, 5275, nPunishLu)
				player.CostItemInAllPackage(5, 5276, nPunishShou)
				local szPunishNotice = "福：" .. nPunishFu .. "个，禄：" .. nPunishLu .. "个，寿：" .. nPunishShou .. "个。"
				Log("DongzhiBugPunish_20091222 Player: " .. szPlayerName .. "(" .. dwPlayerID .. ") 扣除" .. szPunishNotice)
				buff.nCustomValue = nMoneyRealPunish
				Log("DongzhiBugPunish_20091222 Player: " .. szPlayerName .. "(" .. dwPlayerID .. ") 获得惩罚BUFF, 金额: " .. buff.nCustomValue .. "金。")
				player.SetCustomInteger1(PLAYER_CUSTOM_VALUE.DONGZHI_BUG_PUNISH, 2)
				SendGlobalSysMsg(("%s在节日冬至活动期间利用不正当手段获取价值%d金的钱币，这些金钱将会自动持续扣还给系统。"):format(szPlayerName, nMoney))
				player.SendSystemMessage("你因为“欠债还钱”效果，被扣除" .. szPunishNotice)
			end
		elseif nAddonTrainPointFlag == 1 then
			player.SetCustomInteger1(PLAYER_CUSTOM_VALUE.DONGZHI_BUG_PUNISH, 2)
		end
	else
		local nAddonTrainPointFlag = player.GetCustomInteger1(PLAYER_CUSTOM_VALUE.DONGZHI_BUG_PUNISH)

		if nAddonTrainPointFlag == 0 then
			local nCreateTime = player.GetCreateTime()
			local nLimitTime = DateToTime(2009, 12, 22, 19, 0, 0)
			if nCreateTime > nLimitTime then
				return
			end

			player.SetCustomInteger1(PLAYER_CUSTOM_VALUE.DONGZHI_BUG_PUNISH, 2)
			player.AddTrainNoLimit(500)
			Log("DongzhiBugPunish_20091222 Player: " .. szPlayerName .. "(" .. dwPlayerID .. ") 获得修为(突破上限): 500")
			player.SendSystemMessage("2009年12月22日冬至期间临时停机维护补偿修为500点。")
		elseif nAddonTrainPointFlag == 1 then
			player.SetCustomInteger1(PLAYER_CUSTOM_VALUE.DONGZHI_BUG_PUNISH, 2)
		end
	end
end

-- 2009.12.31 冬至停机修为补偿
function Dongzhixiuweibuchang_20091231(player)
	if not player then
		return
	end

	local nAddonTrainPointFlag = player.GetCustomInteger1(PLAYER_CUSTOM_VALUE.DONGZHI_XIUWEI_BUCHANG);
	if nAddonTrainPointFlag == 0 then
		local nCreateTime = player.GetCreateTime();
		local nLimitTime = DateToTime(2009, 12, 25, 17, 0, 0);

		if nCreateTime > nLimitTime then
			return;
		end

		player.SetCustomInteger1(PLAYER_CUSTOM_VALUE.DONGZHI_XIUWEI_BUCHANG, 1);
		player.AddTrainNoLimit(400);

		Log("Dongzhixiuweibuchang_20091231 Player:" .. player.szName .. "(" .. player.dwID .. ") 获得修为(突破上限)：400");
		player.SendSystemMessage("2009年12月25日临时停机维护补偿修为400点。");
	end
end

-- 2010.04.21国悼日修为补偿
function Guodaorixiuweibuchang_20100421(player)
	if not player then
		return
	end
	local tAwardStart = {	nYear = 2010, nMonth = 4, nDay = 21, nHour = 23, nMin = 59, nSecond = 59, }
	local tAwardEnd = {	nYear = 2010, nMonth = 7, nDay = 21, nHour = 23, nMin = 59, nSecond = 59, }
	local nAwardStartTime = DateToTime(tAwardStart.nYear, tAwardStart.nMonth, tAwardStart.nDay, tAwardStart.nHour, tAwardStart.nMin, tAwardStart.nSecond)
	local nAwardEndTime = DateToTime(tAwardEnd.nYear, tAwardEnd.nMonth, tAwardEnd.nDay, tAwardEnd.nHour, tAwardEnd.nMin, tAwardEnd.nSecond)

	local nAddonTrainPointFlag = player.GetCustomInteger1(PLAYER_CUSTOM_VALUE.GUODAORI_XIUWEIBUCHANG);

	if nAddonTrainPointFlag == 0 then
		local nCreateTime = player.GetCreateTime();
		local nLimitTime = DateToTime(2010, 04, 20, 23, 59, 59);
		local nCurrentTime = GetCurrentTime()
		if nCreateTime > nLimitTime then
			return;
		end
		if  nAwardStartTime < nCurrentTime and nCurrentTime < nAwardEndTime then
			player.SetCustomInteger1(PLAYER_CUSTOM_VALUE.GUODAORI_XIUWEIBUCHANG, 1);
			player.AddTrainNoLimit(2400);
			Log("Guodaorixiuweibuchang_20100421 Player:" .. player.szName .. "(" .. player.dwID .. ") 获得修为(突破上限)：2400");
			player.SendSystemMessage("2010年4月21日国悼日停机维护补偿修为2400点。");
		end
	end
end

-- 2010.01.20 冬至活动马来西亚刷声望处理
tActivityDate[ACTIVITY_MANAGER.DONGZHI_MALAIXIYA_SHENGWANG] = {
	AwardStart = {	nYear = 2010, nMonth = 1, nDay = 20, nHour = 0, nMin = 0, nSecond = 0, },
	AwardEnd = {	nYear = 2010, nMonth = 7, nDay = 28, nHour = 0, nMin = 0, nSecond = 0, },
}

function DongzhiMaLaiXiYashengwangkouchu_20100120(player)
	if not player then
		return
	end
	local tActivityTimes = GetActivityTimes(ACTIVITY_MANAGER.DONGZHI_MALAIXIYA_SHENGWANG)
	if tActivityTimes.nCurrentTime >= tActivityTimes.nAwardStartTime and tActivityTimes.nCurrentTime <= tActivityTimes.nAwardEndTime then
		tActivityIndexList = {ACTIVITY_MANAGER.DONGZHI_MALAIXIYA_SHENGWANG}
		ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.DONGZHI_MALAIXIYA_SHENGWANG, false)
	end
end

tActivityRecall[ACTIVITY_MANAGER.DONGZHI_MALAIXIYA_SHENGWANG] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if tActivityRosterList[ACTIVITY_MANAGER.DONGZHI_MALAIXIYA_SHENGWANG] then

		-- 扣除声望
		local nShengWangPunishFlag = player.GetCustomInteger1(PLAYER_CUSTOM_VALUE.DONGZHI_MALAIXIYA_SHENGWANG)

		if nShengWangPunishFlag == 0 then
			local szForceNameTab = {"少林", "万花", "天策", "纯阳", "七秀"} -- 势力ID为11-15

			for nIndex = 0, 4, 1 do
				local nShengWangCount = tonumber(tActivityRosterList[ACTIVITY_MANAGER.DONGZHI_MALAIXIYA_SHENGWANG][nIndex])
				local nForceID = 11 + nIndex
				local szForceName = szForceNameTab[nIndex + 1]

				if nShengWangCount > 0 then
					player.AddReputation(nForceID, 0 - nShengWangCount)
					-- 记录Log和给玩家发送信息
					local szPunishNotice = szForceName .. "声望" .. nShengWangCount .. "点"
					Log("Dongzhi_MaLaiXiYa_Shengwang_Punish_20100120 Player: " .. szPlayerName .. "(" .. dwPlayerID .. ") 扣除" .. szPunishNotice)
					SendGlobalSysMsg(("%s在节日冬至活动期间利用不正当手段获取%s声望，这些声望将会自动持续扣还给系统。"):format(szPlayerName, szForceName))
					player.SendSystemMessage("你在节日冬至活动期间利用不正当手段获取" .. szForceName .. "声望，被扣除" .. szPunishNotice)
				end
			end

			-- 添加Debuff
			local nLimitTime = DateToTime(2010, 2, 11, 0, 0, 0);
			local nRemainTime = nLimitTime - GetCurrentTime()

			if nRemainTime > 0 then
				local tLevelTab = {[10] = 1, [15] = 2, [20] = 3, [30] = 4}
				local nDebuffCount = tonumber(tActivityRosterList[ACTIVITY_MANAGER.DONGZHI_MALAIXIYA_SHENGWANG][5])
				local nBuffLevel = tLevelTab[nDebuffCount] or 1

				player.AddBuff(0, 99, 1657, nBuffLevel, 1, nRemainTime * GLOBAL.GAME_FPS)
			end

			-- 表示完成扣声望操作
			player.SetCustomInteger1(PLAYER_CUSTOM_VALUE.DONGZHI_MALAIXIYA_SHENGWANG, 1)
		end
	end
end

-- 2010年藏剑资料片修为补偿
function CanjianXiuweiBucang_20100524(player)
	if not player then
		return
	end
	tActivityIndexList = {ACTIVITY_MANAGER.CANGJIAN_XIUWEI_SONG}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.CANGJIAN_XIUWEI_SONG, true)
end

tActivityRecall[ACTIVITY_MANAGER.CANGJIAN_XIUWEI_SONG] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	local nStoreTrain = 0
	if tActivityRosterList[ACTIVITY_MANAGER.CANGJIAN_XIUWEI_SONG] then
		local playerlevel = tActivityRosterList[ACTIVITY_MANAGER.CANGJIAN_XIUWEI_SONG][0]
		if playerlevel > 0 then
			nStoreTrain = (playerlevel * 10 + 100) * (playerlevel - 1) / 2
			local kouchu = tActivityRosterList[ACTIVITY_MANAGER.CANGJIAN_XIUWEI_SONG][1]
			nStoreTrain = nStoreTrain - tActivityRosterList[ACTIVITY_MANAGER.CANGJIAN_XIUWEI_SONG][1]
			if nStoreTrain < 1 then
				player.SetCustomInteger4(PLAYER_CUSTOM_VALUE.GONGLI_GAME_HUODE, -1)
			else
				player.SetCustomInteger4(PLAYER_CUSTOM_VALUE.GONGLI_GAME_HUODE, nStoreTrain)
				Log("CanjianXiuweiBucang_20100524 Player: " .. szPlayerName .. "(" .. dwPlayerID .. ")bucang" .. nStoreTrain)
			end
		end
	end
end

-- 2010年藏剑资料片修为补偿：二期
function CanjianXiuweiBucang_20100613(player)
	if not player then
		return
	end
	tActivityIndexList = {ACTIVITY_MANAGER.CANGJIAN_XIUWEI_SECOND}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.CANGJIAN_XIUWEI_SECOND, true)
end

tActivityRecall[ACTIVITY_MANAGER.CANGJIAN_XIUWEI_SECOND] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	local nStoreTrain = 0
	if tActivityRosterList[ACTIVITY_MANAGER.CANGJIAN_XIUWEI_SECOND] then
		local playerlevel = tActivityRosterList[ACTIVITY_MANAGER.CANGJIAN_XIUWEI_SECOND][0]
		if playerlevel > 0 then
			nStoreTrain = (playerlevel * 10 + 100) * (playerlevel - 1) / 2
			local kouchu = tActivityRosterList[ACTIVITY_MANAGER.CANGJIAN_XIUWEI_SECOND][1]
			nStoreTrain = nStoreTrain - tActivityRosterList[ACTIVITY_MANAGER.CANGJIAN_XIUWEI_SECOND][1]
			if nStoreTrain < 1 then
				player.SetCustomInteger4(PLAYER_CUSTOM_VALUE.GONGLI_GAME_HUODE, -1)
			else
				player.SetCustomInteger4(PLAYER_CUSTOM_VALUE.GONGLI_GAME_HUODE, nStoreTrain)
				Log("CanjianXiuweiBucang_20100613 Player: " .. szPlayerName .. "(" .. dwPlayerID .. ")bucang" .. nStoreTrain)
			end
		end
	end
end

-- 百草园上线导致的师徒奖励发送补偿
function ShiTuChuShiBuChang_20100628(player)
	if not player then
		return
	end
	tActivityIndexList = {ACTIVITY_MANAGER.SHITU_CHUSHIBUCHANG_BAICAOYUAN}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.SHITU_CHUSHIBUCHANG_BAICAOYUAN, true)
end

tActivityRecall[ACTIVITY_MANAGER.SHITU_CHUSHIBUCHANG_BAICAOYUAN] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	local money = 0
	if tActivityRosterList[ACTIVITY_MANAGER.SHITU_CHUSHIBUCHANG_BAICAOYUAN] then
		local chushiwanjiashuliang = tActivityRosterList[ACTIVITY_MANAGER.SHITU_CHUSHIBUCHANG_BAICAOYUAN][0]
		if chushiwanjiashuliang > 0 then
			money = chushiwanjiashuliang * 1000000
			-- 在补偿期间，就发送补偿邮件
			local nTime = GetCurrentTime()
			local nShiTuBuChanStartTime = DateToTime(2010, 6, 28, 0, 0, 0)
			local nShiTuBuChanEndTime = DateToTime(2010, 10, 5, 0, 0, 0)
			if nShiTuBuChanStartTime <= nTime and nTime <= nShiTuBuChanEndTime then
				SendSystemMail("隐元会执事", player.szName, "迟到的出师奖励", "　　近日查明，百草园开园之日，当值的师徒奖励掌管使竟玩忽职守，为观看百草园蹴鞠大赛而擅离岗位，导致贵徒出师的金钱奖励未按时发送！此事相关的奖励掌管使现已按会规处置，以儆效尤！\n\n　　今日特将贵徒出师的奖励补上，带来的不便,深表歉意！望大侠见谅.",
				money)
				Log("ShiTuChuShiBuChang_20100628 Player: " .. szPlayerName .. "(" .. dwPlayerID .. ")bucang" .. money)
			end
		end
	end
end

-- 2010.08.17 舟曲泥石流全国哀悼日补偿
function DoCountryAiDaoRi_20100817(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if GV and GV.VersionLineName ~= "zhcn" then --马来版本不补偿
		return
	end
	if GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "snda" then --盛大版本不补偿
		return
	end

	local tReward = {5, 7041}
	local nServerType = GetGlobalSystemValueCache().nChargeMode
	if nServerType == CHARGE_MODE.MONTH_CARD then
		tReward[3] = 5  --月卡服务器补偿5颗丹药
	else
		tReward[3] = 2  --点卡服务器补偿2颗丹药
	end

	local nPhase1Index = player.GetCustomInteger1(PLAYER_CUSTOM_VALUE.ZHOUQUNISHILIU_20100817)

	if nPhase1Index ~= 0 then
		return
	else
		local nCreateTime = player.GetCreateTime()
		local nLimitTime = DateToTime(2010, 08, 20, 0, 0, 0)
		if nCreateTime > nLimitTime then
			return
		end
		SendSystemMail(GLOBAL_STRING_TABLE.ACTIVITY_MANAGER_STRING.DoRemedyAiDaori_20100817.SENDER,
			player.szName,
			GLOBAL_STRING_TABLE.ACTIVITY_MANAGER_STRING.DoRemedyAiDaori_20100817.TITLE,
			GLOBAL_STRING_TABLE.ACTIVITY_MANAGER_STRING.DoRemedyAiDaori_20100817.CONTENT:format(player.szName),
		0, tReward[1], tReward[2], tReward[3])
		player.SetCustomInteger1(PLAYER_CUSTOM_VALUE.ZHOUQUNISHILIU_20100817, 1)
		Log(("[Activity #%s] %s (%d) Got Reward : [%d, %d, %d]."):format("DoCountryAiDaoRi_20100817", player.szName, player.dwID, tReward[1], tReward[2], tReward[3]))
	end
end

-- 2010.08.30 送挂件更新异步事故处理补偿
function Chongzhisongguajianmaju_20100830(player)
	if not player then
		return
	end
	tActivityIndexList = {ACTIVITY_MANAGER.CHONGZHI_SONGGUANJIANMAJU}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.CHONGZHI_SONGGUANJIANMAJU, true)
end

tActivityRecall[ACTIVITY_MANAGER.CHONGZHI_SONGGUANJIANMAJU] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if tActivityRosterList[ACTIVITY_MANAGER.CHONGZHI_SONGGUANJIANMAJU] then
		local chongzhisongguanjia = tActivityRosterList[ACTIVITY_MANAGER.CHONGZHI_SONGGUANJIANMAJU][0]
		local chongzhisongmaju = tActivityRosterList[ACTIVITY_MANAGER.CHONGZHI_SONGGUANJIANMAJU][1]
		if chongzhisongguanjia > 0  or chongzhisongmaju > 0 then
			-- 在补偿期间，就发送补偿邮件
			local nTime = GetCurrentTime()
			local nChongZhiBuChanStartTime = DateToTime(2010, 8, 30, 0, 0, 0)
			local nChongZhiBuChanEndTime = DateToTime(2010, 12, 13, 7, 0, 0)
			--时间限制
			if nChongZhiBuChanStartTime <= nTime and nTime <= nChongZhiBuChanEndTime then
				if chongzhisongguanjia == 1 then
					--挂件邮件
					local tItemOfGuaJian = {{8, 2018, 1, 0}, {8, 2019, 1, 0}, {8, 2020, 1, 0}, {8, 2021, 1, 0}, {5, 7056, 2, 0}, {5, 7057, 2, 0}}
					SendSystemMail("隐元会执事", player.szName, "迟到的充值挂件礼包", player.szName .. "\n    侠士你好！\n    近日查明，在8月30号晨间，当值的隐元会押运使在押送礼品镖车期间竟偏离原定押运路线，致使延误了礼品到达时间，侠士的充值挂件礼包未能按时到位！此事相关的押运使现已按会规处置，以儆效尤！\n" ..
						"    今日特将侠士的充值挂件礼包敬上，带来的不便,深表歉意！望大侠见谅。\n    隐元会",
					0, tItemOfGuaJian)
					Log("Chongzhisongguajianmaju_20100830 Player: " .. szPlayerName .. "(" .. dwPlayerID .. ")挂件礼包：{8, 2018, 1},{8, 2019, 1},{8, 2020, 1},{8, 2021, 1},{5, 7056, 2},{5, 7057, 2}")
				end

				if chongzhisongmaju == 1 then
					--马具邮件
					local tItemOfMaJu = {{5, 5129, 1, 0}, {5, 5130, 1, 0}, {5, 5131, 1, 0}}
					--注：此{ITEM_TABLE_TYPE.OTHER,6971,10,0}中的参数10为道具数量，必须小于道具的最大叠加！
					SendSystemMail("隐元会执事", player.szName, "迟到的充值马具礼包", player.szName .. "\n    侠士你好！\n　　近日查明，在8月30号晨间，当值的隐元会押运使在押送礼品镖车期间竟偏离原定押运路线，致使延误了礼品到达时间，侠士的充值马具礼包未能按时到位！此事相关的押运使现已按会规处置，以儆效尤！\n" ..
						"    今日特将侠士的充值马具礼包敬上，带来的不便,深表歉意！望大侠见谅。\n    隐元会",
					0, tItemOfMaJu)
					Log("Chongzhisongguajianmaju_20100830 Player: " .. szPlayerName .. "(" .. dwPlayerID .. ")马具礼包：{5, 5129, 1},{5, 5130, 1},{5, 5131, 1}")
				end
			end
		end
	end
end

--战魂劫版本随机宝箱监本印文BUG补偿
function DoZhanhunmiji_20101028(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if GV and GV.VersionLineName ~= "zhcn" then --马来版本不补偿
		return
	end
	if GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "snda" then --盛大版本不补偿
		return
	end
	if player.GetCustomInteger1(PLAYER_CUSTOM_VALUE.ZHANHUN_BUG_MIJI_BUCANG) > 0 then
		return
	end

	local bIsBucang = false

	-- 补偿1：扣除监本印文
	if tKouchujianben[player.szName] then
		if tKouchujianben[player.szName].ServerIP == GetLocalIP() or tKouchujianben[player.szName].ServerIP2 == GetLocalIP() then
			if tKouchujianben[player.szName].Kouchu >= 1000 then
				player.AddBuff(0, 99, 2240, 1)
			end
			if tKouchujianben[player.szName].Kouchu >= tKouchujianben[player.szName].CostNumber + tKouchujianben[player.szName].Buchang then
				local nKouchu = tKouchujianben[player.szName].Kouchu - tKouchujianben[player.szName].CostNumber - tKouchujianben[player.szName].Buchang
				if nKouchu > 0 then
					player.AddBuff(0, 99, 2239, 1)
					local buff_kouchu = player.GetBuff(2239, 1)
					buff_kouchu.nCustomValue = nKouchu
				end
				bIsBucang = true
			elseif tKouchujianben[player.szName].Kouchu < tKouchujianben[player.szName].CostNumber + tKouchujianben[player.szName].Buchang then
				local nBuchang = tKouchujianben[player.szName].CostNumber - tKouchujianben[player.szName].Kouchu + tKouchujianben[player.szName].Buchang
				SendSystemMail("隐元会", player.szName, "异常事件致歉信", player.szName .. "：\n　　近日，朝中管事失误，导致监本印文数量错乱。特补偿大侠本来拥有的监本印文。请验收附件。",
				0, 5, 6258, nBuchang)
				bIsBucang = true
			end
		end
	end
	-- 补偿2： 遗忘技能
	if tForgetSkill[player.szName] then
		if tForgetSkill[player.szName].ServerIP == GetLocalIP() or tForgetSkill[player.szName].ServerIP2 == GetLocalIP() then
			for i = 1, #tRealFogetSkill do
				if tRealFogetSkill[i].Name == player.szName then
					if tRealFogetSkill[i].SkillID < 10000 then
						if player.GetSkillLevel(tRealFogetSkill[i].SkillID) ~= 0 then
							player.ForgetSkill(tRealFogetSkill[i].SkillID)
						else
							if player.GetItemAmountInAllPackages(5, tRealFogetSkill[i].MijiID) > 0 then
								player.CostItemInAllPackage(5, tRealFogetSkill[i].MijiID, player.GetItemAmountInAllPackages(5, tRealFogetSkill[i].MijiID))
							end
						end
						bIsBucang = true
					elseif tRealFogetSkill[i].SkillID >= 10000 then
						if player.GetItemAmountInAllPackages(5, tRealFogetSkill[i].MijiID) > 0 then
							player.CostItemInAllPackage(5, tRealFogetSkill[i].MijiID, player.GetItemAmountInAllPackages(5, tRealFogetSkill[i].MijiID))
						else
							if player.GetSkillLevel(tRealFogetSkill[i].SkillID) ~= 0 then
								if player.GetSkillLevel(tRealFogetSkill[i].SkillID) > 3 then
									if tForgetSkill1028[tRealFogetSkill[i].SkillID] then
										player.ForgetSkill(tRealFogetSkill[i].SkillID)
										for i, v in pairs(tForgetSkill1028[tRealFogetSkill[i].SkillID]) do
											if player.GetSkillLevel(v) > 0 then
												player.ForgetSkill(v)
											end
										end
										for j = 1, 3 do
											player.LearnSkill(tRealFogetSkill[i].SkillID)
										end
									end
								end
							end
						end
						bIsBucang = true
					end
				end
			end
		end
	end

	-- 补偿3： 补偿覆盖的监本印文
	if tBucangjianben[player.szName] then
		if tBucangjianben[player.szName].ServerIP == GetLocalIP() or tBucangjianben[player.szName].ServerIP2 == GetLocalIP() then
			SendSystemMail("隐元会", player.szName, "异常事件致歉信", player.szName .. "：\n　　近日，朝中管事失误，导致监本印文数量错乱。特补偿大侠本来应该获得的监本印文。请验收附件。",
			0, 5, 6258, tBucangjianben[player.szName].Box)
			bIsBucang = true
		end
	end

	if bIsBucang then
		player.SetCustomInteger1(PLAYER_CUSTOM_VALUE.ZHANHUN_BUG_MIJI_BUCANG, 1) -- 标记为已补偿玩家
	end
end

-- 监本印文二期补偿处理
function DoZhanhunmiji_20101108(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if GV and GV.VersionLineName ~= "zhcn" then --马来版本不补偿
		return
	end
	if GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "snda" then --盛大版本不补偿
		return
	end
	if player.GetCustomInteger1(PLAYER_CUSTOM_VALUE.ZHANHUN_BUG_MIJI_FANHUAN) > 0 then
		return
	end

	local bIsFanhuan = false

	local tMailItemInfo = {}

	if tFanhuanmiji[player.szName] then
		if tFanhuanmiji[player.szName].ServerIP == GetLocalIP() or tFanhuanmiji[player.szName].ServerIP2 == GetLocalIP() then
			for i = 1, 9 do
				if tFanhuanmiji[player.szName]["MijiID" .. i] and type(tFanhuanmiji[player.szName]["MijiID" .. i]) == "number" and tFanhuanmiji[player.szName]["MijiID" .. i] > 0 then
					tMailItemInfo[i] = {ITEM_TABLE_TYPE.OTHER, tFanhuanmiji[player.szName]["MijiID" .. i], 1, 0}
				end
			end
		end

		if #tMailItemInfo <= 8 then
			SendSystemMail("隐元会", player.szName, "异常事件致歉信", player.szName .. "：\n　　近日，朝中管事在回收监本印文多得利益之时，多扣除了部分大侠自己通过其他途径学得的内功及招式重数。特返还大侠本来应该获得的第二门派学习秘笈，请验收附件。",
			0, tMailItemInfo)
			bIsFanhuan = true
		elseif #tMailItemInfo > 8 and #tMailItemInfo <= 9 then
			SendSystemMail("隐元会", player.szName, "异常事件致歉信", player.szName .. "：\n　　近日，朝中管事在回收监本印文多得利益之时，多扣除了部分大侠自己通过其他途径学得的内功及招式重数。特返还大侠本来应该获得的第二门派学习秘笈，请验收附件。",
			0, tMailItemInfo[9][1], tMailItemInfo[9][2], 1, 0)
			table.remove(tMailItemInfo, 9)
			SendSystemMail("隐元会", player.szName, "异常事件致歉信", player.szName .. "：\n　　近日，朝中管事在回收监本印文多得利益之时，多扣除了部分大侠自己通过其他途径学得的内功及招式重数。特返还大侠本来应该获得的第二门派学习秘笈，请验收附件。",
			0, tMailItemInfo)
			bIsFanhuan = true
		end

		if bIsFanhuan then
			player.SetCustomInteger1(PLAYER_CUSTOM_VALUE.ZHANHUN_BUG_MIJI_FANHUAN, 1) -- 标记为已返还玩家
		end
	end
end

--12月27日阵营场景服务器宕机维护补偿
function DoCampQuest_20101227(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if GV and GV.VersionLineName ~= "zhcn" then --马来版本不补偿
		return
	end
	if GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "snda" then --盛大版本不补偿
		return
	end

	if player.GetCustomInteger1(PLAYER_CUSTOM_VALUE.CAMP_BUG_BUCHANG) ~= 0 then
		return
	elseif player.nLevel >= 18 and player.GetCustomInteger1(PLAYER_CUSTOM_VALUE.CAMP_BUG_BUCHANG) == 0 then  --已满18级并未收到过邮件的玩家符合补偿条件
		local nTime = GetCurrentTime()
		local nLimitTime = DateToTime(2011, 01, 06, 23, 59, 59)  --补偿截止时间
		local tItemOfCamp = {{ITEM_TABLE_TYPE.OTHER, 7161, 2, 0}, {ITEM_TABLE_TYPE.OTHER, 6300, 3, 0}, {ITEM_TABLE_TYPE.OTHER, 6302, 3, 0}}
		--注：此{ITEM_TABLE_TYPE.OTHER, 7161, 2, 0}中的参数2为道具数量，必须小于道具的最大叠加！
		if nTime > nLimitTime then  --截止时间之后上线的玩家不补偿
			return
		end
		SendSystemMail("隐元会", player.szName, "异常事件致歉信", player.szName .. "：\n　　近日，浩气盟与恶人谷场景进行年终大扫除，导致各位无法进入及参与阵营攻防战。特补偿侠士部分威望及紫陨，请验收附件。",
		0, tItemOfCamp)  --浩气盟、恶人谷、中立玩家发放相同的道具：2紫陨、3丹心令和3不羁令，后两者只能增加一方阵营的威望
		player.SetCustomInteger1(PLAYER_CUSTOM_VALUE.CAMP_BUG_BUCHANG, 1)  --标记为已补偿玩家
		Log("DoCampQuest_20101227 Player: " .. player.szName .. "(" .. player.dwID .. ")补偿邮件：{5, 7161, 2}, {5, 6300, 3}, {5, 6302, 3}")
	end
end

-- 2011年1月春节重置处理，因目前无其他任何地方调用，直接屏蔽
function Chongzhi_chunjie_20110125(player)
	if not player then
		return
	end
	tActivityIndexList = {ACTIVITY_MANAGER.CHONGZHI_CHUNJIEHUODONG}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.CHONGZHI_CHUNJIEHUODONG, true)
end

tActivityRecall[ACTIVITY_MANAGER.CHONGZHI_CHUNJIEHUODONG] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local gv = GetGameVersion()
	if gv and gv.VersionLineName ~= "zhcn" then --马来版本不补偿
		return
	end
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if tActivityRosterList[ACTIVITY_MANAGER.CHONGZHI_CHUNJIEHUODONG] then
		local chongzhi_chunjie_ruyilian = tActivityRosterList[ACTIVITY_MANAGER.CHONGZHI_CHUNJIEHUODONG][0]
		local chongzhi_chunjie_agan = tActivityRosterList[ACTIVITY_MANAGER.CHONGZHI_CHUNJIEHUODONG][1]
		if chongzhi_chunjie_ruyilian > 0  or chongzhi_chunjie_agan > 0 then
			-- 在补偿期间，就发送补偿邮件
			local nTime = GetCurrentTime()
			local nChongZhiBuChanStartTime = DateToTime(2011, 1, 25, 0, 0, 0)
			local nChongZhiBuChanEndTime = DateToTime(2011, 3, 20, 7, 0, 0)
			--时间限制
			if nChongZhiBuChanStartTime <= nTime and nTime <= nChongZhiBuChanEndTime then
				if chongzhi_chunjie_ruyilian == 1 then
					--如意帘
					local tItemOfRuyilian = {{5, 7979, 1, 0}, }
					SendSystemMail("隐元会执事", player.szName, "迟到的春节礼品", player.szName .. "\n    侠士你好！\n　　近日查明，在1月20号至今一段时间里边，侠士您因为背包格数不足装下所有礼品，宝库执掌使竟没有对侠士作出合理明确的解释或提示，而导致部分礼品未能及时送达，为侠士您也带来了不少困惑。宝库执掌使黄字零零捌现已按玩忽职守的会规作出惩罚！\n" ..
						"    今日特将侠士的礼品敬上，带来的不便,深表歉意！望大侠见谅。\n    隐元会",
					0, tItemOfRuyilian)
					Log("Chongzhi_chunjie_20110125 Player: " .. szPlayerName .. "(" .. dwPlayerID .. ")未做完的如意帘：{5, 7979, 1}")
				end

				if chongzhi_chunjie_agan == 1 then
					--阿甘
					local tItemOfAgan = {{5, 7980, 1, 0}, }
					--注：此{ITEM_TABLE_TYPE.OTHER,6971,10,0}中的参数10为道具数量，必须小于道具的最大叠加！
					SendSystemMail("隐元会执事", player.szName, "迟到的春节礼品", player.szName .. "\n    侠士你好！\n　　近日查明，在1月20号至今一段时间里边，侠士您因为背包格数不足装下所有礼品，宝库执掌使竟没有对侠士作出合理明确的解释或提示，而导致部分礼品未能及时送达，为侠士您也带来了不少困惑。宝库执掌使黄字零零捌现已按玩忽职守的会规作出惩罚！\n" ..
						"    今日特将侠士的礼品敬上，带来的不便,深表歉意！望大侠见谅。\n    隐元会",
					0, tItemOfAgan)
					Log("Chongzhi_chunjie_20110125 Player: " .. szPlayerName .. "(" .. dwPlayerID .. ")祥瑞阿甘：{5, 7980, 1}")
				end
			end
		end
	end
end

--2011.1.26 书籍ID转换中扣错的装备补偿
function Shujikoucuo_buchang_20110126(player)
	if not player then
		return
	end
	tActivityIndexList = {ACTIVITY_MANAGER.SHUJIKOUCUODAOJU_BUCHANG}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.SHUJIKOUCUODAOJU_BUCHANG, true)
end

tActivityRecall[ACTIVITY_MANAGER.SHUJIKOUCUODAOJU_BUCHANG] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local gv = GetGameVersion()
	if gv and gv.VersionLineName ~= "zhcn" then --马来版本不补偿
		return
	end
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if tActivityRosterList[ACTIVITY_MANAGER.SHUJIKOUCUODAOJU_BUCHANG] then
		local nEquip0 = tActivityRosterList[ACTIVITY_MANAGER.SHUJIKOUCUODAOJU_BUCHANG][0]
		local nEquip1 = tActivityRosterList[ACTIVITY_MANAGER.SHUJIKOUCUODAOJU_BUCHANG][1]
		local nEquip2 = tActivityRosterList[ACTIVITY_MANAGER.SHUJIKOUCUODAOJU_BUCHANG][2]
		local nEquip3 = tActivityRosterList[ACTIVITY_MANAGER.SHUJIKOUCUODAOJU_BUCHANG][3]
		local nEquip4 = tActivityRosterList[ACTIVITY_MANAGER.SHUJIKOUCUODAOJU_BUCHANG][4]
		if nEquip0 > 0  or nEquip1 > 0 or  nEquip2 > 0 or nEquip3 > 0 or nEquip4 > 0 then
			-- 在补偿期间，就发送补偿邮件
			local nTime = GetCurrentTime()
			local nBuChangStartTime = DateToTime(2011, 1, 25, 0, 0, 0)
			local nBuChangEndTime = DateToTime(2011, 4, 18, 7, 0, 0)
			--时间限制
			if nBuChangStartTime <= nTime and nTime <= nBuChangEndTime then
				if nEquip0 == 1 then
					local tEquip = {{7, 2861, 332, 0}, {5, 7501, 1, 0}}
					SendSystemMail("隐元会执事", player.szName, "装备的送还", player.szName .. "\n    侠士你好！\n　　近日查明，在1月25号，侠士您身上的金吾佛宝冠因为某种意外不翼而飞，现已由隐元会查出原因，原物奉还！\n" ..
						"    另外附送上一件刺绣道具，带来的不便，深表歉意！望大侠见谅。\n    隐元会",
					0, tEquip)
					Log("BookIDErrorBuChang_20110126 Player: " .. szPlayerName .. "(" .. dwPlayerID .. ")：金吾佛宝冠{7, 2861, 332}  莹白绣（头部）｛5,7501, 1}")
				end

				if nEquip1 == 1 then
					local tEquip = {{7, 3001, 327, 0}, }
					SendSystemMail("隐元会执事", player.szName, "装备的送还", player.szName .. "\n    侠士你好！\n　　近日查明，在1月25号，侠士您身上的别情衫因为某种意外不翼而飞，现已由隐元会查出原因，原物奉还！\n" ..
						"    带来的不便，深表歉意！望大侠见谅。\n    隐元会",
					0, tEquip)
					Log("BookIDErrorBuChang_20110126 Player: " .. szPlayerName .. "(" .. dwPlayerID .. ")：别情衫{7,3001,327}")
				end

				if nEquip2 == 1 then
					local tEquip = {{7, 3529, 358, 0}, }
					SendSystemMail("隐元会执事", player.szName, "装备的送还", player.szName .. "\n    侠士你好！\n　　近日查明，在1月25号，侠士您身上的魂殇逆风・郁非襟因为某种意外不翼而飞，现已由隐元会查出原因，原物奉还！\n" ..
						"    带来的不便，深表歉意！望大侠见谅。\n    隐元会",
					0, tEquip)
					Log("BookIDErrorBuChang_20110126 Player: " .. szPlayerName .. "(" .. dwPlayerID .. ")：魂殇逆风・郁非襟{7,3529,358}")
				end

				if nEquip3 == 1 then
					local tEquip = {{7, 3528, 358, 0}, }
					SendSystemMail("隐元会执事", player.szName, "装备的送还", player.szName .. "\n    侠士你好！\n　　近日查明，在1月25号，侠士您身上的魂殇逆风・癫狂襟因为某种意外不翼而飞，现已由隐元会查出原因，原物奉还！\n" ..
						"    带来的不便，深表歉意！望大侠见谅。\n    隐元会",
					0, tEquip)
					Log("BookIDErrorBuChang_20110126 Player: " .. szPlayerName .. "(" .. dwPlayerID .. ")：魂殇逆风・癫狂襟{7,3528,358}")
				end

				if nEquip4 == 1 then
					local tEquip = {{7, 5486, 285, 0}, }
					SendSystemMail("隐元会执事", player.szName, "装备的送还", player.szName .. "\n    侠士你好！\n　　近日查明，在1月25号，侠士您身上的悲鸣冠因为某种意外不翼而飞，现已由隐元会查出原因，原物奉还！\n" ..
						"    带来的不便，深表歉意！望大侠见谅。\n    隐元会",
					0, tEquip)
					Log("BookIDErrorBuChang_20110126 Player: " .. szPlayerName .. "(" .. dwPlayerID .. ")：悲鸣冠{7,5486,285}")
				end
			end
		end
	end
end

-- 擂台赛发放奖励
function Leitaisaijiangli(player)
	if not player then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2011, 2, 24, 0, 0, 0)
	local nEndTime = DateToTime(2011, 3, 24, 7, 0, 0)
	--时间限制
	if nStartTime >= nTime or  nTime >= nEndTime then
		return
	end
	local GV = GetGameVersion();
	if not GV then
		return
	end
	if GV.VersionLineName ~= "zhcn" then
		return
	end
	if GV.VersionEx ~= "" then
		return
	end
	tActivityIndexList = {ACTIVITY_MANAGER.LEITAISAIJIANGLI}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.LEITAISAIJIANGLI, true)
end

tActivityRecall[ACTIVITY_MANAGER.LEITAISAIJIANGLI] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.LEITAISAIJIANGLI] then
		return
	end
	local tItem
	local nHuoluojindan = tActivityRosterList[ACTIVITY_MANAGER.LEITAISAIJIANGLI][0]
	if nHuoluojindan == 1 then
		tItem = {{ITEM_TABLE_TYPE.OTHER, 7041, 5, 0}, }--活络金丹
		SendSystemMail("隐元会执事", player.szName, "首届帮会擂台赛奖励", player.szName .. "侠士：\n　　见信好！\n　　　恭喜贵帮会在首届帮会擂台赛中闯入三十强，随信附纪念品一份，还请笑纳。\n" ..
			"\n\n　　                                         隐元会敬上",
		0, tItem)
		Log("LeiTaiSaiJiangLi_20110224 Player: " .. szPlayerName .. "(" .. dwPlayerID .. ")：活络金丹")
		return
	end
	local nChenghaodaoju = tActivityRosterList[ACTIVITY_MANAGER.LEITAISAIJIANGLI][1]
	if nChenghaodaoju == 1 then
		tItem = {{ITEM_TABLE_TYPE.OTHER, 8074, 1, 0}, }--天下第一帮
		SendSystemMail("隐元会执事", player.szName, "首届帮会擂台赛奖励", player.szName .. "侠士：\n　　见信好！\n　　　恭喜贵帮会在首届帮会擂台赛中一举夺魁，随信附奖品一份，还请笑纳。\n" ..
			"\n\n　　                                         隐元会敬上",
		0, tItem)
		Log("LeiTaiSaiJiangLi_20110224 Player: " .. szPlayerName .. "(" .. dwPlayerID .. ")：天下第一帮")
		return
	end
end

-- 2011年2月18号补偿春节活动中提前2天消失的玩家的梅良玉签和瑞
function DoRemedyChunjiehuobi(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if GV and GV.VersionLineName ~= "zhcn" then --马来版本不补偿
		return
	end
	if GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "snda" then --盛大版本不补偿
		return
	end

	local nTime = GetCurrentTime()
	local nEndRewardTime = DateToTime(2012, 2, 28, 7, 0, 0)
	if nTime <= nEndRewardTime then
		tActivityIndexList = {ACTIVITY_MANAGER.CHUNJIEHUOBIBUCHANG}
		ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.CHUNJIEHUOBIBUCHANG, true)
	end
end

tActivityRecall[ACTIVITY_MANAGER.CHUNJIEHUOBIBUCHANG] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	if tActivityRosterList[ACTIVITY_MANAGER.CHUNJIEHUOBIBUCHANG] then
		local player = GetPlayer(dwPlayerID)
		if not player then
			Log("DoRemedyChunjieHuobi_20110218  failed, can't get player: "..dwPlayerID.." "..szPlayerName)
			return
		end
		local nMeiliangyuqian = tActivityRosterList[ACTIVITY_MANAGER.CHUNJIEHUOBIBUCHANG][0] -- 梅良玉签 6038
		local nRui = tActivityRosterList[ACTIVITY_MANAGER.CHUNJIEHUOBIBUCHANG][1]            -- 瑞 6047
		if nMeiliangyuqian > 0 then
			SendSystemMail(GLOBAL_STRING_TABLE.ACTIVITY_MANAGER_STRING.DoRemedyChunjieHuobi_20110218.SENDER,
				szPlayerName,
				GLOBAL_STRING_TABLE.ACTIVITY_MANAGER_STRING.DoRemedyChunjieHuobi_20110218.TITLE,
				GLOBAL_STRING_TABLE.ACTIVITY_MANAGER_STRING.DoRemedyChunjieHuobi_20110218.CONTENT:format(szPlayerName),
			0, ITEM_TABLE_TYPE.OTHER, 6038, nMeiliangyuqian)
			Log("DoRemedyChunjieHuobi_20110218  to player: "..dwPlayerID.." "..szPlayerName.." 返还梅良玉签: "..nMeiliangyuqian)
		end
		if nRui > 0 then
			SendSystemMail(GLOBAL_STRING_TABLE.ACTIVITY_MANAGER_STRING.DoRemedyChunjieHuobi_20110218.SENDER,
				szPlayerName,
				GLOBAL_STRING_TABLE.ACTIVITY_MANAGER_STRING.DoRemedyChunjieHuobi_20110218.TITLE,
				GLOBAL_STRING_TABLE.ACTIVITY_MANAGER_STRING.DoRemedyChunjieHuobi_20110218.CONTENT:format(szPlayerName),
			0, ITEM_TABLE_TYPE.OTHER, 6047, nRui)
			Log("DoRemedyChunjieHuobi_20110218  to player: "..dwPlayerID.." "..szPlayerName.." 返还瑞: "..nRui)
		end
	end
end

-- 荻花刷箱子bug处理：175武器删除
function DHPQ_BugManage_Del175Weapon(player)
	if not player then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2011, 2, 24, 0, 0, 0)
	local nEndTime = DateToTime(2013, 2, 24, 7, 0, 0)
	--时间限制
	if nStartTime >= nTime or  nTime >= nEndTime then
		return
	end
	local GV = GetGameVersion();
	if not GV then
		return
	end
	if GV.VersionLineName ~= "zhcn" then
		return
	end
	if GV.VersionEx ~= "" then
		return
	end
	tActivityIndexList = {ACTIVITY_MANAGER.DHBUG_DEL175WEAPON}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.DHBUG_DEL175WEAPON, true)
end
local tDHWeapon175 = {
	2810,
	2811,
	2812,
	2813,
	2814,
	2815,
	2816,
	2817,
	2818,
	2819,
	2820,
	2821,
}
tActivityRecall[ACTIVITY_MANAGER.DHBUG_DEL175WEAPON] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.DHBUG_DEL175WEAPON] then
		return
	end
	local nWeapon = 0
	for i = 1, #tDHWeapon175 do--删除所有的武器
		nWeapon = player.GetItemAmountInAllPackages(6, tDHWeapon175[i])
		if nWeapon > 0 then
			player.CostItemInAllPackage(6, tDHWeapon175[i], nWeapon)
		end
	end
	nWeapon = player.GetItemAmountInAllPackages(8, 2427)
	if nWeapon > 0 then
		player.CostItemInAllPackage(8, 2427, nWeapon)--夺命三千
	end
	player.RemoveBackPendent(57)--夺命三千挂件
end

-- 荻花刷箱子bug处理：175武器删除
function DHPQ_BugManage_Del175Weapon_2(player)
	if not player then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2011, 2, 24, 0, 0, 0)
	local nEndTime = DateToTime(2013, 2, 24, 7, 0, 0)
	--时间限制
	if nStartTime >= nTime or  nTime >= nEndTime then
		return
	end
	local GV = GetGameVersion();
	if not GV then
		return
	end
	if GV.VersionLineName ~= "zhcn" then
		return
	end
	if GV.VersionEx ~= "" then
		return
	end
	tActivityIndexList = {ACTIVITY_MANAGER.DHBUG_DEL175WEAPON_2}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.DHBUG_DEL175WEAPON_2, true)
end
tActivityRecall[ACTIVITY_MANAGER.DHBUG_DEL175WEAPON_2] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.DHBUG_DEL175WEAPON_2] then
		return
	end
	local nWeapon = 0
	for i = 1, #tDHWeapon175 do--删除所有的武器
		nWeapon = player.GetItemAmountInAllPackages(6, tDHWeapon175[i])
		if nWeapon > 0 then
			player.CostItemInAllPackage(6, tDHWeapon175[i], nWeapon)
		end
	end
	nWeapon = player.GetItemAmountInAllPackages(8, 2427)
	if nWeapon > 0 then
		player.CostItemInAllPackage(8, 2427, nWeapon)--夺命三千
	end
	player.RemoveBackPendent(57)--夺命三千挂件
end

-- 荻花刷箱子bug处理：磨石暗器删除
function DHPQ_BugManage_DelMoShiAnQi(player)
	if not player then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2011, 2, 24, 0, 0, 0)
	local nEndTime = DateToTime(2013, 2, 24, 7, 0, 0)
	--时间限制
	if nStartTime >= nTime or  nTime >= nEndTime then
		return
	end
	local GV = GetGameVersion();
	if not GV then
		return
	end
	if GV.VersionLineName ~= "zhcn" then
		return
	end
	if GV.VersionEx ~= "" then
		return
	end
	tActivityIndexList = {ACTIVITY_MANAGER.DHBUG_DELMOSHIANQI}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.DHBUG_DELMOSHIANQI, true)
end
local tDHMoShi = {
	-- {bossID，所在任务value位置}
	7983,
	7984,
	7985,
	7986,
	7987,
	7988,
	7989,
	7990,
}
local tDHAnQi = {
	-- {bossID，所在任务value位置}
	2837,
	2838,
	2839,
	2840,
	2841,
	2842,
	2843,
	2844,
	2845,
	2846,
}
local MoShiAnQiPrice = 10000
tActivityRecall[ACTIVITY_MANAGER.DHBUG_DELMOSHIANQI] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.DHBUG_DELMOSHIANQI] then
		return
	end

	local nMoShiAnQiCount = tActivityRosterList[ACTIVITY_MANAGER.DHBUG_DELMOSHIANQI][0]
	if  nMoShiAnQiCount <= 0 then
		return
	end
	--惩罚的规则：活动表0号位记载了刷磨石和暗器的总数，脚本扣除磨石和暗器，如果不够数，+buff持续扣钱。
	local nRemain_MoShiAnQi = DHPQ_Del_MoShiAnQi(player, nMoShiAnQiCount)--删除并得到欠账数
	local nMoney = nRemain_MoShiAnQi * MoShiAnQiPrice --欠的钱
	if nMoney <= 0 then
		return
	end
	player.AddBuff(0, 99, 2588, 1)
	local buff = player.GetBuff(2588, 1)
	buff.nCustomValue = nMoney--单位是金
	Log("DiHuaPunish" .. szPlayerName .. "(" .. dwPlayerID .. ")".. "Gold:" ..nMoney)
end
function DHPQ_Del_MoShiAnQi(player, nNum)--先扣除磨石，然后扣暗器.nNum表示需要扣除的数量
	if nNum <= 0 then
		return 0
	end
	local nMoShi = 0
	for i = 1, #tDHMoShi do
		nMoShi = player.GetItemAmountInAllPackages(5, tDHMoShi[i])
		if nNum >= nMoShi then
			player.CostItemInAllPackage(5, tDHMoShi[i], nMoShi)
			nNum = nNum - nMoShi
		else
			player.CostItemInAllPackage(5, tDHMoShi[i], nNum)
			nNum = 0
		end
		if nNum <= 0 then
			break
		end
	end
	if nNum <= 0 then
		return 0
	end
	local nAnQi = 0
	for i = 1, #tDHAnQi do
		nAnQi = player.GetItemAmountInAllPackages(6, tDHAnQi[i])
		if nNum >= nAnQi then
			player.CostItemInAllPackage(6, tDHAnQi[i], nAnQi)

			nNum = nNum - nAnQi
		else
			player.CostItemInAllPackage(6, tDHAnQi[i], nNum)

			nNum = 0
		end
		if nNum <= 0 then
			break
		end
	end
	return nNum --将欠账数返回
end

-- 擂台赛发放奖励
function Leitaisaijiangli_Guanjun(player)
	if not player then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2011, 2, 24, 0, 0, 0)
	local nEndTime = DateToTime(2011, 4, 4, 7, 0, 0)
	--时间限制
	if nStartTime >= nTime or  nTime >= nEndTime then
		return
	end
	local GV = GetGameVersion();
	if not GV then
		return
	end
	if GV.VersionLineName ~= "zhcn" then
		return
	end
	if GV.VersionEx ~= "" then
		return
	end
	tActivityIndexList = {ACTIVITY_MANAGER.LEITAISAIJIANGLI_GUANJUN}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.LEITAISAIJIANGLI_GUANJUN, true)
end

tActivityRecall[ACTIVITY_MANAGER.LEITAISAIJIANGLI_GUANJUN] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.LEITAISAIJIANGLI_GUANJUN] then
		return
	end
	local tItem
	local nChenghaodaoju = tActivityRosterList[ACTIVITY_MANAGER.LEITAISAIJIANGLI_GUANJUN][1]
	if nChenghaodaoju == 1 then
		tItem = {{ITEM_TABLE_TYPE.OTHER, 8312, 1, 0}, }--天下第一帮
		SendSystemMail("隐元会执事", player.szName, "首届帮会擂台赛奖励", player.szName .. "侠士：\n　　见信好！\n　　　恭喜贵帮会在首届帮会擂台赛中一举夺魁，随信附奖品一份，还请笑纳。\n" ..
			"\n\n　　                                         隐元会敬上",
		0, tItem)
		Log("LeiTaiSaiJiangLi_20110224 Player: " .. szPlayerName .. "(" .. dwPlayerID .. ")：天下第一帮")
	end
end

-- 荻花刷箱子bug处理：磨石暗器删除二期
function DHPQ_BugManage_DelMoShiAnQi_2(player)
	if not player then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2011, 2, 24, 0, 0, 0)
	local nEndTime = DateToTime(2013, 2, 24, 7, 0, 0)
	--时间限制
	if nStartTime >= nTime or  nTime >= nEndTime then
		return
	end
	local GV = GetGameVersion();
	if not GV then
		return
	end
	if GV.VersionLineName ~= "zhcn" then
		return
	end
	if GV.VersionEx ~= "" then
		return
	end
	tActivityIndexList = {ACTIVITY_MANAGER.DHBUG_DELMOSHIANQI_2}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.DHBUG_DELMOSHIANQI_2, true)
end

tActivityRecall[ACTIVITY_MANAGER.DHBUG_DELMOSHIANQI_2] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.DHBUG_DELMOSHIANQI_2] then
		return
	end

	local nMoShiAnQiCount = tActivityRosterList[ACTIVITY_MANAGER.DHBUG_DELMOSHIANQI_2][0]
	if  nMoShiAnQiCount <= 0 then
		return
	end
	--惩罚的规则：活动表0号位记载了刷磨石和暗器的总数，脚本扣除磨石和暗器，如果不够数，+buff持续扣钱。
	local nRemain_MoShiAnQi = DHPQ_Del_MoShiAnQi(player, nMoShiAnQiCount)--删除并得到欠账数
	local nMoney = nRemain_MoShiAnQi * MoShiAnQiPrice --欠的钱
	if nMoney <= 0 then
		return
	end
	player.AddBuff(0, 99, 2588, 1)
	local buff = player.GetBuff(2588, 1)
	buff.nCustomValue = nMoney--单位是金
	Log("DiHuaPunish" .. szPlayerName .. "(" .. dwPlayerID .. ")".. "Gold:" ..nMoney)
end

-- 帮会秘境周常任务补偿处理
function DoTongDungeonQuest(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if GV and GV.VersionLineName ~= "zhcn" then --马来版本不补偿
		return
	end
	if GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "snda" then --盛大版本不补偿
		return
	end
	local nTime = GetCurrentTime()
	local nLimitTime = DateToTime(2011, 03, 28, 06, 59, 59)  --补偿截止时间
	if nTime > nLimitTime then  --截止时间之后上线的玩家不补偿
		return
	end

	local tTongDungeonQuest = {
		[61] = {dwQuestID = 6557}, -- 宫中神武遗迹，击退！谢云流任务
		[64] = {dwQuestID = 6558}, -- 25人普通宫中神武遗迹，悬赏！谢云流
	}
	for k, v in pairs(tTongDungeonQuest) do
		if player.GetQuestPhase(tTongDungeonQuest[k].dwQuestID) == 1 then  -- 只有身上有对应副本周常任务的玩家，才发起远程调用
			RemoteCallToCenter("OnApplyPlayerSavedCopysRequest", player.dwID)  -- 发起远程调用申请，在对应的函数中进行补偿操作
			return
		end
	end
end

-- 帮会捐赠资金成就补偿，将之前捐赠的金钱添加进成就计数器
function DoTongGoldAchievement(player)
	if not player then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2011, 3, 31, 7, 0, 0)
	local nEndTime = DateToTime(2011, 5, 16, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return  --时间限制
	end
	tActivityIndexList = {ACTIVITY_MANAGER.TONG_GOLDACHIEVEMENT}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.TONG_GOLDACHIEVEMENT, true)
end
-- 这里是收到服务器验证后将结果返回回来, 用来判断那些人分别都应在成就计数器内增加多少金钱
tActivityRecall[ACTIVITY_MANAGER.TONG_GOLDACHIEVEMENT] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	if tActivityRosterList[ACTIVITY_MANAGER.TONG_GOLDACHIEVEMENT] then
		local nGold = tActivityRosterList[ACTIVITY_MANAGER.TONG_GOLDACHIEVEMENT][0]  -- 获取玩家之前捐赠的金钱数量
		local bNotAnnounce = true  -- 不发布帮会公告
		local player = GetPlayer(dwPlayerID)
		if player then
			local dwTongID = player.dwTongID  -- 传入玩家帮会ID，不做实际用途；无帮会的玩家此ID为0
			OnSaveMoneyInTong(dwPlayerID, dwTongID, nGold, bNotAnnounce)  -- 将玩家及其捐赠金钱数量传入成就计数器函数，更新玩家的成就
			player.SendSystemMessage("隐元会感谢你之前慷慨解囊、为帮会发展捐赠资金的义举，特补足你应获得之成就！")
			Log("DoTongGoldAchievement: " .. szPlayerName .. "(" .. dwPlayerID .. ")帮会捐赠成就已补偿：" .. nGold)
		end
	end
end

-- 帮会捐赠资金成就二次补偿，针对因改名而补偿失败的
function DoTongGoldAchievement2(player)
	if not player then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2011, 4, 14, 7, 0, 0)
	local nEndTime = DateToTime(2011, 5, 16, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return  --时间限制
	end
	tActivityIndexList = {ACTIVITY_MANAGER.TONG_GOLDACHIEVEMENT_2}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.TONG_GOLDACHIEVEMENT_2, true)
end
-- 这里是收到服务器验证后将结果返回回来, 用来判断那些人分别都应在成就计数器内增加多少金钱
tActivityRecall[ACTIVITY_MANAGER.TONG_GOLDACHIEVEMENT_2] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	if tActivityRosterList[ACTIVITY_MANAGER.TONG_GOLDACHIEVEMENT_2] then
		local nGold = tActivityRosterList[ACTIVITY_MANAGER.TONG_GOLDACHIEVEMENT_2][0]  -- 获取玩家之前捐赠的金钱数量
		local bNotAnnounce = true  -- 不发布帮会公告
		local player = GetPlayer(dwPlayerID)
		if player then
			local dwTongID = player.dwTongID  -- 传入玩家帮会ID，不做实际用途；无帮会的玩家此ID为0
			OnSaveMoneyInTong(dwPlayerID, dwTongID, nGold, bNotAnnounce)  -- 将玩家及其捐赠金钱数量传入成就计数器函数，更新玩家的成就
			player.SendSystemMessage("隐元会感谢你之前慷慨解囊、为帮会发展捐赠资金的义举，特补足你应获得之成就！")
			Log("DoTongGoldAchievement2: " .. szPlayerName .. "(" .. dwPlayerID .. ")帮会捐赠成就已补偿：" .. nGold)
		end
	end
end

--2011年5月5日科举刷监本印文及青铜宝箱停机维护补偿
function DoKEJU_BOX_BUG_20110505(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if GV and GV.VersionLineName ~= "zhcn" then --海外版本不补偿
		return
	end
	if GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "snda" then --盛大版本不补偿
		return
	end

	if player.GetCustomInteger1(PLAYER_CUSTOM_VALUE.KEJU_BOX_BUCHANG) ~= 0 then
		return
	elseif player.nLevel >= 20 and player.GetCustomInteger1(PLAYER_CUSTOM_VALUE.KEJU_BOX_BUCHANG) == 0 then  --已满20级并未收到过邮件的玩家符合补偿条件
		local nTime = GetCurrentTime()
		local nLimitTime = DateToTime(2011, 06, 09, 06, 59, 59)  --补偿截止时间
		local tItemOfBUCHANG = {{ITEM_TABLE_TYPE.OTHER, 6258, 15, 0}, {ITEM_TABLE_TYPE.OTHER, 6235, 5, 0}}
		--注：此{ITEM_TABLE_TYPE.OTHER, 6258, 15, 0}中的参数15为道具数量，必须小于道具的最大叠加！
		if nTime > nLimitTime then  --截止时间之后上线的玩家不补偿
			return
		end
		SendSystemMail("隐元会", player.szName, "异常事件致歉信", player.szName .. "：\n　　近日，因不可抗之意外因素给广大侠士带来不便，深感歉意。特补偿诸位监本印文及除滞散若干，敬请验收附件。",
		0, tItemOfBUCHANG)
		player.SetCustomInteger1(PLAYER_CUSTOM_VALUE.KEJU_BOX_BUCHANG, 1)  --标记为已补偿玩家
		Log("DoKEJU_BOX_BUG_20110505: " .. player.szName .. "(" .. player.dwID .. ")补偿邮件：{5, 6258, 15}, {5, 6235, 5}")
	end
end

-- 2011.5.13血龙出渊、太极广场服务器回档获得物品补偿
function ServerRecycleItemReward_20110513(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2011, 5, 13, 0, 0, 0)
	local nEndTime = DateToTime(2011, 6, 13, 0, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return  --时间限制
	end

	tActivityIndexList = {ACTIVITY_MANAGER.SERVER_RECYCLE_WEAPON_1}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.SERVER_RECYCLE_WEAPON_1, true)

	tActivityIndexList = {ACTIVITY_MANAGER.SERVER_RECYCLE_ARMOR_7_1}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.SERVER_RECYCLE_ARMOR_7_1, true)

	tActivityIndexList = {ACTIVITY_MANAGER.SERVER_RECYCLE_ARMOR_8_1}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.SERVER_RECYCLE_ARMOR_8_1, true)
end
-- 这里是收到服务器验证后将结果返回回来, 用来返还物品
-- 以下是武器返还
tActivityRecall[ACTIVITY_MANAGER.SERVER_RECYCLE_WEAPON_1] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	if tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_WEAPON_1] then
		local tItemList, nIndex, nNum = {}, 0, 0
		for i = 0, 5 do
			nIndex = tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_WEAPON_1][i]	-- 武器Index
			if nIndex ~= 0 then
				if nIndex == 1267 or nIndex == 1435 or nIndex == 150 then
					nNum = 200
				else
					nNum = 0
				end
				table.insert(tItemList, {6, nIndex, nNum, 0})
			end
		end
		if #tItemList > 0 then
			ActivitySendItemMail(dwPlayerID, tItemList)
		end
		-- 以下为武器特殊处理部分
		local ServerIP = GetLocalIP()
		if ServerIP == "121.14.64.85" or ServerIP == "121.14.64.84" or ServerIP == "121.14.64.87" or ServerIP == "121.14.64.78" then
			if szPlayerName == "残烟翦翦" then
				ActivitySendItemMail(dwPlayerID, {{6, 2846, 0, 0}})
			end
		end
	end
end

-- 以下是装备返还(dwTabType == 7)
tActivityRecall[ACTIVITY_MANAGER.SERVER_RECYCLE_ARMOR_7_1] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	if tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_ARMOR_7_1] then
		local tItemList, nIndex = {}, 0
		for i = 0, 5 do
			nIndex = tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_ARMOR_7_1][i]	-- Index
			if nIndex ~= 0 then
				table.insert(tItemList, {7, nIndex, 0, 0})
			end
		end
		if #tItemList > 0 then
			ActivitySendItemMail(dwPlayerID, tItemList)
		end
		-- 以下是装备特殊处理
		local ServerIP = GetLocalIP()
		local tExceptionPlayerList = {
			["心肝宝贝肉"] = {{7, 7145, 0, 0}},
			["半糖妃妃"] = {{7, 2849, 0, 0}, {7, 2851, 0, 0}, {7, 4663, 0, 0}},
			["淡夏"] = {{7, 1876, 0, 0}, {7, 4672, 0, 0}},
		}
		if ServerIP == "121.14.64.85" or ServerIP == "121.14.64.84" or ServerIP == "121.14.64.87" or ServerIP == "121.14.64.78" then
			for k, v in pairs(tExceptionPlayerList) do
				if szPlayerName == k then
					ActivitySendItemMail(dwPlayerID, v)
				end
			end
		end
	end
end

-- 以下是装备返还(dwTabType == 8)
tActivityRecall[ACTIVITY_MANAGER.SERVER_RECYCLE_ARMOR_8_1] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	if tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_ARMOR_8_1] then
		local tItemList, nIndex = {}, 0
		for i = 0, 5 do
			nIndex = tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_ARMOR_8_1][i]	-- 武器Index
			if nIndex ~= 0 then
				table.insert(tItemList, {8, nIndex, 0, 0})
			end
		end
		if #tItemList > 0 then
			ActivitySendItemMail(dwPlayerID, tItemList)
		end

		-- 以下为装备特殊处理部分
		local ServerIP = GetLocalIP()
		if ServerIP == "121.14.64.85" or ServerIP == "121.14.64.84" or ServerIP == "121.14.64.87" or ServerIP == "121.14.64.78" then
			if szPlayerName == "乱爷" then
				ActivitySendItemMail(dwPlayerID, {{8, 1250, 0, 0}})
			end
		end
	end
end

function ActivitySendItemMail(dwPlayerID, tItemList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	local szMailText = "：\n      见信好！\n      近日异象频生，以致少侠无法尽情纵马江湖，实感抱歉。随信附上异象发生之时少侠应得的物品，请查收。\n\n      隐元会敬上"
	SendSystemMail("隐元会执掌使", player.szName, player.szName .. "大侠亲启", player.szName .. szMailText, 0, tItemList)
end

-- 2011.5.19 血龙出渊、太极广场服务器回档补偿二期
function ServerRecycleItemReward_20110519(player)
	if not player then
		return
	end
	-- 版本判断，金山版本才处理
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2011, 5, 19, 0, 0, 0)
	local nEndTime = DateToTime(2011, 6, 13, 0, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return  --时间限制
	end

	tActivityIndexList = {ACTIVITY_MANAGER.SERVER_RECYCLE_ITEM_5}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.SERVER_RECYCLE_ITEM_5, true)

	tActivityIndexList = {ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_1}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_1, true)

	tActivityIndexList = {ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_2}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_2, true)

	tActivityIndexList = {ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_3}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_3, true)

	tActivityIndexList = {ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_4}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_4, true)

	tActivityIndexList = {ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_5}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_5, true)

	tActivityIndexList = {ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_6}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_6, true)

	tActivityIndexList = {ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_7}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_7, true)

	tActivityIndexList = {ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_8}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_8, true)

	tActivityIndexList = {ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_9}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_9, true)

	tActivityIndexList = {ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_10}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_10, true)
end

-- 以下是装备牌子返还(dwTabType == 5)
tActivityRecall[ACTIVITY_MANAGER.SERVER_RECYCLE_ITEM_5] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	if tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_ITEM_5] then
		local tItemList, nIndex = {}, 0
		for i = 0, 5 do
			nIndex = tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_ITEM_5][i]	-- 牌子Index
			if nIndex ~= 0 then
				table.insert(tItemList, {5, nIndex, 0, 0})
			end
		end
		if #tItemList > 0 then
			ActivitySendItemMail_20110519(dwPlayerID, tItemList)
		end

		-- 以下是装备牌子特殊处理
		local ServerIP = GetLocalIP()
		local tExceptionPlayerList = {
			["萧逸凡"] = {{5, 7986, 1, 0}, {5, 7986, 1, 0}, {5, 7987, 1, 0}},
			["恶魔天使"] = {{5, 7990, 1, 0}},
			["风月绫"] = {{5, 7988, 1, 0}, {5, 7989, 1, 0}, {5, 7989, 1, 0}},
			["无意莫攀枝"] = {{5, 7988, 1, 0}, {5, 7988, 1, 0}},
			["玉祁连"] = {{5, 7990, 1, 0}},
			["疯了的兔子"] = {{5, 7990, 1, 0}},
			["惜流年"] = {{5, 7983, 1, 0}, {5, 7983, 1, 0}},
		}
		if ServerIP == "121.14.64.85" or ServerIP == "121.14.64.84" or ServerIP == "121.14.64.87" or ServerIP == "121.14.64.78" then
			for k, v in pairs(tExceptionPlayerList) do
				if szPlayerName == k then
					ActivitySendItemMail(dwPlayerID, v)
				end
			end
		end
	end
end

-- 以下是秘籍返还(dwTabType == 5)
tActivityRecall[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_1] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	if tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_1] then
		local tItemList, nIndex, nNum = {}, 0, 0
		for i = 0, 5, 2 do
			nIndex = tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_1][i]	-- 秘籍Index
			nNum = tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_1][i + 1]		-- 秘籍数量
			if nIndex ~= 0 and nNum ~= 0 then
				for j = 1, nNum do
					table.insert(tItemList, {5, nIndex, 0, 0})
					if #tItemList >= 8 then
						ActivitySendItemMail_20110519(dwPlayerID, tItemList)
						tItemList = {}
					end
				end
			end
		end
		if #tItemList > 0 then
			ActivitySendItemMail_20110519(dwPlayerID, tItemList)
		end
	end
end

-- 以下是秘籍返还(dwTabType == 5)
tActivityRecall[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_2] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	if tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_2] then
		local tItemList, nIndex, nNum = {}, 0, 0
		for i = 0, 5, 2 do
			nIndex = tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_2][i]	-- 秘籍Index
			nNum = tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_2][i + 1]		-- 秘籍数量
			if nIndex ~= 0 and nNum ~= 0 then
				for j = 1, nNum do
					table.insert(tItemList, {5, nIndex, 0, 0})
					if #tItemList >= 8 then
						ActivitySendItemMail_20110519(dwPlayerID, tItemList)
						tItemList = {}
					end
				end
			end
		end
		if #tItemList > 0 then
			ActivitySendItemMail_20110519(dwPlayerID, tItemList)
		end
	end
end

-- 以下是秘籍返还(dwTabType == 5)
tActivityRecall[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_3] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	if tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_3] then
		local tItemList, nIndex, nNum = {}, 0, 0
		for i = 0, 5, 2 do
			nIndex = tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_3][i]	-- 秘籍Index
			nNum = tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_3][i + 1]		-- 秘籍数量
			if nIndex ~= 0 and nNum ~= 0 then
				for j = 1, nNum do
					table.insert(tItemList, {5, nIndex, 0, 0})
					if #tItemList >= 8 then
						ActivitySendItemMail_20110519(dwPlayerID, tItemList)
						tItemList = {}
					end
				end
			end
		end
		if #tItemList > 0 then
			ActivitySendItemMail_20110519(dwPlayerID, tItemList)
		end
	end
end

-- 以下是秘籍返还(dwTabType == 5)
tActivityRecall[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_4] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	if tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_4] then
		local tItemList, nIndex, nNum = {}, 0, 0
		for i = 0, 5, 2 do
			nIndex = tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_4][i]	-- 秘籍Index
			nNum = tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_4][i + 1]		-- 秘籍数量
			if nIndex ~= 0 and nNum ~= 0 then
				for j = 1, nNum do
					table.insert(tItemList, {5, nIndex, 0, 0})
					if #tItemList >= 8 then
						ActivitySendItemMail_20110519(dwPlayerID, tItemList)
						tItemList = {}
					end
				end
			end
		end
		if #tItemList > 0 then
			ActivitySendItemMail_20110519(dwPlayerID, tItemList)
		end
	end
end

-- 以下是秘籍返还(dwTabType == 5)
tActivityRecall[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_5] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	if tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_5] then
		local tItemList, nIndex, nNum = {}, 0, 0
		for i = 0, 5, 2 do
			nIndex = tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_5][i]	-- 秘籍Index
			nNum = tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_5][i + 1]		-- 秘籍数量
			if nIndex ~= 0 and nNum ~= 0 then
				for j = 1, nNum do
					table.insert(tItemList, {5, nIndex, 0, 0})
					if #tItemList >= 8 then
						ActivitySendItemMail_20110519(dwPlayerID, tItemList)
						tItemList = {}
					end
				end
			end
		end
		if #tItemList > 0 then
			ActivitySendItemMail_20110519(dwPlayerID, tItemList)
		end
	end
end

-- 以下是秘籍返还(dwTabType == 5)
tActivityRecall[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_6] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	if tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_6] then
		local tItemList, nIndex, nNum = {}, 0, 0
		for i = 0, 5, 2 do
			nIndex = tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_6][i]	-- 秘籍Index
			nNum = tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_6][i + 1]		-- 秘籍数量
			if nIndex ~= 0 and nNum ~= 0 then
				for j = 1, nNum do
					table.insert(tItemList, {5, nIndex, 0, 0})
					if #tItemList >= 8 then
						ActivitySendItemMail_20110519(dwPlayerID, tItemList)
						tItemList = {}
					end
				end
			end
		end
		if #tItemList > 0 then
			ActivitySendItemMail_20110519(dwPlayerID, tItemList)
		end
	end
end

-- 以下是秘籍返还(dwTabType == 5)
tActivityRecall[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_7] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	if tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_7] then
		local tItemList, nIndex, nNum = {}, 0, 0
		for i = 0, 5, 2 do
			nIndex = tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_7][i]	-- 秘籍Index
			nNum = tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_7][i + 1]		-- 秘籍数量
			if nIndex ~= 0 and nNum ~= 0 then
				for j = 1, nNum do
					table.insert(tItemList, {5, nIndex, 0, 0})
					if #tItemList >= 8 then
						ActivitySendItemMail_20110519(dwPlayerID, tItemList)
						tItemList = {}
					end
				end
			end
		end
		if #tItemList > 0 then
			ActivitySendItemMail_20110519(dwPlayerID, tItemList)
		end
	end
end

-- 以下是秘籍返还(dwTabType == 5)
tActivityRecall[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_8] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	if tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_8] then
		local tItemList, nIndex, nNum = {}, 0, 0
		for i = 0, 5, 2 do
			nIndex = tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_8][i]	-- 秘籍Index
			nNum = tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_8][i + 1]		-- 秘籍数量
			if nIndex ~= 0 and nNum ~= 0 then
				for j = 1, nNum do
					table.insert(tItemList, {5, nIndex, 0, 0})
					if #tItemList >= 8 then
						ActivitySendItemMail_20110519(dwPlayerID, tItemList)
						tItemList = {}
					end
				end
			end
		end
		if #tItemList > 0 then
			ActivitySendItemMail_20110519(dwPlayerID, tItemList)
		end
	end
end

-- 以下是秘籍返还(dwTabType == 5)
tActivityRecall[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_9] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	if tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_9] then
		local tItemList, nIndex, nNum = {}, 0, 0
		for i = 0, 5, 2 do
			nIndex = tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_9][i]	-- 秘籍Index
			nNum = tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_9][i + 1]		-- 秘籍数量
			if nIndex ~= 0 and nNum ~= 0 then
				for j = 1, nNum do
					table.insert(tItemList, {5, nIndex, 0, 0})
					if #tItemList >= 8 then
						ActivitySendItemMail_20110519(dwPlayerID, tItemList)
						tItemList = {}
					end
				end
			end
		end
		if #tItemList > 0 then
			ActivitySendItemMail_20110519(dwPlayerID, tItemList)
		end
	end
end

-- 以下是秘籍返还(dwTabType == 5)
tActivityRecall[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_10] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	if tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_10] then
		local tItemList, nIndex, nNum = {}, 0, 0
		for i = 0, 5, 2 do
			nIndex = tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_10][i]	-- 秘籍Index
			nNum = tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_MIJI_5_10][i + 1]		-- 秘籍数量
			if nIndex ~= 0 and nNum ~= 0 then
				for j = 1, nNum do
					table.insert(tItemList, {5, nIndex, 0, 0})
					if #tItemList >= 8 then
						ActivitySendItemMail_20110519(dwPlayerID, tItemList)
						tItemList = {}
					end
				end
			end
		end
		if #tItemList > 0 then
			ActivitySendItemMail_20110519(dwPlayerID, tItemList)
		end
	end
end

function ActivitySendItemMail_20110519(dwPlayerID, tItemList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	local szMailText = "：\n      见信好！\n      前段时日异象突发，以致少侠无法尽情纵马江湖，实感抱歉。随信附上异象发生之时少侠应得物品，请查收。" ..
	"\n\n      隐元会敬上"
	SendSystemMail("隐元会执掌使", player.szName, player.szName .. "大侠亲启", player.szName .. szMailText, 0, tItemList)
end

-- 巴蜀版本掉落异常回收
function BaShuDropError_20110523(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2011, 5, 23, 0, 0, 0)
	local nEndTime = DateToTime(2011, 11, 23, 0, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return  --时间限制
	end
	tActivityIndexList = {ACTIVITY_MANAGER.BASHU_DROP_ERROR}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.BASHU_DROP_ERROR, true)
end

tActivityRecall[ACTIVITY_MANAGER.BASHU_DROP_ERROR] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	if tActivityRosterList[ACTIVITY_MANAGER.BASHU_DROP_ERROR] then
		local player = GetPlayer(dwPlayerID)
		if not player then
			Log("BASHU_DROP_ERROR failed, can't get player: "..dwPlayerID.." "..szPlayerName)
			return
		end
		local tItemList, nAmount, nMoney, nIndex, nNum = {}, 0, 0, 0, 0
		local m, n = 0, 0
		local tItemInfo = {
			[9639] = {nItem = 9539, nStackNum = 5, nMoney = 95300}, --庖丁软骨错误产出天工图：田黄磨石
			[9599] = {nItem = 9699, nStackNum = 20, nMoney = 11435}, --采药虫草错误产出蒜香凤爪
		}
		for i = 0, 3, 2 do
			nIndex = tActivityRosterList[ACTIVITY_MANAGER.BASHU_DROP_ERROR][i]
			nNum = tActivityRosterList[ACTIVITY_MANAGER.BASHU_DROP_ERROR][i + 1]
			if nIndex ~= 0 then
				if nIndex == 9639 then
					m, n = math.modf(nNum / 5)
					n = n * 5
				else
					m, n = math.modf(nNum / 20)
					n = n * 20
				end
				--n = n * 10
				if m > 0 then
					for j = 1, m do
						table.insert(tItemList, {5, tItemInfo[nIndex].nItem, tItemInfo[nIndex].nStackNum, 0})
						if #tItemList >= 8 then
							ActivitySendItemMail_20110523(dwPlayerID, tItemList)
							tItemList = {}
						end
					end
					if #tItemList > 0 then
						ActivitySendItemMail_20110523(dwPlayerID, tItemList)
						tItemList = {}
					end
				end
				if n > 0 then
					ActivitySendItemMail_20110523(dwPlayerID, {{5, tItemInfo[nIndex].nItem, n, 0}})
				end
				nAmount = player.GetItemAmountInAllPackages(5, nIndex)
				if nAmount >= nNum then
					player.CostItemInAllPackage(5, nIndex, nNum)
					Log(
						string.format(
						"PlayerID : %d, PlayerName : %s, BASHU_DROP_ERROR CostItem Success! nNum = %d",
						player.dwID, player.szName, nNum
					)
					)
				else
					player.CostItemInAllPackage(5, nIndex, nAmount)
					nMoney = nMoney + (nNum - nAmount) * tItemInfo[nIndex].nMoney
				end
			end
		end
		if nMoney > 0 then
			player.AddBuff(0, 99, 2985, 1)
			local buff = player.GetBuff(2985, 1)
			if buff then
				buff.nCustomValue = nMoney
			end
			Log(
				string.format(
				"PlayerID : %d, PlayerName : %s, BASHU_DROP_ERROR AddBuff Success! nMoney = %d",
				player.dwID, player.szName, nMoney
			)
			)
		end
	end
end

function ActivitySendItemMail_20110523(dwPlayerID, tItemList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	local szMailText = "：\n      见信好！\n      前段时日异象突发，以致部分掉落异常。部分侠士庖丁应得软骨却因为异常而得到了天工图：田黄磨石，" ..
	"采药应得虫草却不幸得到蒜香凤爪。为此我隐元会深感抱歉，但为江湖之稳定，我们特将侠士异常得到的两件物品扣除并更换为相应物品。" ..
	"对于无法扣除的部分我们会按照相应的售店价格进行扣除。" .. "\n      随信附上少侠应得的物品，请查收。" ..
	"\n\n      隐元会敬上"
	SendSystemMail("隐元会执掌使", player.szName, player.szName .. "大侠亲启", player.szName .. szMailText, 0, tItemList)
end

-- 2011.6.3日服务器回档，补偿寄售通宝的金钱
function ServerRecycle_2011_6_3_ActManage(player)
	if not player then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2011, 6, 13, 7, 0, 0)
	local nEndTime = DateToTime(2011, 9, 13, 7, 0, 0)
	--时间限制
	if nStartTime >= nTime or  nTime >= nEndTime then
		return
	end
	local GV = GetGameVersion();
	if not GV then
		return
	end
	if GV.VersionLineName ~= "zhcn" then
		return
	end
	if GV.VersionEx ~= "" then
		return
	end
	tActivityIndexList = {ACTIVITY_MANAGER.SERVER_RECYCLE_2011_6_3}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.SERVER_RECYCLE_2011_6_3, true)
end

tActivityRecall[ACTIVITY_MANAGER.SERVER_RECYCLE_2011_6_3] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_2011_6_3] then
		return
	end
	local nMoney = tActivityRosterList[ACTIVITY_MANAGER.SERVER_RECYCLE_2011_6_3][0]
	local szMailText = "大侠：\n      见信好！\n      因为2011年6月3日的服务器回档，导致您寄售通宝所得的金钱被回收，我们感到十分抱歉。现将被回收的金钱如数返还给您，请注意查收邮件的附件，谢谢！" ..
	"\n\n      隐元会敬上"
	SendSystemMail("隐元会执掌使", player.szName, player.szName .. "大侠亲启", player.szName .. szMailText, nMoney)
end

-- 美女服送道具活动表
function ServerofBeauty_2011_7_26_ActManage(player)
	if not player then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2011, 7, 26, 7, 0, 0)
	local nEndTime = DateToTime(2011, 9, 26, 7, 0, 0)
	--时间限制
	if nStartTime >= nTime or  nTime >= nEndTime then
		return
	end
	local GV = GetGameVersion();
	if not GV then
		return
	end
	if GV.VersionLineName ~= "zhcn" then
		return
	end
	if GV.VersionEx ~= "" then
		return
	end
	tActivityIndexList = {ACTIVITY_MANAGER.SERVEROFBEAUTY_2011_7_29}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.SERVEROFBEAUTY_2011_7_29, true)
end

tActivityRecall[ACTIVITY_MANAGER.SERVEROFBEAUTY_2011_7_29] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.SERVEROFBEAUTY_2011_7_29] then
		return
	end
	local nLv = tActivityRosterList[ACTIVITY_MANAGER.SERVEROFBEAUTY_2011_7_29][0]--认证等级
	local szMailText = "女侠：\n      见信好！\n      恭喜您通过了认证，随心附送小小奖励，请注意查收！" ..
	"\n\n      隐元会敬上"
	local tItemTable
	if nLv == 1 then--初级
		tItemTable = {{5, 10323, 1, 0}, {5, 8828, 1, 0}, }
	elseif nLv == 2 then--高级
		tItemTable = {{5, 10323, 1, 0}, {5, 8828, 1, 0}, {8, 229, 1, 0}, }
	end
	SendSystemMail("隐元会执掌使", player.szName, player.szName .. "大侠亲启", player.szName .. szMailText, 0, tItemTable)
end

-- 擂台赛发放奖励：第二届
function Leitaisaijiangli_2(player)
	if not player then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2011, 8, 8, 0, 0, 0)
	local nEndTime = DateToTime(2011, 10, 8, 7, 0, 0)
	--时间限制
	if nStartTime >= nTime or  nTime >= nEndTime then
		return
	end
	local GV = GetGameVersion();
	if not GV then
		return
	end
	if GV.VersionLineName ~= "zhcn" then
		return
	end
	if GV.VersionEx ~= "" then
		return
	end
	tActivityIndexList = {ACTIVITY_MANAGER.LEITAISAIJIANGLI_2}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.LEITAISAIJIANGLI_2, true)
end

tActivityRecall[ACTIVITY_MANAGER.LEITAISAIJIANGLI_2] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.LEITAISAIJIANGLI_2] then
		return
	end
	local tItem
	local nChenghaodaoju = tActivityRosterList[ACTIVITY_MANAGER.LEITAISAIJIANGLI_2][0]
	if nChenghaodaoju == 1 then--冠军
		tItem = {{ITEM_TABLE_TYPE.OTHER, 10320, 1, 0}, }
	elseif nChenghaodaoju == 2 then--亚军
		tItem = {{ITEM_TABLE_TYPE.OTHER, 10321, 1, 0}, }
	elseif nChenghaodaoju == 3 then--季军
		tItem = {{ITEM_TABLE_TYPE.OTHER, 10322, 1, 0}, }
	else
		Log("LeiTaiSaiJiangLi2_20110808 Player: " .. szPlayerName .. "(" .. dwPlayerID .. ")：发送奖励错误！")
		return
	end
	SendSystemMail("隐元会执事", player.szName, "首届帮会擂台赛奖励", player.szName .. "侠士：\n　　见信好！\n　　　恭喜贵帮在第二届帮会擂台赛中晋级三甲，随信附奖品一份，还请笑纳。\n" ..
		"\n\n　　                                         隐元会敬上",
	0, tItem)
	Log("LeiTaiSaiJiangLi2_20110808 Player: " .. szPlayerName .. "(" .. dwPlayerID .. ")：天下第一帮")

end

-- 2011年八月赛季帮会个人擂台赛补偿
function TongPersonalGame_20110815(player)
	if not player then
		return
	end

	-- 版本判断，金山版本才处理
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
		return
	end

	local nTime = GetCurrentTime()
	local nEndTime = DateToTime(2011, 9, 1, 0, 0, 0)
	if nTime > nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.TONG_PERSONAL_GMAE_20110815}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.TONG_PERSONAL_GMAE_20110815, true)
end

tActivityRecall[ACTIVITY_MANAGER.TONG_PERSONAL_GMAE_20110815] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.TONG_PERSONAL_GMAE_20110815] then
		return
	end

	if not player.GetBuff(3135, 1) then
		player.AddBuff(0, 99, 3135, 1, 50)	-- buff每24小时一跳
	end

	local buff = player.GetBuff(3135, 1)
	if buff then
		buff.nCustomValue = player.dwTongID
	end
	local szMailText = "：\n      见信好！\n      前几日帮会擂台赛报名官竟擅离职守，以致少侠未能及时报名参赛，实感抱歉。" ..
	"我们现已对报名官进行了严厉的批评和教育，还请少侠谅解。\n      如果九月赛季少侠能代表当前帮会获得擂台赛冠亚军，我隐元会必将为贵帮呈上双倍奖励。" ..
	"随信附上一些小礼物以示歉意，请查收。" ..
	"\n\n      隐元会敬上"
	SendSystemMail("隐元会执掌使", player.szName, player.szName .. "大侠亲启", player.szName .. szMailText, 20000000, {{5, 10303, 20, 0}})
	Log(
		string.format(
			"[20110815TongPersonalGameRedeem]szName:%s,SendSystemMailSuccess!", player.szName
		)
	)
end

-- 20110915通宝回购补偿
function TongBaoRecycle_20110915(player)
	if not player then
		return
	end

	-- 版本判断，金山版本才处理
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
		return
	end

	local nTime = GetCurrentTime()
	local nEndTime = DateToTime(2011, 10, 15, 7, 0, 0)
	if nTime > nEndTime then
		return
	end
end

-- 2011.11.22同品装备兑换纯阳255品装备兑换与结果不一致补偿
function ChangeAmor_20111122(player)
	if not player then
		return
	end

	-- 版本判断，金山版本才处理
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
		return
	end

	local nTime = GetCurrentTime()
	local nEndTime = DateToTime(2012, 5, 1, 0, 0, 0)
	if nTime > nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.PRESTIGE_ARMOR_2011_11_22}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.PRESTIGE_ARMOR_2011_11_22, true)
end

tActivityRecall[ACTIVITY_MANAGER.PRESTIGE_ARMOR_2011_11_22] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.PRESTIGE_ARMOR_2011_11_22] then
		return
	end

	local nStone = tActivityRosterList[ACTIVITY_MANAGER.PRESTIGE_ARMOR_2011_11_22][0]
	local nPrestige = tActivityRosterList[ACTIVITY_MANAGER.PRESTIGE_ARMOR_2011_11_22][1]

	local szMailText = "：\n      见信好！\n      前几日装备兑换商“威龙壹号”把太虚纯阳玩家需要兑换的255品质的装备兑换成其它部位。" ..
	"我们现已对该木甲人进行修复，还请少侠谅解。\n      我们不但会补偿大侠所损失的威望值，也会给出6级石头来补偿大侠装备上所损失的附魔等强化道具。" ..
	"随信附上这些道具可以让大侠得到威望值和石头，请查收。" ..
	"\n\n      隐元会敬上"
	SendSystemMail("隐元会执掌使", player.szName, player.szName .. "大侠亲启", player.szName .. szMailText, 0, {{5, 10869, nStone, 0}, {5, 10302, nPrestige, 0}})
	Log("SendSystemMailSuccess! ChangeAmor_20111122 Player: " .. player.szName)
end

-- 20111124马来合服补偿
function MalaysiaPlayerReward_20111124(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2011, 11, 28, 0, 0, 0)
	local nEndTime = DateToTime(2012, 1, 28, 0, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return  --时间限制
	end

	tActivityIndexList = {ACTIVITY_MANAGER.MALAYSIA_REWARD_20111124}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.MALAYSIA_REWARD_20111124, true)
end

tActivityRecall[ACTIVITY_MANAGER.MALAYSIA_REWARD_20111124] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.MALAYSIA_REWARD_20111124] then
		return
	end

	local nPrefix = tActivityRosterList[ACTIVITY_MANAGER.MALAYSIA_REWARD_20111124][0]
	local nPostfix = tActivityRosterList[ACTIVITY_MANAGER.MALAYSIA_REWARD_20111124][1]
	local nTrinketID = tActivityRosterList[ACTIVITY_MANAGER.MALAYSIA_REWARD_20111124][2]

	if nPrefix ~= 0 and not player.IsDesignationPrefixAcquired(nPrefix) then
		player.AcquireDesignationPrefix(nPrefix)
	end
	if nPostfix ~= 0 and not player.IsDesignationPostfixAcquired(nPostfix) then
		player.AcquireDesignationPostfix(nPostfix)
	end

	-- 1450个监本印文、20W江湖贡献（11524道具20个）、7阶战阶、8W威望（11523道具8个）
	if player.nCamp ~= 0 and player.nTitle < 7 then
		local nAddPoint = math.max(0, 200 - player.nRankPoint)
		player.AddRankPoint(nAddPoint, "OTHER")
		--player.SetTitle(7)
	end

	local tItemList = {
		{5, 11523, 8, 0},
		{5, 11524, 20, 0},
		{5, 6258, 1460, 0},
		{8, nTrinketID, 1, 0},
	}
	player.SendSystemMessage("欢迎来到大唐江湖，为感谢您的支持和厚爱，隐元会特呈上丰厚的礼品，请到信使处查收。")
	local szMailText = "：\n      见信好！\n      欢迎来到大唐江湖，一路走来，我们有过坎坷，有过无奈，但更多的是理解和感动。为感谢您的支持和厚爱，隐元会特为您呈上丰厚的礼品，请查收。" ..
	"\n\n      隐元会敬上"
	SendSystemMail("隐元会执掌使", player.szName, player.szName .. "大侠亲启", player.szName .. szMailText, 0, tItemList)
end

-- 巴蜀风云前流失老玩家回归战阶加速处理
function BSTitleRank_20120112(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
		return  -- 只在国内版本（金山&盛大）做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2012, 1, 12, 7, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2012, 4, 19, 7, 0, 0)  -- 暂定处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end
	tActivityIndexList = {ACTIVITY_MANAGER.BSFY_TitleRank_20120112}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.BSFY_TitleRank_20120112, true)
end

tActivityRecall[ACTIVITY_MANAGER.BSFY_TitleRank_20120112] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.BSFY_TitleRank_20120112] then
		return
	end
	local nPrestige = tActivityRosterList[ACTIVITY_MANAGER.BSFY_TitleRank_20120112][0]
	local nArenaAward = tActivityRosterList[ACTIVITY_MANAGER.BSFY_TitleRank_20120112][1]
	local nJustice = tActivityRosterList[ACTIVITY_MANAGER.BSFY_TitleRank_20120112][2]
	local nStone = tActivityRosterList[ACTIVITY_MANAGER.BSFY_TitleRank_20120112][3]
	player.AddBuff(0, 99, 3671, 1)
	if player.nCamp ~= 0 then
		if nPrestige > 0 then
			player.AddPrestigeRemainSpace(nPrestige)
			player.AddPrestige(nPrestige, "OTHER")
		end
		if nArenaAward > 0 then
			player.AddArenaAward(nArenaAward, "OTHER")
		end
		if nJustice > 0 then
			player.AddJusticeRemainSpace(nJustice)
			player.AddJustice(nJustice, "OTHER")
		end
		if nStone > 0 then
			local nStack = nStone / 50
			local tItemList = {}
			for i = 1, nStack do
				table.insert(tItemList, {ITEM_TABLE_TYPE.OTHER, 7694, 50, 0})
			end
			local szMailText = "：\n      见信好！\n      欢迎来到大唐江湖，一路走来，我们有过坎坷，有过无奈，但更多的是理解和感动。为感谢您的支持和厚爱，隐元会特为您呈上丰厚的礼品，请查收。" ..
			"\n\n      隐元会敬上"
			SendSystemMail("隐元会执掌使", player.szName, player.szName .. "大侠亲启", player.szName .. szMailText, 0, tItemList)
		end
	end
	player.SetCustomInteger1(PLAYER_CUSTOM_VALUE.CAMP_BUG_BUCHANG, 2)
end

-- 20120117春节刷红包处理
function TongBaoRecycle_20120117(player)
	if not player then
		return
	end

	-- 版本判断，金山版本才处理
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
		return
	end

	local nTime = GetCurrentTime()
	local nEndTime = DateToTime(2012, 7, 17, 0, 0, 0)
	if nTime > nEndTime then
		return
	end
end
--]]
-- 延时补偿
function OnTimer(player, nParam1, nParam2)
	if not player then
		return
	end

	if nParam1 == 1 then
		-- 这里是上线的时候参加帮会活动
		-- DoActivityReward_JoinTong_20090909(player)
		-- DoActivityReward_StatTong_20090909(player)

		-- 2010年10月28日监本印文错误补偿，2012.8.6更新时移除
		-- DoZhanhunmiji_20101028(player)
		-- 2010年11月8日监本印文二期补偿处理，2012.8.6更新时移除
		-- DoZhanhunmiji_20101108(player)
		-- 12月27日阵营场景服务器维护补偿
		-- DoCampQuest_20101227(player)

		-- 2011年3月21日-24日帮会秘境周常任务无法完成补偿
		-- DoTongDungeonQuest(player)
		-- 2011年八月赛季帮会个人擂台赛补偿
		-- TongPersonalGame_20110815(player)
		-- 2011.11.22同品装备兑换纯阳255品装备兑换与结果不一致补偿
		-- ChangeAmor_20111122(player)

		player.SetTimer(8, "scripts/Include/ActivityManager.lh", 2, 0)
	elseif nParam1 == 2 then
		-- 中秋活动BUG校正 2009.09.29
		-- DoRemedyMidAutumnAction_20090929(player)
		-- 非法的增加修为		2009.10.12
		-- DoNonlicetHeartAction_20091012(player)
		-- 日轮山城回档			2009.10.12
		-- DoRiLunShanChengCompensateAction_20091012(player)
		-- 补偿20091119马具丢失
		-- DoRemedyMaju_20091119(player)

		-- 百草园上线导致的师徒奖励发送补偿
		-- ShiTuChuShiBuChang_20100628(player)

		-- 2011.5.13血龙出渊、太极广场服务器回档获得物品补偿
		-- ServerRecycleItemReward_20110513(player)
		-- 2011.5.19血龙出渊、太极广场服务器回档获得物品补偿二期
		-- ServerRecycleItemReward_20110519(player)

		player.SetTimer(8, "scripts/Include/ActivityManager.lh", 3, 0)
	elseif nParam1 == 3 then
		-- 2009.12.22 冬至刷钱BUG处理
		-- DongzhiBugPunish_20091222(player)
		-- 2009.12.31 冬至停机修为补偿
		-- Dongzhixiuweibuchang_20091231(player)

		-- 2010.04.21 国悼日修为补偿
		--[[local GV = GetGameVersion()
		if GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "" then
			-- 金山大陆版内容
			Guodaorixiuweibuchang_20100421(player)
		end--]]
		-- 2010.08.17 舟曲泥石流全国哀悼日补偿
		-- DoCountryAiDaoRi_20100817(player)
		-- 2010.08.30 送挂件更新异步事故处理补偿
		-- Chongzhisongguajianmaju_20100830(player)

		-- 2011.1.26 书籍ID转换中扣错的装备补偿
		-- Shujikoucuo_buchang_20110126(player)
		-- 2011.05.20 部分服务器利用威望任务BUG惩罚
		--[[local ServerIP = GetLocalIP()
		if ServerIP == "121.14.64.123" and nLastSaveTime > DateToTime(2010, 2, 1, 20, 0, 0) and nLastSaveTime < DateToTime(2010, 2, 2, 18, 0, 0) then
			for nCoolDownID = 1, 400 do
				player.ClearCDTime(nCoolDownID)
			end

			for nFunctionType = 1, 12 do
				player.DelMultiGroupBuffByFunctionType(nFunctionType)
			end
		end--]]

		player.SetTimer(8, "scripts/Include/ActivityManager.lh", 4, 0)
	elseif nParam1 == 4 then
		-- 2010.01.20 冬至马来西亚刷声望处理
		-- DongzhiMaLaiXiYashengwangkouchu_20100120(player)

		-- 2011年2月18号补偿春节活动中提前2天消失的玩家的梅良玉签和瑞
		-- DoRemedyChunjiehuobi(player)
		-- 荻花刷箱子bug处理：2011.2
		-- DHPQ_BugManage_Del175Weapon(player)
		-- DHPQ_BugManage_Del175Weapon_2(player)
		-- DHPQ_BugManage_DelMoShiAnQi(player)
		-- DHPQ_BugManage_DelMoShiAnQi_2(player)

		-- 擂台赛发放奖励：2011年
		-- Leitaisaijiangli(player)
		-- Leitaisaijiangli_Guanjun(player)
		-- Leitaisaijiangli_2(player)
		-- 帮会捐赠资金成就补偿，补偿时间2011.3.31-2011.5.16
		-- DoTongGoldAchievement(player)
		-- 帮会捐赠资金成就补偿，补偿时间2011.4.14-2011.5.16
		-- DoTongGoldAchievement2(player)
		-- 2011年5月5日科举刷监本印文及青铜宝箱停机维护补偿
		-- DoKEJU_BOX_BUG_20110505(player)

		-- 2012.02.11补偿重奖年后迎归客
		-- ChunJie_ZhongJiang(player)
		-- 2012.02.13补偿海誓山盟
		-- ChunJie_HaiShi(player)

		--player.SetTimer(8, "scripts/Include/ActivityManager.lh", 5, 0) -- 暂时End
	end
end
--[[
-- 2012.02.09送风骨霸刀
function FengGuBaDao(player)
	local nFengGuBaDaoStartTime = DateToTime(2012, 2, 9, 0, 0, 0)
	local nFengGuBaDaoEndTime = DateToTime(2012, 8, 9, 0, 0, 0)
	if not player then
		return
	end
	local nTime = GetCurrentTime()

	--时间限制
	if nFengGuBaDaoStartTime >= nTime or  nTime >= nFengGuBaDaoEndTime then
		return
	end
	local GV = GetGameVersion();
	if not GV then
		return
	end
	if GV.VersionLineName ~= "zhcn" then
		return
	end
	if GV.VersionEx ~= "" then
		return
	end
	tActivityIndexList = {ACTIVITY_MANAGER.FENGGUBADAO_20120209}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.FENGGUBADAO_20120209, true)
end

tActivityRecall[ACTIVITY_MANAGER.FENGGUBADAO_20120209] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	if not tActivityRosterList[ACTIVITY_MANAGER.FENGGUBADAO_20120209] then
		return
	end
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	local szMailText = "侠士：\n      见信好！\n     隐元会秘录有闻，感谢大侠参与《新剑网3》协同美国加州大学开展的“虚拟世界研究：搭建行为预测模型”问卷调查，您的意见将协助我们一起更好地创造这个江湖世界。特此附送风靡江湖“风骨霸刀”作为鉴证，一刀在手，江湖我有！\n     新剑网3，感谢一路有你！\n      隐元会敬上"
	SendSystemMail("隐元会执掌使",
		szPlayerName,
		"风骨霸刀奉上",
		szPlayerName .. szMailText,
	0, 8, 4024, 1)
	Log(("[Activity #%d] %s (%d) Got Reward : [%d, %d]."):format(ACTIVITY_MANAGER.FENGGUBADAO_20120209, szPlayerName, dwPlayerID, 8, 4024))
end

-- 2012.02.11补偿重奖年后迎归客
local nZhongJiangStartTime = DateToTime(2012, 2, 9, 0, 0, 0)
local nZhongJiangEndTime = DateToTime(2012, 2, 20, 7, 0, 0)
function ChunJie_ZhongJiang(player)
	if not player then
		return
	end
	local nTime = GetCurrentTime()

	--时间限制
	if nZhongJiangStartTime >= nTime or  nTime >= nZhongJiangEndTime then
		return
	end
	local GV = GetGameVersion();
	if not GV then
		return
	end
	if GV.VersionLineName ~= "zhcn" then
		return
	end
	if GV.VersionEx ~= "" then
		return
	end
	tActivityIndexList = {ACTIVITY_MANAGER.CHUNJIE_ZHONGJIANG_20120211}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.CHUNJIE_ZHONGJIANG_20120211, true)
end

tActivityRecall[ACTIVITY_MANAGER.CHUNJIE_ZHONGJIANG_20120211] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	if not tActivityRosterList[ACTIVITY_MANAGER.CHUNJIE_ZHONGJIANG_20120211] then
		return
	end
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	local nTime = GetCurrentTime()
	local nCengshu = (nZhongJiangEndTime - nTime) / 60
	if player.nLevel >= 20 and player.GetQuestState(8039) == QUEST_STATE.UNFINISHED then
		for j = 1, 10 do
			player.AddBuff(0, 99, 3688, 1, nCengshu)
		end
		player.ForceFinishQuest(8039)
	end
	Log(("[Activity #%d] %s (%d) Got Buff : [%d, %d]."):format(ACTIVITY_MANAGER.CHUNJIE_ZHONGJIANG_20120211, szPlayerName, dwPlayerID, 3688, 1))
end

-- 2012.02.13补偿海誓山盟
local nHaiShiStartTime = DateToTime(2012, 2, 13, 0, 0, 0)
local nZHaiShiEndTime = DateToTime(2012, 5, 13, 7, 0, 0)
function ChunJie_HaiShi(player)
	if not player then
		return
	end
	local nTime = GetCurrentTime()
	--时间限制
	if nHaiShiStartTime >= nTime or  nTime >= nZHaiShiEndTime then
		return
	end
	local GV = GetGameVersion();
	if not GV then
		return
	end
	if GV.VersionLineName ~= "zhcn" then
		return
	end
	if GV.VersionEx ~= "" then
		return
	end
	tActivityIndexList = {ACTIVITY_MANAGER.CHUNJIE_HAISHISHANMENG_20120211}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.CHUNJIE_HAISHISHANMENG_20120211, true)
end

tActivityRecall[ACTIVITY_MANAGER.CHUNJIE_HAISHISHANMENG_20120211] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	if not tActivityRosterList[ACTIVITY_MANAGER.CHUNJIE_HAISHISHANMENG_20120211] then
		return
	end
	local dwHaiShi = 11785
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	local nCount = player.GetItemAmountInAllPackages(ITEM_TABLE_TYPE.OTHER, dwHaiShi)--当前数量
	local nUse = tActivityRosterList[ACTIVITY_MANAGER.CHUNJIE_HAISHISHANMENG_20120211][0]--使用次数
	local nBuChang = 3 - nUse - nCount
	if nBuChang <= 0 then
		Log(("[Activity #%d] %s (%d) NoReward."):format(ACTIVITY_MANAGER.CHUNJIE_HAISHISHANMENG_20120211, szPlayerName, dwPlayerID))
		return
	end
	nBuChang = nBuChang + 1
	local szMailText = "大侠：\n      见信好！\n      前几日送出的礼物海誓山盟有些异常，望见谅。随信附上新的海誓山盟，请查收。\n\n      隐元会敬上"
	SendSystemMail("隐元会执掌使", player.szName, player.szName .. "大侠亲启",
		player.szName ..szMailText,
	0, 5, dwHaiShi, nBuChang)
	Log(("[Activity #%d] %s (%d) Got Item : [%d, %d]."):format(ACTIVITY_MANAGER.CHUNJIE_HAISHISHANMENG_20120211, szPlayerName, dwPlayerID, dwHaiShi, nBuChang))
end

-- 2012.2.27 国内版更新名剑大会组队规则BUG补偿处理
function BSFY_JJC_20120227(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
		return  -- 只在国内版本（金山&盛大）做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2012, 2, 27, 7, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2012, 3, 27, 7, 0, 0)  -- 暂定处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end
	tActivityIndexList = {ACTIVITY_MANAGER.BSFY_JJC_20120227}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.BSFY_JJC_20120227, true)
end

tActivityRecall[ACTIVITY_MANAGER.BSFY_JJC_20120227] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.BSFY_JJC_20120227] then
		return
	end
	local tItemOfJJC = {{ITEM_TABLE_TYPE.OTHER, 11854, 15, 0}}
	local szMailText = "：\n      见信好！\n      近期调整名剑大会组队规则，导致大侠您之前未参与名剑大会竞赛时退出名剑大会战队而无法加入任何名剑战队。对于给大侠您造成的不便，特补偿名剑币若干，请查收邮件附件。\n      此名剑币道具，在2012年4月1日晨7时前有效，过时将自动消失。若您在此时间点之后才查收邮件，则您的邮件将不包含名剑币道具，敬请见谅。" ..
	"\n\n      隐元会敬上"
	SendSystemMail("隐元会执掌使", player.szName, player.szName .. "大侠亲启", player.szName .. szMailText, 0, tItemOfJJC)
end

-- 2012.5.29忆盈楼补偿
function YYL_ServerRedeem_20120529(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
		return  -- 只在国内版本（金山&盛大）做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2012, 5, 28, 7, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2012, 6, 25, 7, 0, 0)  -- 暂定处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end
	tActivityIndexList = {ACTIVITY_MANAGER.YYL_SERVER_20120529}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.YYL_SERVER_20120529, true)
end

tActivityRecall[ACTIVITY_MANAGER.YYL_SERVER_20120529] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.YYL_SERVER_20120529] then
		return
	end
	local szMailText = "：\n　　见信好！\n　　近日异象频生，以致少侠无法尽情纵马江湖，深感歉意。隐元会特呈以下礼品聊表歉意，请查收。\n\n      隐元会敬上。"
	local tItemList = {
		{ITEM_TABLE_TYPE.OTHER, 11871, 15, 0}, -- 隐元秘宝・风云佩 * 15
		{ITEM_TABLE_TYPE.OTHER, 6258, 100, 0}, -- 监本印文 * 100
		{ITEM_TABLE_TYPE.OTHER, 10869, 2, 0}, -- 隐元宝盒 * 2，可选种类的绑定6级五行石一颗
		{ITEM_TABLE_TYPE.OTHER, 11789, 2, 0}, -- 造化散 * 2
		{ITEM_TABLE_TYPE.OTHER, 10241, 5, 0}, -- 隐元秘宝 * 5
		{ITEM_TABLE_TYPE.OTHER, 11525, 15, 0}, -- 名剑币100 * 15
	}

	SendSystemMail("隐元会执掌使", player.szName, player.szName .. "大侠亲启", player.szName .. szMailText, 0, tItemList)
end

-- 2012.09.10回归账号补偿
function Back_Account_20120910(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
		return  -- 只在国内版本（金山&盛大）做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2012, 9, 13, 7, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2012, 12, 13, 7, 0, 0)  -- 暂定处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end
	tActivityIndexList = {ACTIVITY_MANAGER.BACK_ACCOUNT_20120910}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.BACK_ACCOUNT_20120910, true)
end

tActivityRecall[ACTIVITY_MANAGER.BACK_ACCOUNT_20120910] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.BACK_ACCOUNT_20120910] then
		return
	end
	local szMailText = "：\n　　见信好！\n　　近日异象突发，以致少侠无法尽情纵马江湖，深感歉意。隐元会特呈以下礼品聊表歉意，请查收。\n\n      隐元会敬上。"
	local tItemList = {
		{ITEM_TABLE_TYPE.OTHER, 10304, 20, 0}, -- 侠义值2000
		{ITEM_TABLE_TYPE.OTHER, 6258, 100, 0}, -- 监本印文 * 100
		{ITEM_TABLE_TYPE.OTHER, 10303, 20, 0}, -- 江湖贡献10000
		{ITEM_TABLE_TYPE.OTHER, 10302, 20, 0}, -- 威望10000
		{ITEM_TABLE_TYPE.OTHER, 16686, 5, 0}, -- 战阶积分500
	}

	SendSystemMail("隐元会执掌使", player.szName, player.szName .. "大侠亲启", player.szName .. szMailText, 0, tItemList)
end

-- 三周年调研活动奖励
function GEC_Research_20120917(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
		return  -- 只在国内版本（金山&盛大）做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2012, 9, 20, 7, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2012, 12, 20, 7, 0, 0)  -- 暂定处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end
	tActivityIndexList = {ACTIVITY_MANAGER.GEC_RESEARCH_20120917}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.GEC_RESEARCH_20120917, true)

	tActivityIndexList = {ACTIVITY_MANAGER.GEC_RESEARCH_20120918}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.GEC_RESEARCH_20120918, true)
end

tActivityRecall[ACTIVITY_MANAGER.GEC_RESEARCH_20120917] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.GEC_RESEARCH_20120917] then
		return
	end
	local szMailText = "：\n　　见信好！\n　　感谢少侠参与此次《剑网三》三周年调研活动，万分感谢少侠对《剑网三》的支持。" ..
	"\n　　随信附上三周年专属小头像，请查收。\n\n      隐元会敬上。"
	local tItemList = {
		{8, 2835, 1, 0}, -- 小头像道具
	}

	SendSystemMail("隐元会执掌使", player.szName, player.szName .. "大侠亲启", player.szName .. szMailText, 0, tItemList)
end

tActivityRecall[ACTIVITY_MANAGER.GEC_RESEARCH_20120918] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.GEC_RESEARCH_20120918] then
		return
	end
	local szMailText = "：\n　　见信好！\n　　感谢少侠参与此次《剑网三》三周年调研活动，万分感谢少侠对《剑网三》的支持。" ..
	"\n　　随信附上三周年专属小头像，请查收。\n\n      隐元会敬上。"
	local tItemList = {
		{8, 2835, 1, 0}, -- 小头像道具
	}

	SendSystemMail("隐元会执掌使", player.szName, player.szName .. "大侠亲启", player.szName .. szMailText, 0, tItemList)
end

--]]
-------------------------------------------------JJC--------------------------------------------------------------------
-- 竞技场赛季奖励 2014.4.28
--[[
function JJC_Reward_20140428(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return  -- 只在国内版本（金山&盛大）做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2014, 4, 28, 0, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2014, 7, 28, 0, 0, 0)  -- 暂定处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end
	tActivityIndexList = {ACTIVITY_MANAGER.JJC_REWARD_2V2_20140428}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_REWARD_2V2_20140428, true)

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_REWARD_3V3_20140428}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_REWARD_3V3_20140428, true)

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_REWARD_5V5_20140428}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_REWARD_5V5_20140428, true)
end
-----------------------------------2v2---------------------------------------------------------------------------------
tActivityRecall[ACTIVITY_MANAGER.JJC_REWARD_2V2_20140428] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_2V2_20140428] then
		return
	end

	local nScriptFlag = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_2V2_20140428][1]
	local szMailText = string.format(
		"【%s】侠士，您好：" ..
		"\n　　您的角色由于在上届名剑大会赛季期间非法修改客户端进行不公平竞技，因而无法获得相应赛季排名奖励。" ..
		"我们将一如既往坚决打击所有利用非法手段获得不正当利益的行为，为广大玩家提供一个健康公平的游戏环境！" ..
		"\n　　我们恳请侠士务必爱护自己的游戏账号，健康公平地畅游大唐江湖，且行且珍惜！" ..
		"\n　　最后，预祝侠士在新一届名剑大会中再接再厉，通过自己的努力再获佳绩！" ..
		"\n\n　　《剑网3》运营团队", szPlayerName
	)
	if nScriptFlag == 1 then
		SendSystemMail("《剑网3》运营团队", szPlayerName, "最新名剑大会赛季排名说明", szMailText)
		return
	end

	local nPersonalScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_2V2_20140428][0]
	local nTeamScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_2V2_20140428][3]
	local nTeamRank = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_2V2_20140428][2]

	szMailText = string.format(
		"　　倚剑狂歌战九州，抹刀不舞定江湖！" ..
		"\n　　恭喜您，【%s】大侠！您的战队在上届名剑大会2对2战中，以%d点积分取得了第%d名的优秀战绩，" ..
		"其中您的个人贡献点为%d（并且不低于队伍积分200点）。" ..
		"\n　　我们特为您发放上届名剑大会赛季排名奖励。" ..
		"\n　　为了给广大侠士提供一个健康公平的游戏环境，此次排名排除了所有在赛季期间利用非法手段不公平竞技的角色排名。" ..
		"让我们共同努力，为维护游戏公平竞技不懈努力！" ..
		"\n　　预祝您在新的名剑大会赛季中战无不胜！ " ..
		"\n\n　　《剑网3》运营团队",
		szPlayerName, nTeamScore, nTeamRank, nPersonalScore
	)

	local nGrade = 1
	local tItem = {
		[1] = {{5, 21318, 1, 0}, {8, 11349, 1, 0}, {8, 11350, 1, 0}},
		[2] = {{5, 21319, 1, 0}, {8, 11349, 1, 0}, {8, 11350, 1, 0}},
		[3] = {{5, 21320, 1, 0}, {8, 11350, 1, 0}},
	}

	if nTeamRank <= 3 then
		nGrade = 1
	elseif nTeamRank <= 50 then
		nGrade = 2
	else
		nGrade = 3
	end

	if not tItem[nGrade] then
		return
	end

	SendSystemMail("《剑网3》运营团队", player.szName, "上届名剑大会赛季排名说明", szMailText, 0, tItem[nGrade])
end
-----------------------------------3v3---------------------------------------------------------------------------------
tActivityRecall[ACTIVITY_MANAGER.JJC_REWARD_3V3_20140428] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_3V3_20140428] then
		return
	end

	local nScriptFlag = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_3V3_20140428][1]
	local szMailText = string.format(
		"【%s】侠士，您好：" ..
		"\n　　您的角色由于在上届名剑大会赛季期间非法修改客户端进行不公平竞技，因而无法获得相应赛季排名奖励。" ..
		"我们将一如既往坚决打击所有利用非法手段获得不正当利益的行为，为广大玩家提供一个健康公平的游戏环境！" ..
		"\n　　我们恳请侠士务必爱护自己的游戏账号，健康公平地畅游大唐江湖，且行且珍惜！" ..
		"\n　　最后，预祝侠士在新一届名剑大会中再接再厉，通过自己的努力再获佳绩！" ..
		"\n\n　　《剑网3》运营团队", szPlayerName
	)
	if nScriptFlag == 1 then
		SendSystemMail("《剑网3》运营团队", szPlayerName, "最新名剑大会赛季排名说明", szMailText)
		return
	end

	local nPersonalScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_3V3_20140428][0]
	local nTeamScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_3V3_20140428][3]
	local nTeamRank = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_3V3_20140428][2]

	szMailText = string.format(
		"　　倚剑狂歌战九州，抹刀不舞定江湖！" ..
		"\n　　恭喜您，【%s】大侠！您的战队在上届名剑大会3对3战中，以%d点积分取得了第%d名的优秀战绩，" ..
		"其中您的个人贡献点为%d（并且不低于队伍积分200点）。" ..
		"\n　　我们特为您发放上届名剑大会赛季排名奖励。" ..
		"\n　　为了给广大侠士提供一个健康公平的游戏环境，此次排名排除了所有在赛季期间利用非法手段不公平竞技的角色排名。" ..
		"让我们共同努力，为维护游戏公平竞技不懈努力！" ..
		"\n　　预祝您在新的名剑大会赛季中战无不胜！ " ..
		"\n\n　　《剑网3》运营团队",
		szPlayerName, nTeamScore, nTeamRank, nPersonalScore
	)

	local nGrade = 1
	local tItem = {
		[1] = {{5, 21318, 1, 0}, {8, 11349, 1, 0}, {8, 11350, 1, 0}},
		[2] = {{5, 21319, 1, 0}, {8, 11349, 1, 0}, {8, 11350, 1, 0}},
		[3] = {{5, 21320, 1, 0}, {8, 11350, 1, 0}},
	}

	if nTeamRank <= 3 then
		nGrade = 1
	elseif nTeamRank <= 50 then
		nGrade = 2
	else
		nGrade = 3
	end

	if not tItem[nGrade] then
		return
	end

	SendSystemMail("《剑网3》运营团队", player.szName, "上届名剑大会赛季排名说明", szMailText, 0, tItem[nGrade])
end
-----------------------------------5v5---------------------------------------------------------------------------------
tActivityRecall[ACTIVITY_MANAGER.JJC_REWARD_5V5_20140428] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_5V5_20140428] then
		return
	end

	local nScriptFlag = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_5V5_20140428][1]
	local szMailText = string.format(
		"【%s】侠士，您好：" ..
		"\n　　您的角色由于在上届名剑大会赛季期间非法修改客户端进行不公平竞技，因而无法获得相应赛季排名奖励。" ..
		"我们将一如既往坚决打击所有利用非法手段获得不正当利益的行为，为广大玩家提供一个健康公平的游戏环境！" ..
		"\n　　我们恳请侠士务必爱护自己的游戏账号，健康公平地畅游大唐江湖，且行且珍惜！" ..
		"\n　　最后，预祝侠士在新一届名剑大会中再接再厉，通过自己的努力再获佳绩！" ..
		"\n\n　　《剑网3》运营团队", szPlayerName
	)
	if nScriptFlag == 1 then
		SendSystemMail("《剑网3》运营团队", szPlayerName, "最新名剑大会赛季排名说明", szMailText)
		return
	end

	local nPersonalScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_5V5_20140428][0]
	local nTeamScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_5V5_20140428][3]
	local nTeamRank = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_5V5_20140428][2]

	szMailText = string.format(
		"　　倚剑狂歌战九州，抹刀不舞定江湖！" ..
		"\n　　恭喜您，【%s】大侠！您的战队在上届名剑大会5对5战中，以%d点积分取得了第%d名的优秀战绩，" ..
		"其中您的个人贡献点为%d（并且不低于队伍积分200点）。" ..
		"\n　　我们特为您发放上届名剑大会赛季排名奖励。" ..
		"\n　　为了给广大侠士提供一个健康公平的游戏环境，此次排名排除了所有在赛季期间利用非法手段不公平竞技的角色排名。" ..
		"让我们共同努力，为维护游戏公平竞技不懈努力！" ..
		"\n　　预祝您在新的名剑大会赛季中战无不胜！ " ..
		"\n\n　　《剑网3》运营团队",
		szPlayerName, nTeamScore, nTeamRank, nPersonalScore
	)

	local nGrade = 1
	local tItem = {
		[1] = {{5, 21318, 1, 0}, {8, 11349, 1, 0}, {8, 11350, 1, 0}},
		[2] = {{5, 21319, 1, 0}, {8, 11349, 1, 0}, {8, 11350, 1, 0}},
		[3] = {{5, 21320, 1, 0}, {8, 11350, 1, 0}},
	}

	if nTeamRank <= 3 then
		nGrade = 1
	elseif nTeamRank <= 50 then
		nGrade = 2
	else
		nGrade = 3
	end

	if not tItem[nGrade] then
		return
	end

	SendSystemMail("《剑网3》运营团队", player.szName, "上届名剑大会赛季排名说明", szMailText, 0, tItem[nGrade])
end
--]]
-- 竞技场赛季前200的漏发、改名、转服的补发奖励
function JJC_Repair_20140428(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return  -- 只在国内版本（金山&盛大）做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2014, 5, 01, 0, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2014, 8, 01, 0, 0, 0)  -- 暂定处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end
	tActivityIndexList = {ACTIVITY_MANAGER.JJC_REPAIR_2V2_20140428}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_REPAIR_2V2_20140428, true)

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_REPAIR_3V3_20140428}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_REPAIR_3V3_20140428, true)

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_REPAIR_5V5_20140428}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_REPAIR_5V5_20140428, true)
end
-----------------------------------2v2---------------------------------------------------------------------------------
tActivityRecall[ACTIVITY_MANAGER.JJC_REPAIR_2V2_20140428] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_REPAIR_2V2_20140428] then
		return
	end

	local nScriptFlag = tActivityRosterList[ACTIVITY_MANAGER.JJC_REPAIR_2V2_20140428][1]
	local szMailText = string.format(
		GetEditorString(4, 6162) ..
		GetEditorString(4, 6163) ..
		GetEditorString(4, 6164) ..
		GetEditorString(6, 5036) ..
		GetEditorString(4, 6166) ..
		GetEditorString(4, 6167), szPlayerName
	)
	if nScriptFlag == 1 then
		SendSystemMail(GetEditorString(4, 5837), szPlayerName, GetEditorString(4, 6168), szMailText)
		return
	end

	local nPersonalScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REPAIR_2V2_20140428][0]
	local nTeamScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REPAIR_2V2_20140428][3]
	local nTeamRank = tActivityRosterList[ACTIVITY_MANAGER.JJC_REPAIR_2V2_20140428][2]

	szMailText = string.format(
		GetEditorString(6, 5039) ..
		GetEditorString(4, 6170) ..
		GetEditorString(4, 6171) ..
		GetEditorString(6, 5041) ..
		GetEditorString(4, 6173) ..
		GetEditorString(4, 6174) ..
		GetEditorString(4, 6175) ..
		GetEditorString(4, 6167),
		szPlayerName, nTeamScore, nTeamRank, nPersonalScore
	)

	local nGrade = 1
	local tItem = {
		[1] = {{5, 21318, 1, 0}, {8, 11349, 1, 0}, {8, 11350, 1, 0}},
		[2] = {{5, 21319, 1, 0}, {8, 11349, 1, 0}, {8, 11350, 1, 0}},
		[3] = {{5, 21320, 1, 0}, {8, 11350, 1, 0}},
	}

	if nTeamRank <= 3 then
		nGrade = 1
	elseif nTeamRank <= 50 then
		nGrade = 2
	else
		nGrade = 3
	end

	if not tItem[nGrade] then
		return
	end

	SendSystemMail(GetEditorString(4, 5837), player.szName, GetEditorString(4, 6176), szMailText, 0, tItem[nGrade])
end
-----------------------------------3v3---------------------------------------------------------------------------------
tActivityRecall[ACTIVITY_MANAGER.JJC_REPAIR_3V3_20140428] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_REPAIR_3V3_20140428] then
		return
	end

	local nScriptFlag = tActivityRosterList[ACTIVITY_MANAGER.JJC_REPAIR_3V3_20140428][1]
	local szMailText = string.format(
		GetEditorString(4, 6162) ..
		GetEditorString(4, 6163) ..
		GetEditorString(4, 6164) ..
		GetEditorString(6, 5036) ..
		GetEditorString(4, 6166) ..
		GetEditorString(4, 6167), szPlayerName
	)
	if nScriptFlag == 1 then
		SendSystemMail(GetEditorString(4, 5837), szPlayerName, GetEditorString(4, 6168), szMailText)
		return
	end

	local nPersonalScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REPAIR_3V3_20140428][0]
	local nTeamScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REPAIR_3V3_20140428][3]
	local nTeamRank = tActivityRosterList[ACTIVITY_MANAGER.JJC_REPAIR_3V3_20140428][2]

	szMailText = string.format(
		GetEditorString(6, 5039) ..
		GetEditorString(4, 6177) ..
		GetEditorString(4, 6171) ..
		GetEditorString(6, 5041) ..
		GetEditorString(4, 6173) ..
		GetEditorString(4, 6174) ..
		GetEditorString(4, 6175) ..
		GetEditorString(4, 6167),
		szPlayerName, nTeamScore, nTeamRank, nPersonalScore
	)

	local nGrade = 1
	local tItem = {
		[1] = {{5, 21318, 1, 0}, {8, 11349, 1, 0}, {8, 11350, 1, 0}},
		[2] = {{5, 21319, 1, 0}, {8, 11349, 1, 0}, {8, 11350, 1, 0}},
		[3] = {{5, 21320, 1, 0}, {8, 11350, 1, 0}},
	}

	if nTeamRank <= 3 then
		nGrade = 1
	elseif nTeamRank <= 50 then
		nGrade = 2
	else
		nGrade = 3
	end

	if not tItem[nGrade] then
		return
	end

	SendSystemMail(GetEditorString(4, 5837), player.szName, GetEditorString(4, 6176), szMailText, 0, tItem[nGrade])
end
-----------------------------------5v5---------------------------------------------------------------------------------
tActivityRecall[ACTIVITY_MANAGER.JJC_REPAIR_5V5_20140428] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_REPAIR_5V5_20140428] then
		return
	end

	local nScriptFlag = tActivityRosterList[ACTIVITY_MANAGER.JJC_REPAIR_5V5_20140428][1]
	local szMailText = string.format(
		GetEditorString(4, 6162) ..
		GetEditorString(4, 6163) ..
		GetEditorString(4, 6164) ..
		GetEditorString(6, 5036) ..
		GetEditorString(4, 6166) ..
		GetEditorString(4, 6167), szPlayerName
	)
	if nScriptFlag == 1 then
		SendSystemMail(GetEditorString(4, 5837), szPlayerName, GetEditorString(4, 6168), szMailText)
		return
	end

	local nPersonalScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REPAIR_5V5_20140428][0]
	local nTeamScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REPAIR_5V5_20140428][3]
	local nTeamRank = tActivityRosterList[ACTIVITY_MANAGER.JJC_REPAIR_5V5_20140428][2]

	szMailText = string.format(
		GetEditorString(6, 5039) ..
		GetEditorString(4, 6178) ..
		GetEditorString(4, 6171) ..
		GetEditorString(6, 5041) ..
		GetEditorString(4, 6173) ..
		GetEditorString(4, 6174) ..
		GetEditorString(4, 6175) ..
		GetEditorString(4, 6167),
		szPlayerName, nTeamScore, nTeamRank, nPersonalScore
	)

	local nGrade = 1
	local tItem = {
		[1] = {{5, 21318, 1, 0}, {8, 11349, 1, 0}, {8, 11350, 1, 0}},
		[2] = {{5, 21319, 1, 0}, {8, 11349, 1, 0}, {8, 11350, 1, 0}},
		[3] = {{5, 21320, 1, 0}, {8, 11350, 1, 0}},
	}

	if nTeamRank <= 3 then
		nGrade = 1
	elseif nTeamRank <= 50 then
		nGrade = 2
	else
		nGrade = 3
	end

	if not tItem[nGrade] then
		return
	end

	SendSystemMail(GetEditorString(4, 5837), player.szName, GetEditorString(4, 6176), szMailText, 0, tItem[nGrade])
end

--[[
------------------------------------明教预热活动补偿-----------------------------------------------
-- 明教预热活动补偿
function MingJiaoYuReRedeem_20121129(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
		return  -- 只在国内版本（金山&盛大）做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2012, 12, 3, 0, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2013, 1, 3, 0, 0, 0)  -- 暂定处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end

	tActivityIndexList = {ACTIVITY_MANAGER.ACTIVITY_REDEEM_20121129}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.ACTIVITY_REDEEM_20121129, true)
end

tActivityRecall[ACTIVITY_MANAGER.ACTIVITY_REDEEM_20121129] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.ACTIVITY_REDEEM_20121129] then
		return
	end

	local nNum = tActivityRosterList[ACTIVITY_MANAGER.ACTIVITY_REDEEM_20121129][0]
	local nSendIndex, nMod = math.modf(nNum / 5)
	nMod = math.ceil(nMod * 5)
	local szMailText = "：\n　　见信好！\n　　近日异象突发，以致少侠玲珑宝箱被迫消失，深感歉意。" ..
	"隐元会特呈以下礼品聊表歉意，请查收。\n\n      隐元会敬上。"

	for i = 1, nSendIndex do
		SendSystemMail("隐元会执掌使", szPlayerName, szPlayerName .. "亲启",
		szPlayerName .. szMailText, 0, {{5, 17683, 5, 0}})
	end

	if nMod > 0 then
		SendSystemMail("隐元会执掌使", szPlayerName, szPlayerName .. "亲启",
		szPlayerName .. szMailText, 0, {{5, 17683, nMod, 0}})
	end
end

-----------------------------------竞技场恶性代打惩罚--------------------------------------------------
-- 竞技场恶性代打惩罚
function JJC_Punishment_20121218(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
		return  -- 只在国内版本（金山&盛大）做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2012, 12, 27, 7, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2013, 3, 27, 7, 0, 0)  -- 暂定处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_PUNISHMENT_20121218}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_PUNISHMENT_20121218, true)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_PUNISHMENT_20121218] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_PUNISHMENT_20121218] then
		return
	end

	-- 删除装备
	for _, v in pairs(JJC_EQUIPMENT_325) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end

	-- 清除名剑币
	local nArenaAward = player.nArenaAward
	player.AddArenaAward(-nArenaAward, "OTHER")

	local szMailText = "：\n　　见信好！\n　　前段时日隐元会查出少侠恶意代打竞技场，为了维护竞技场的公平原则，" ..
	"特将少侠已获得的325品竞技场装备没收，同时清除所有名剑币！\n　　望少侠以后能谨遵竞技场规则，" ..
	"为江湖营造一个公平公正的竞技环境！\n\n      隐元会敬上。"
	SendSystemMail("隐元会执掌使", szPlayerName, "竞技场代打惩罚",
	szPlayerName .. szMailText)
	player.SendSystemMessage("因少侠恶意代打竞技场，特删除少侠已获得的325品竞技场装备，同时清除所有名剑币！" ..
		"望少侠谨遵竞技场规则，为江湖营造一个公平公正的竞技环境！"
	)
end

-----------------------------------竞技场恶性代打惩罚--------------------------------------------------
-- 竞技场恶性代打惩罚_二期
function JJC_Punishment_20130130(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
		return  -- 只在国内版本（金山&盛大）做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2013, 1, 31, 7, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2013, 5, 31, 7, 0, 0)  -- 暂定处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_PUNISHMENT_20130130}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_PUNISHMENT_20130130, true)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_PUNISHMENT_20130130] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_PUNISHMENT_20130130] then
		return
	end

	local dwRecordID = tActivityRosterList[ACTIVITY_MANAGER.JJC_PUNISHMENT_20130130][0]
	if dwRecordID ~= dwPlayerID then
		return
	end

	-- 删除装备
	for _, v in pairs(JJC_EQUIPMENT_325) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end

	-- 清除名剑币、踢出战队
	local nArenaAward = player.nArenaAward
	player.AddArenaAward(-nArenaAward, "OTHER")

	for i =0, 2 do
		GCCommand("SendGMCommondArenaServer(\"ForceDelMember('" ..player.dwCorpsSystemID.. "','" .. i .."')\")")
	end

	local szMailText = "：\n　　见信好！\n　　前段时日隐元会查出少侠参与名剑大会时使用非法宏，为了维护名剑大会的公平原则，" ..
	"特将少侠已获得的325品名剑大会装备没收，清除所有名剑币，同时清除少侠的名剑战队积分和个人积分！" ..
	"\n　　望少侠以后能谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！\n\n      隐元会敬上。"
	SendSystemMail("隐元会执掌使", szPlayerName, "使用非法宏处罚",
	szPlayerName .. szMailText)
	player.SendSystemMessage("因少侠使用非法宏，特删除少侠已获得的325品名剑大会装备，清除所有名剑币，" ..
		"同时清除少侠的名剑战队积分和个人积分！望少侠谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！"
	)
	Log(
		string.format(
		"[JJC_PUNISHMENT_20130130]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID
	)
	)
end

--------------------------------------台湾版JJC奖励发放--------------------------------------------
-- 台湾版竞技场奖励 2013.2.19
function JJC_Reward_TW_20130219(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhtw") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2013, 2, 20, 7, 0, 0)
	local nEndTime = DateToTime(2013, 5, 20, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_REWARD_TW2V2_20130219}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_REWARD_TW2V2_20130219, true)

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_REWARD_TW3V3_20130219}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_REWARD_TW3V3_20130219, true)

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_REWARD_TW5V5_20130219}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_REWARD_TW5V5_20130219, true)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_REWARD_TW2V2_20130219] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_TW2V2_20130219] then
		return
	end

	local nPersonalScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_TW2V2_20130219][0]
	local nTeamType = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_TW2V2_20130219][1]
	local nTeamRank = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_TW2V2_20130219][2]
	local nTeamScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_TW2V2_20130219][3]

	SendJJCRewardByActivityList(player, nPersonalScore, nTeamType, nTeamRank, nTeamScore)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_REWARD_TW3V3_20130219] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_TW3V3_20130219] then
		return
	end

	local nPersonalScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_TW3V3_20130219][0]
	local nTeamType = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_TW3V3_20130219][1]
	local nTeamRank = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_TW3V3_20130219][2]
	local nTeamScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_TW3V3_20130219][3]

	SendJJCRewardByActivityList(player, nPersonalScore, nTeamType, nTeamRank, nTeamScore)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_REWARD_TW5V5_20130219] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_TW5V5_20130219] then
		return
	end

	local nPersonalScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_TW5V5_20130219][0]
	local nTeamType = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_TW5V5_20130219][1]
	local nTeamRank = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_TW5V5_20130219][2]
	local nTeamScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_TW5V5_20130219][3]

	SendJJCRewardByActivityList(player, nPersonalScore, nTeamType, nTeamRank, nTeamScore)
end

function SendJJCRewardByActivityList(player, nPersonalScore, nTeamType, nTeamRank, nTeamScore)
	local tTypeName = {
		[22] = "2对2",
		[33] = "3对3",
		[55] = "5对5",
	}
	if not tTypeName[nTeamType] then
		Log(
			string.format(
			"[JJC_REWARD_TW_20130219]: PlayerName:%s, TeamTypeError!", player.szName
		)
		)
		return
	end

	local szMailText = string.format(
		"　　天外七星悬北斗，九州论剑斩鳌头！" ..
		"\n　　恭喜您，【%s】大侠！您的战队在上届名剑大会%s战中，以%d点积分取得了第%d名的优秀战绩，" ..
		"其中您的个人贡献点为%d（并且不低于队伍积分200点）。" ..
		"\n　　随信附上您上届名剑大会赛季排名奖励，请查收。" ..
		"\n　　预祝您在新的名剑大会赛季中战无不胜！ " ..
		"\n\n　　《剑网3》运营团队",
		player.szName, tTypeName[nTeamType], nTeamScore, nTeamRank, nPersonalScore
	)

	local nGrade = 1
	local tItem = {
		[1] = {{5, 17713, 1, 0}, {8, 6285, 1, 0}, {8, 6972, 1, 0}},
		[2] = {{5, 17714, 1, 0}, {8, 6285, 1, 0}, {8, 6972, 1, 0}},
		[3] = {{5, 17715, 1, 0}, {8, 6972, 1, 0}},
	}

	if nTeamRank <= 3 then
		nGrade = 1
	elseif nTeamRank <= 50 then
		nGrade = 2
	else
		nGrade = 3
	end

	if not tItem[nGrade] then
		return
	end

	SendSystemMail("《剑网3》运营团队", player.szName, "上届名剑大会赛季排名说明", szMailText, 0, tItem[nGrade])
end

--------------------------JJC恶性代打惩罚------------------------------------
-- 2013年3月竞技场恶性代打惩罚
function JJC_Punishment_20130322(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2013, 3, 25, 7, 0, 0)
	local nEndTime = DateToTime(2013, 6, 25, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_PUNISHMENT_20130322}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_PUNISHMENT_20130322, true)

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_PUNISHMENT_20130325}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_PUNISHMENT_20130325, true)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_PUNISHMENT_20130322] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_PUNISHMENT_20130322] then
		return
	end

	-- 删除装备
	for _, v in pairs(JJC_EQUIPMENT_325) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end

	-- 清除名剑币、踢出战队
	local nArenaAward = player.nArenaAward
	player.AddArenaAward(-nArenaAward, "OTHER")

	for i =0, 2 do
		GCCommand("SendGMCommondArenaServer(\"ForceDelMember('" ..player.dwCorpsSystemID.. "','" .. i .."')\")")
	end

	local szMailText = "：\n　　见信好！\n　　前段时日隐元会查出少侠参与名剑大会时使用非法宏，为了维护名剑大会的公平原则，" ..
	"特将少侠已获得的325品名剑大会装备没收，清除所有名剑币，同时清除少侠的名剑战队积分和个人积分！" ..
	"\n　　望少侠以后能谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！\n\n      隐元会敬上。"
	SendSystemMail("隐元会执掌使", szPlayerName, "使用非法宏处罚",
	szPlayerName .. szMailText)
	player.SendSystemMessage("因少侠使用非法宏，特删除少侠已获得的325品名剑大会装备，清除所有名剑币，" ..
		"同时清除少侠的名剑战队积分和个人积分！望少侠谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！"
	)
	Log(
		string.format(
		"[JJC_PUNISHMENT_20130322]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID
	)
	)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_PUNISHMENT_20130325] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_PUNISHMENT_20130325] then
		return
	end

	-- 删除装备
	for _, v in pairs(JJC_EQUIPMENT_325) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end

	-- 清除名剑币、踢出战队
	local nArenaAward = player.nArenaAward
	player.AddArenaAward(-nArenaAward, "OTHER")

	for i =0, 2 do
		GCCommand("SendGMCommondArenaServer(\"ForceDelMember('" ..player.dwCorpsSystemID.. "','" .. i .."')\")")
	end

	local szMailText = "：\n　　见信好！\n　　前段时日隐元会查出少侠恶意代打竞技场，为了维护竞技场的公平原则，" ..
	"特将少侠已获得的325品竞技场装备没收，同时清除所有名剑币、名剑战队积分和个人积分！\n　　望少侠以后能谨遵竞技场规则，" ..
	"为江湖营造一个公平公正的竞技环境！\n\n      隐元会敬上。"
	SendSystemMail("隐元会执掌使", szPlayerName, "竞技场代打惩罚",
	szPlayerName .. szMailText)
	player.SendSystemMessage("因少侠恶意代打竞技场，特删除少侠已获得的325品竞技场装备，同时清除所有名剑币、" ..
		"名剑战队积分和个人积分！望少侠谨遵竞技场规则，为江湖营造一个公平公正的竞技环境！"
	)
	Log(
		string.format(
		"[JJC_PUNISHMENT_20130325]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID
	)
	)
end

-----------------------------------------------------JJC代打惩罚-------------------------------------------------------
-- 2013年4月竞技场恶性代打惩罚
function JJC_Punishment_20130423(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2013, 4, 25, 7, 0, 0)
	local nEndTime = DateToTime(2013, 7, 25, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_PUNISHMENT_20130423}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_PUNISHMENT_20130423, true)

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_PUNISHMENT_20130424}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_PUNISHMENT_20130424, true)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_PUNISHMENT_20130423] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_PUNISHMENT_20130423] then
		return
	end

	-- 删除装备
	for _, v in pairs(JJC_EQUIPMENT_325) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end

	-- 清除名剑币、踢出战队
	local nArenaAward = player.nArenaAward
	player.AddArenaAward(-nArenaAward, "OTHER")

	for i =0, 2 do
		GCCommand("SendGMCommondArenaServer(\"ForceDelMember('" ..player.dwCorpsSystemID.. "','" .. i .."')\")")
	end

	local szMailText = "：\n　　见信好！\n　　前段时日隐元会查出少侠参与名剑大会时使用非法宏，为了维护名剑大会的公平原则，" ..
	"特将少侠已获得的325品名剑大会装备没收，清除所有名剑币，同时清除少侠的名剑战队积分和个人积分！" ..
	"\n　　望少侠以后能谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！\n\n      隐元会敬上。"
	SendSystemMail("隐元会执掌使", szPlayerName, "使用非法宏处罚",
	szPlayerName .. szMailText)
	player.SendSystemMessage("因少侠使用非法宏，特删除少侠已获得的325品名剑大会装备，清除所有名剑币，" ..
		"同时清除少侠的名剑战队积分和个人积分！望少侠谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！"
	)
	Log(
		string.format(
		"[JJC_PUNISHMENT_20130423]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID
	)
	)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_PUNISHMENT_20130424] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_PUNISHMENT_20130424] then
		return
	end

	-- 删除装备
	for _, v in pairs(JJC_EQUIPMENT_325) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end

	-- 清除名剑币、踢出战队
	local nArenaAward = player.nArenaAward
	player.AddArenaAward(-nArenaAward, "OTHER")

	for i =0, 2 do
		GCCommand("SendGMCommondArenaServer(\"ForceDelMember('" ..player.dwCorpsSystemID.. "','" .. i .."')\")")
	end

	local szMailText = "：\n　　见信好！\n　　前段时日隐元会查出少侠恶意代打竞技场，为了维护竞技场的公平原则，" ..
	"特将少侠已获得的325品竞技场装备没收，同时清除所有名剑币、名剑战队积分和个人积分！\n　　望少侠以后能谨遵竞技场规则，" ..
	"为江湖营造一个公平公正的竞技环境！\n\n      隐元会敬上。"
	SendSystemMail("隐元会执掌使", szPlayerName, "竞技场代打惩罚",
	szPlayerName .. szMailText)
	player.SendSystemMessage("因少侠恶意代打竞技场，特删除少侠已获得的325品竞技场装备，同时清除所有名剑币、" ..
		"名剑战队积分和个人积分！望少侠谨遵竞技场规则，为江湖营造一个公平公正的竞技环境！"
	)
	Log(
		string.format(
		"[JJC_PUNISHMENT_20130424]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID
	)
	)
end

--------------------------------外观补偿-------------------------------------
-- 2013年3月外观补偿
function WaiGuan_Redeem_20130309(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2013, 6, 10, 7, 0, 0)
	local nEndTime = DateToTime(2013, 9, 10, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.WAIGUAN_REDEEM_20130609}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.WAIGUAN_REDEEM_20130609, true)
end

tActivityRecall[ACTIVITY_MANAGER.WAIGUAN_REDEEM_20130609] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.WAIGUAN_REDEEM_20130609] then
		return
	end

	local szMailText = "：\n　　见信好！\n　　 天降异象，少侠新购买的发型出现异状，特补偿少侠易容兑换券7张，请查收。" ..
	"\n　　 因此给少侠带来的不便深感抱歉，再次感谢您的支持。\n\n      隐元会敬上。"

	SendSystemMail("隐元会执掌使", szPlayerName, szPlayerName .. "亲启",
	szPlayerName .. szMailText, 0, {{5, 11926, 7, 0}})

	player.SendSystemMessage("天降异状，特补偿少侠易容兑换券7张，请到信使处查收。")

	Log(
		string.format(
		"[WAIGUAN_REDEEM_20130609]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID
	)
	)
end

-- 2013.6.7充值促销激活码BUG补偿
function Code_Item_20130607(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
		return  -- 只在国内版本（金山&盛大）做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2013, 6, 17, 7, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2013, 7, 17, 7, 0, 0)  -- 处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end
	tActivityIndexList = {ACTIVITY_MANAGER.CODE_ITEM_20130607}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.CODE_ITEM_20130607, true)
end

tActivityRecall[ACTIVITY_MANAGER.CODE_ITEM_20130607] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.CODE_ITEM_20130607] then
		return
	end
	local szMailText = "：\n　　见信好！\n　　近日异象突发，以致少侠蒙受莫名损失，深感歉意。隐元会特呈以下礼品聊表歉意，请查收。\n\n      隐元会敬上。"
	local tItemList = {
		{ITEM_TABLE_TYPE.CUST_TRINKET, 10185, 1, 0}, -- 罗伞・蝶恋花
	}
	SendSystemMail("隐元会执掌使", player.szName, player.szName .. "大侠亲启", player.szName .. szMailText, 0, tItemList)
end

-----------------------------------大明宫暗器回收-----------------------------------
-- 2013年6月大明宫装备回收
function DMG_Weapon_20130618(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
		return  -- 只在国内版本（金山&盛大）做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2013, 6, 20, 7, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2013, 9, 20, 7, 0, 0)  -- 处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end
	tActivityIndexList = {ACTIVITY_MANAGER.DMG_WEAPON_20130618}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.DMG_WEAPON_20130618, true)
end

tActivityRecall[ACTIVITY_MANAGER.DMG_WEAPON_20130618] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.DMG_WEAPON_20130618] then
		return
	end

	local nWeapon_7324 = tActivityRosterList[ACTIVITY_MANAGER.DMG_WEAPON_20130618][0]
	local nWeapon_7327 = tActivityRosterList[ACTIVITY_MANAGER.DMG_WEAPON_20130618][1]
	local nWeapon_7326 = tActivityRosterList[ACTIVITY_MANAGER.DMG_WEAPON_20130618][2]
	local nWeapon_7323 = tActivityRosterList[ACTIVITY_MANAGER.DMG_WEAPON_20130618][3]
	local nWeapon_7328 = tActivityRosterList[ACTIVITY_MANAGER.DMG_WEAPON_20130618][4]
	local nWeapon_7325 = tActivityRosterList[ACTIVITY_MANAGER.DMG_WEAPON_20130618][5]

	local nMoney = nWeapon_7324 * 40000 + nWeapon_7323 * 40000 + nWeapon_7325 * 30000 +
	nWeapon_7326 * 30000 + nWeapon_7327 * 30000 + nWeapon_7328 * 30000

	local szMailText = string.format(
		"：\n　　见信好！\n　　 天降异象，大明宫非法产出暗器囊，少侠共获得安锦囊%d个，高义囊%d个，鹤昆囊%d个，" ..
		"陆恩囊%d个，潜封囊%d个，阳壁囊%d个。以上物品将更改品质和售价，同时对少侠非法所得以扣除%d金形式进行回收，" ..
		"故给少侠增加【便宜勿贪】效果，待金币完全扣除后，效果消失。" ..
		"\n　　 请少侠遵守江湖道义，共创公平公正的江湖环境！\n\n      隐元会敬上。",
		nWeapon_7324, nWeapon_7327, nWeapon_7326, nWeapon_7323, nWeapon_7328, nWeapon_7325,
		nMoney
	)

	player.AddBuff(0, 99, 6405, 1)
	local buff = player.GetBuff(6405, 1)
	if buff then
		buff.nCustomValue = nMoney
	end
	Log(
		string.format(
		"PlayerID : %d, PlayerName : %s, DMG_WEAPON_20130618 AddBuff Success! nMoney = %d",
		player.dwID, player.szName, nMoney
	)
	)

	SendSystemMail("隐元会执掌使", szPlayerName, szPlayerName .. "亲启", szPlayerName .. szMailText)

	player.SendSystemMessage("少侠于大明宫非法所得将通过扣除金币形式处罚，特增加便宜勿贪效果。")
end

-- 2013年6月刷战阶惩罚
function TITLE_POINT_PUNISH_20130625(dwPlayerID)
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
		return  -- 只在国内版本做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2013, 6, 24, 7, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2013, 7, 1, 7, 0, 0)  -- 处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end
	tActivityIndexList = {ACTIVITY_MANAGER.TITLE_POINT_PUNISH_20130625}
	RemoteCallToCenter("OnActivityRosterCheckRequest", dwPlayerID, "", tActivityIndexList, ACTIVITY_MANAGER.TITLE_POINT_PUNISH_20130625, false)
end

tActivityRecall[ACTIVITY_MANAGER.TITLE_POINT_PUNISH_20130625] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	if not tActivityRosterList[ACTIVITY_MANAGER.TITLE_POINT_PUNISH_20130625] then
		return
	end

	SetPlayerTitlePointSettlePunish(dwPlayerID)
end
--]]

---------------------------------奇穴技能处理------------------------------------------
-- 2013年6月安史之乱奇穴技能处理
function QiXueSkill_20130625(player)
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return  -- 只在国内版本做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2013, 6, 27, 7, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2023, 6, 27, 7, 0, 0)  -- 处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end
	tActivityIndexList = {ACTIVITY_MANAGER.QiXUE_SKILL_20130625}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.QiXUE_SKILL_20130625, true)
end

tActivityRecall[ACTIVITY_MANAGER.QiXUE_SKILL_20130625] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.QiXUE_SKILL_20130625] then
		return
	end

	player.ClearNewTalent()

	if TALENT_NEW_TAB[player.dwForceID] then
		for _, v in pairs(TALENT_NEW_TAB[player.dwForceID]) do
			if player.GetSkillLevel(v) > 0 then
				player.ForgetSkill(v)
			end
		end
	end

	if player.nLevel >= 15 then
		local tItemList = {
			{5, 7053, 200, 0},
			{5, 7053, 200, 0},
			{5, 7053, 100, 0}
		}
		local szMailText = GetEditorString(3, 9914) ..
		GetEditorString(5, 7157) ..
		GetEditorString(4, 5517)

		SendSystemMail(GetEditorString(4, 221), player.szName, GetEditorString(5, 7155), player.szName .. szMailText, 0, tItemList)
		player.SendSystemMessage(GetEditorString(5, 7156))
	end

	local tSkillList = {
		4006, 4011, 4013, 4016, 4017,
		2956, 2958, 2959, 2960, 2961, 2963, 2942, 2944, 2946, 2947, 2952, 2955,
		3266, 3280, 3281, 3286, 3287, 3288,
	}
	for _, v in pairs(tSkillList) do
		if player.GetSkillLevel(v) > 0 then
			player.ForgetSkill(v)
		end
	end

	local tLearnList = {
		[7] = {{3107, 64}, {3111, 54}},
		[10] = {{3975, 64}, {3985, 64}},
		[5] = {{551, 54}},
		[4] = {{6901, 60}},
	}
	if tLearnList[player.dwForceID] then
		for _, v in pairs(tLearnList[player.dwForceID]) do
			if player.nLevel >= v[2] then
				player.LearnSkill(v[1])
			end
		end
	end
end
--[[
-- 2013.7.15吸蓝五彩石第一次回收补偿
function ColorDiamond_Retrieve_20130715(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
		return  -- 只在国内版本（金山&盛大）做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2013, 7, 15, 7, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2013, 8, 15, 7, 0, 0)  -- 处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end
	tActivityIndexList = {ACTIVITY_MANAGER.COLORDIAMOND_RETRIEVE_20130715}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.COLORDIAMOND_RETRIEVE_20130715, true)
end

tActivityRecall[ACTIVITY_MANAGER.COLORDIAMOND_RETRIEVE_20130715] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.COLORDIAMOND_RETRIEVE_20130715] then
		return
	end
	local nNum = tActivityRosterList[ACTIVITY_MANAGER.COLORDIAMOND_RETRIEVE_20130715][0]
	local nMoney = tActivityRosterList[ACTIVITY_MANAGER.COLORDIAMOND_RETRIEVE_20130715][1]
	local szMailText = player.szName .. "：\n　　见信好！\n　　乱世降临，风云突变。少侠武器镶嵌所用个别之五彩石蕴含的强大力量或已影响天下秩序，为绝隐患，隐元会特将其属性进行些微调整。由此导致少侠蒙受莫名损失，深感歉意。特呈上略高于五彩石回收价之金钱，以便在更换五彩石同时一并替换激活所用之五行石，聊表歉意，请查收。\n\n      隐元会敬上。"
	for i = 1, nNum do
		SendSystemMail("隐元会执掌使", player.szName, player.szName .. "大侠亲启", szMailText, nMoney * 10000)
	end
end
--]]
--2013.7.29清除试炼之地bug排名数据
--[[
function Act_TrailVally_ClearData_20130729(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return  -- 只在国内版本（金山&盛大）做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2013, 7, 29, 7, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2014, 8, 15, 7, 0, 0)  -- 处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end
	tActivityIndexList = {ACTIVITY_MANAGER.ACT_TRAILVALLY_CLEARDATA_20130729}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.ACT_TRAILVALLY_CLEARDATA_20130729, true)
end

tActivityRecall[ACTIVITY_MANAGER.ACT_TRAILVALLY_CLEARDATA_20130729] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.ACT_TRAILVALLY_CLEARDATA_20130729] then
		return
	end
	local nMoney = tActivityRosterList[ACTIVITY_MANAGER.ACT_TRAILVALLY_CLEARDATA_20130729][0]
	for i = 1, 62 do
		player.SetSingleDungeonCustomData(i, 0)
	end
	local nMaxLevel = player.GetSingleDungeonMaxLevel()
	for i = 1, nMaxLevel do
		player.ClearSingleDungeonScore(i)
	end
	player.SetSingleDungeonMaxLevel(1)
	local dwID = player.dwID
	ClearSingleDungeonScore(dwID)
end
--]]
--[[
-- 2013.7.15刷名剑币BUG第一次回收处理
function ArenaAward_BUG_20130729(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
		return  -- 只在国内版本（金山&盛大）做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2013, 7, 29, 7, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2013, 10, 29, 7, 0, 0)  -- 处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end
	tActivityIndexList = {ACTIVITY_MANAGER.ARENAAWARD_BUG_20130729}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.ARENAAWARD_BUG_20130729, true)
end

tActivityRecall[ACTIVITY_MANAGER.ARENAAWARD_BUG_20130729] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.ARENAAWARD_BUG_20130729] then
		return
	end
	local nItemNum = tActivityRosterList[ACTIVITY_MANAGER.ARENAAWARD_BUG_20130729][0]
	local nArenaNum = nItemNum * 100
	local nArenaAward = player.nArenaAward
	player.AddBuff(0, 99, 6476, 1)
	if nArenaAward < nArenaNum then
		player.AddArenaAward(-nArenaAward)
		player.AddBuff(0, 99, 6472, 1)
		local nBuffArenaAward = nArenaNum - nArenaAward
		local buff_ArenaAward = player.GetBuff(6472, 1)
		buff_ArenaAward.nCustomValue = nBuffArenaAward
	else
		player.AddArenaAward(-nArenaNum)
	end
	RemoteCallToClient(player.dwID, "OnOutputWarningMessage", "MSG_NOTICE_YELLOW", "你因为非法获取名剑币，现在扣除部分非法所得", 4)
	player.SendSystemMessage("你因为非法获取名剑币，现在扣除部分非法所得。")
	Log(
		string.format(
		"[ARENAAWARD_BUG_20130729]: PlayerName:%s, PlayerID:%d, playerAccount: %s, nArenaAward:%d", player.szName, player.dwID,  player.szAccount, nArenaAward
		)
	)
end

---------------------------------------玄龙石金币补偿--------------------------------------------
-- 2013年7月玄龙石金币补偿
function XuanLongShi_20130726(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2013, 7, 29, 7, 0, 0)
	local nEndTime = DateToTime(2013, 10, 29, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.XUANLONGSHI_20130726}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.XUANLONGSHI_20130726, true)
end

tActivityRecall[ACTIVITY_MANAGER.XUANLONGSHI_20130726] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.XUANLONGSHI_20130726] then
		return
	end

	local nCount = tActivityRosterList[ACTIVITY_MANAGER.XUANLONGSHI_20130726][0]
	local nGold = nCount * 401
	local szMailText = string.format(
		"：\n　　见信好！\n　　 天工甲人・呆呆出售的玄龙石现打折处理，打折前少侠曾从其处购买%d个玄龙石，" ..
		"特补偿少侠%d金以弥补损失（若超过10万金将分多邮件发送）。" ..
		"\n　　 因此给少侠带来的不便深感抱歉，再次感谢您的支持。\n\n      隐元会敬上。",
		nCount, nGold
	)

	local nMailCount = math.floor(nGold / 100000)
	if nMailCount > 0 then
		nGold = nGold - nMailCount * 100000
		for i = 1, nMailCount do
			SendSystemMail(
				"隐元会执掌使", szPlayerName, "玄龙石折价补偿",
				szPlayerName .. szMailText, 100000 * 10000
			)
			Log(
				string.format(
					"[XUANLONGSHI_20130726]: PlayerName:%s, PlayerID:%d, nGold:%d",
					player.szName, player.dwID, 100000
				)
			)
		end
	end

	if nGold > 0 then
		SendSystemMail("隐元会执掌使", szPlayerName, "玄龙石折价补偿",
		szPlayerName .. szMailText, nGold * 10000)

		Log(
			string.format(
				"[XUANLONGSHI_20130726]: PlayerName:%s, PlayerID:%d, nGold:%d",
				player.szName, player.dwID, nGold
			)
		)
	end

	player.SendSystemMessage("玄龙石折价所补偿的金币已通过邮件发送，请到信使处查收。")
end

-------------------------------玄龙石处理-------------------------------
-- 2013年7月玄龙石金币处理
function XuanLongShi_20130729(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2013, 7, 30, 1, 0, 0)
	local nEndTime = DateToTime(2013, 10, 30, 1, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.XUANLONGSHI_DEL_20130729}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.XUANLONGSHI_DEL_20130729, true)

	tActivityIndexList = {ACTIVITY_MANAGER.XUANLONGSHI_ADD_20130729}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.XUANLONGSHI_ADD_20130729, true)
end

tActivityRecall[ACTIVITY_MANAGER.XUANLONGSHI_DEL_20130729] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.XUANLONGSHI_DEL_20130729] then
		return
	end

	local nMoney = tActivityRosterList[ACTIVITY_MANAGER.XUANLONGSHI_DEL_20130729][0] * 401

	local szMailText = string.format(
		"：\n　　见信好！\n　　天降异象，隐元会昨日对玄龙石折价补偿时误发给少侠%d金（邮件形式），" ..
		"现予以回收，故给少侠增加【便宜勿贪】效果，待金币完全扣除后，效果消失。" ..
		"\n　　给您带来的不便深感抱歉，感谢您的支持和理解。\n\n　　隐元会敬上。",
		nMoney
	)

	player.AddBuff(0, 99, 6474, 1)
	local buff = player.GetBuff(6474, 1)
	if buff then
		buff.nCustomValue = nMoney
	end
	Log(
		string.format(
		"[XUANLONGSHI_DEL_20130729]PlayerID : %d, PlayerName : %s, AddBuff Success! nMoney = %d",
		player.dwID, player.szName, nMoney
	)
	)

	SendSystemMail("隐元会执掌使", szPlayerName, szPlayerName .. "亲启", szPlayerName .. szMailText)

	player.SendSystemMessage("隐元会误发金币，现予以回收，特增加便宜勿贪效果。")
end

tActivityRecall[ACTIVITY_MANAGER.XUANLONGSHI_ADD_20130729] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.XUANLONGSHI_ADD_20130729] then
		return
	end

	local nCount = tActivityRosterList[ACTIVITY_MANAGER.XUANLONGSHI_ADD_20130729][0]
	local nGold = nCount * 401
	local szMailText = string.format(
		"：\n　　见信好！\n　　 天工甲人・呆呆出售的玄龙石现打折处理，打折前少侠曾从其处购买%d个玄龙石，" ..
		"特补偿少侠%d金以弥补损失（若超过10万金将分多邮件发送）。" ..
		"\n　　 因此给少侠带来的不便深感抱歉，再次感谢您的支持。\n\n      隐元会敬上。",
		nCount, nGold
	)

	local nMailCount = math.floor(nGold / 100000)
	if nMailCount > 0 then
		nGold = nGold - nMailCount * 100000
		for i = 1, nMailCount do
			SendSystemMail(
				"隐元会执掌使", szPlayerName, "玄龙石折价偿还",
				szPlayerName .. szMailText, 100000 * 10000
			)
			Log(
				string.format(
					"[XUANLONGSHI_ADD_20130729]: PlayerName:%s, PlayerID:%d, nGold:%d",
					player.szName, player.dwID, 100000
				)
			)
		end
	end

	if nGold > 0 then
		SendSystemMail("隐元会执掌使", szPlayerName, "玄龙石折价偿还",
		szPlayerName .. szMailText, nGold * 10000)

		Log(
			string.format(
				"[XUANLONGSHI_ADD_20130729]: PlayerName:%s, PlayerID:%d, nGold:%d",
				player.szName, player.dwID, nGold
			)
		)
	end

	player.SendSystemMessage("玄龙石折价所偿还的金币已通过邮件发送，请到信使处查收。")
end

------------------------------竞技场惩罚-------------------------------
-- 2013年9月竞技场恶性代打惩罚
function JJC_Punishment_20130916(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2013, 9, 17, 1, 0, 0)
	local nEndTime = DateToTime(2013, 11, 17, 1, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_PUNISHMENT_20130916}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_PUNISHMENT_20130916, true)
end

-- 2013年7月竞技场恶性代打惩罚
function JJC_Punishment_20130729(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2013, 7, 30, 1, 0, 0)
	local nEndTime = DateToTime(2013, 10, 30, 1, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_PUNISHMENT_1_20130729}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_PUNISHMENT_1_20130729, true)

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_PUNISHMENT_2_20130729}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_PUNISHMENT_2_20130729, true)

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_PUNISHMENT_3_20130729}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_PUNISHMENT_3_20130729, true)

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_PUNISHMENT_4_20130729}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_PUNISHMENT_4_20130729, true)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_PUNISHMENT_20130916] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_PUNISHMENT_20130916] then
		return
	end

	-- 删除装备
	for _, v in pairs(JJC_EQUIPMENT_400) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end

	-- 清除名剑币、踢出战队
	local nArenaAward = player.nArenaAward
	player.AddArenaAward(-nArenaAward, "OTHER")

	for i =0, 2 do
		GCCommand("SendGMCommondArenaServer(\"ForceDelMember('" ..player.dwCorpsSystemID.. "','" .. i .."')\")")
	end

	local szMailText = "：\n　　见信好！\n　　前段时日隐元会查出少侠参与名剑大会时使用非法宏或恶意刷分，为了维护名剑大会的公平原则，" ..
	"特将少侠已获得的400品和440品名剑大会装备没收，清除所有名剑币，同时清除少侠的名剑战队积分和个人积分！" ..
	"\n　　望少侠以后能谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！\n\n      隐元会敬上。"
	SendSystemMail("隐元会执掌使", szPlayerName, "使用非法宏处罚",
	szPlayerName .. szMailText)
	player.SendSystemMessage("因少侠使用非法宏或恶意刷分，特删除少侠已获得的400品和440品名剑大会装备，清除所有名剑币，" ..
		"同时清除少侠的名剑战队积分和个人积分！望少侠谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！"
	)
	Log(
		string.format(
		"[JJC_PUNISHMENT_20130916]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID
	)
	)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_PUNISHMENT_1_20130729] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_PUNISHMENT_1_20130729] then
		return
	end

	-- 删除装备
	for _, v in pairs(JJC_EQUIPMENT_400) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end

	-- 清除名剑币、踢出战队
	local nArenaAward = player.nArenaAward
	player.AddArenaAward(-nArenaAward, "OTHER")

	for i =0, 2 do
		GCCommand("SendGMCommondArenaServer(\"ForceDelMember('" ..player.dwCorpsSystemID.. "','" .. i .."')\")")
	end

	local szMailText = "：\n　　见信好！\n　　前段时日隐元会查出少侠参与名剑大会时使用非法宏或恶意刷分，为了维护名剑大会的公平原则，" ..
	"特将少侠已获得的400品和440品名剑大会装备没收，清除所有名剑币，同时清除少侠的名剑战队积分和个人积分！" ..
	"\n　　望少侠以后能谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！\n\n      隐元会敬上。"
	SendSystemMail("隐元会执掌使", szPlayerName, "使用非法宏处罚",
	szPlayerName .. szMailText)
	player.SendSystemMessage("因少侠使用非法宏或恶意刷分，特删除少侠已获得的400品和440品名剑大会装备，清除所有名剑币，" ..
		"同时清除少侠的名剑战队积分和个人积分！望少侠谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！"
	)
	Log(
		string.format(
		"[JJC_PUNISHMENT_20130729]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID
	)
	)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_PUNISHMENT_2_20130729] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_PUNISHMENT_2_20130729] then
		return
	end

	-- 删除装备
	for _, v in pairs(JJC_EQUIPMENT_400) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end

	-- 清除名剑币、踢出战队
	local nArenaAward = player.nArenaAward
	player.AddArenaAward(-nArenaAward, "OTHER")

	for i =0, 2 do
		GCCommand("SendGMCommondArenaServer(\"ForceDelMember('" ..player.dwCorpsSystemID.. "','" .. i .."')\")")
	end

	local szMailText = "：\n　　见信好！\n　　前段时日隐元会查出少侠参与名剑大会时使用非法宏或恶意刷分，为了维护名剑大会的公平原则，" ..
	"特将少侠已获得的400品和440品名剑大会装备没收，清除所有名剑币，同时清除少侠的名剑战队积分和个人积分！" ..
	"\n　　望少侠以后能谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！\n\n      隐元会敬上。"
	SendSystemMail("隐元会执掌使", szPlayerName, "使用非法宏处罚",
	szPlayerName .. szMailText)
	player.SendSystemMessage("因少侠使用非法宏或恶意刷分，特删除少侠已获得的400品和440品名剑大会装备，清除所有名剑币，" ..
		"同时清除少侠的名剑战队积分和个人积分！望少侠谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！"
	)
	Log(
		string.format(
		"[JJC_PUNISHMENT_20130729]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID
	)
	)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_PUNISHMENT_3_20130729] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_PUNISHMENT_3_20130729] then
		return
	end

	-- 删除装备
	for _, v in pairs(JJC_EQUIPMENT_400) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end

	-- 清除名剑币、踢出战队
	local nArenaAward = player.nArenaAward
	player.AddArenaAward(-nArenaAward, "OTHER")

	for i =0, 2 do
		GCCommand("SendGMCommondArenaServer(\"ForceDelMember('" ..player.dwCorpsSystemID.. "','" .. i .."')\")")
	end

	local szMailText = "：\n　　见信好！\n　　前段时日隐元会查出少侠参与名剑大会时使用非法宏或恶意刷分，为了维护名剑大会的公平原则，" ..
	"特将少侠已获得的400品和440品名剑大会装备没收，清除所有名剑币，同时清除少侠的名剑战队积分和个人积分！" ..
	"\n　　望少侠以后能谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！\n\n      隐元会敬上。"
	SendSystemMail("隐元会执掌使", szPlayerName, "使用非法宏处罚",
	szPlayerName .. szMailText)
	player.SendSystemMessage("因少侠使用非法宏或恶意刷分，特删除少侠已获得的400品和440品名剑大会装备，清除所有名剑币，" ..
		"同时清除少侠的名剑战队积分和个人积分！望少侠谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！"
	)
	Log(
		string.format(
		"[JJC_PUNISHMENT_20130729]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID
	)
	)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_PUNISHMENT_4_20130729] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_PUNISHMENT_4_20130729] then
		return
	end

	-- 删除装备
	for _, v in pairs(JJC_EQUIPMENT_400) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end

	-- 清除名剑币、踢出战队
	local nArenaAward = player.nArenaAward
	player.AddArenaAward(-nArenaAward, "OTHER")

	for i =0, 2 do
		GCCommand("SendGMCommondArenaServer(\"ForceDelMember('" ..player.dwCorpsSystemID.. "','" .. i .."')\")")
	end

	local szMailText = "：\n　　见信好！\n　　前段时日隐元会查出少侠参与名剑大会时使用非法宏或恶意刷分，为了维护名剑大会的公平原则，" ..
	"特将少侠已获得的400品和440品名剑大会装备没收，清除所有名剑币，同时清除少侠的名剑战队积分和个人积分！" ..
	"\n　　望少侠以后能谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！\n\n      隐元会敬上。"
	SendSystemMail("隐元会执掌使", szPlayerName, "使用非法宏处罚",
	szPlayerName .. szMailText)
	player.SendSystemMessage("因少侠使用非法宏或恶意刷分，特删除少侠已获得的400品和440品名剑大会装备，清除所有名剑币，" ..
		"同时清除少侠的名剑战队积分和个人积分！望少侠谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！"
	)
	Log(
		string.format(
		"[JJC_PUNISHMENT_20130729]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID
	)
	)
end

-- 2013.9.16涅分支BUG帮会资金补偿
function TongPay_Retrieve_20130916(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
		return  -- 只在国内版本（金山&盛大）做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2013, 9, 16, 7, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2013, 10, 16, 7, 0, 0)  -- 处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end
	tActivityIndexList = {ACTIVITY_MANAGER.BANGHUIZIJIN_20130916}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.BANGHUIZIJIN_20130916, true)
end

tActivityRecall[ACTIVITY_MANAGER.BANGHUIZIJIN_20130916] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.BANGHUIZIJIN_20130916] then
		return
	end

	local nMoney = tActivityRosterList[ACTIVITY_MANAGER.BANGHUIZIJIN_20130916][0]
	local nNum = tActivityRosterList[ACTIVITY_MANAGER.BANGHUIZIJIN_20130916][1]
	local tItemList = {
		{ITEM_TABLE_TYPE.OTHER, 17716 ,nNum, 0}
	}

	szMailText =string.format("：\n　　见信好！\n　　乱世降临，风云突变。大侠所属帮会的天工树涅分支于日前无故异变，特奉上贵帮会所损失的帮会资金：%d以弥补各位大侠之损失。 因此给大侠带来的不便深感抱歉，再次感谢您的支持。\n\n \n\n      隐元会敬上。",nMoney)
	SendSystemMail("隐元会执掌使", player.szName, player.szName .. "大侠亲启", player.szName .. szMailText, 0, tItemList)
end
--]]
------------------------ 非法修改客户端 -------------------------
-- 2013年10月竞技场恶性代打惩罚
--[[
function JJC_Punishment_20131016(player)
return
if not player then
return
end
local GV = GetGameVersion()
if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
return
end
local nTime = GetCurrentTime()
local nStartTime = DateToTime(2013, 10, 21, 7, 0, 0)
local nEndTime = DateToTime(2014, 1, 21, 7, 0, 0)
if nStartTime >= nTime or nTime >= nEndTime then
return
end

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_PUNISHMENT_20131016}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_PUNISHMENT_20131016, true)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_PUNISHMENT_20131016] = function(dwPlayerID, szPlayerName, tActivityRosterList)
local player = GetPlayer(dwPlayerID)
if not player then
return
end

if not tActivityRosterList[ACTIVITY_MANAGER.JJC_PUNISHMENT_20131016] then
return
end

 删除装备
for _, v in pairs(JJC_EQUIPMENT_400) do
local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
if nAmount > 0 then
player.CostItemInAllPackage(v[1], v[2], nAmount)
end
end

 清除名剑币、踢出战队
local nArenaAward = player.nArenaAward
player.AddArenaAward(-nArenaAward, "OTHER")

for i =0, 2 do
GCCommand("SendGMCommondArenaServer(\"ForceDelMember('" ..player.dwCorpsSystemID.. "','" .. i .."')\")")
end

local szMailText = "：\n　　见信好！\n　　前段时日隐元会查出少侠非法修改客户端或商业代打恶意刷分，为了维护江湖的公平原则，" ..
"特将少侠已获得的400品和440品名剑大会装备没收，清除所有名剑币，同时清除少侠的名剑战队积分和个人积分！" ..
"\n　　望少侠以后能谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！\n\n      隐元会敬上。"
SendSystemMail("隐元会执掌使", szPlayerName, "非法修改客户端处罚",
szPlayerName .. szMailText)
player.SendSystemMessage("因少侠使用非法修改客户端或商业代打恶意刷分，特删除少侠已获得的400品和440品名剑大会装备，清除所有名剑币，" ..
"同时清除少侠的名剑战队积分和个人积分！望少侠谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！"
)
Log(
string.format(
"[JJC_PUNISHMENT_20131016]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID
)
)
end

 2013年12月竞技场恶性代打惩罚
function JJC_Punishment_20131212(player)
if not player then
return
end
local GV = GetGameVersion()
if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
return
end
local nTime = GetCurrentTime()
local nStartTime = DateToTime(2013, 12, 12, 7, 0, 0)
local nEndTime = DateToTime(2014, 3, 12, 7, 0, 0)
if nStartTime >= nTime or nTime >= nEndTime then
return
end

tActivityIndexList = {ACTIVITY_MANAGER.JJC_PUNISHMENT_20131212}
ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_PUNISHMENT_20131212, true)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_PUNISHMENT_20131212] = function(dwPlayerID, szPlayerName, tActivityRosterList)
local player = GetPlayer(dwPlayerID)
if not player then
return
end

if not tActivityRosterList[ACTIVITY_MANAGER.JJC_PUNISHMENT_20131212] then
return
end

 删除装备
for _, v in pairs(JJC_EQUIPMENT_400) do
local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
if nAmount > 0 then
player.CostItemInAllPackage(v[1], v[2], nAmount)
end
end

 清除名剑币、踢出战队
local nArenaAward = player.nArenaAward
player.AddArenaAward(-nArenaAward, "OTHER")

for i =0, 2 do
GCCommand("SendGMCommondArenaServer(\"ForceDelMember('" ..player.dwCorpsSystemID.. "','" .. i .."')\")")
end

local szMailText = "：\n　　见信好！\n　　前段时日隐元会查出少侠非法修改客户端或商业代打恶意刷分，为了维护江湖的公平原则，" ..
"特将少侠已获得的400品、440品和480品名剑大会装备没收，清除所有名剑币，同时清除少侠的名剑战队积分和个人积分！" ..
"\n　　望少侠以后能谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！\n\n      隐元会敬上。"
SendSystemMail("隐元会执掌使", szPlayerName, "非法修改客户端处罚",
szPlayerName .. szMailText)
player.SendSystemMessage("因少侠使用非法修改客户端或商业代打恶意刷分，特删除少侠已获得的400品、440品和480品名剑大会装备，清除所有名剑币，" ..
"同时清除少侠的名剑战队积分和个人积分！望少侠谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！"
)
Log(
string.format(
"[JJC_PUNISHMENT_20131212]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID
		)
	)
end
--]]

-- 2014年1月重复刷笑傲江湖路惩罚
--[[
function XIAOAOJIANGHULU_20140120(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2014, 1, 20, 7, 0, 0)
	local nEndTime = DateToTime(2014, 7, 10, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.XIAOAOJIANGHULU_20140120}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.XIAOAOJIANGHULU_20140120, true)

end

tActivityRecall[ACTIVITY_MANAGER.XIAOAOJIANGHULU_20140120] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.XIAOAOJIANGHULU_20140120] then
		return
	end
	local n8373 = math.max(tActivityRosterList[ACTIVITY_MANAGER.XIAOAOJIANGHULU_20140120][0] - 1, 0)
	local n8374 = math.max(tActivityRosterList[ACTIVITY_MANAGER.XIAOAOJIANGHULU_20140120][1] - 1, 0)
	local nContributionNum = n8374 * 2500
	local nPrestigeNum = n8374 * 2500
	local nTrainNum = n8373 * 2500 + n8374 * 7500
	local nJianbenNum = n8373 * 25
	player.AddBuff(0, 99, 7403, 1)
	local nContribution = player.nContribution
	local nPrestige = player.nCurrentPrestige
	local nTrain = player.nCurrentTrainValue
	local nJianben = player.nExamPrint

	--江湖贡献值
	if nContribution < nContributionNum then
		player.AddContribution( - nContribution)
		player.AddBuff(0, 99, 7400, 1)
		local nBuffContribution = nContributionNum - nContribution
		local buff_Contribution = player.GetBuff(7400, 1)
		buff_Contribution.nCustomValue = nBuffContribution
	else
		player.AddContribution( - nContributionNum)
	end
	RemoteCallToClient(player.dwID, "OnOutputWarningMessage", "MSG_NOTICE_YELLOW", "你因为非法获取江湖贡献值，现在扣除部分非法所得", 4)
	player.SendSystemMessage("你因为非法获取江湖贡献值，现在扣除部分非法所得。")
	Log(
		string.format(
		"[XIAOAOJIANGHULU_20140120]: PlayerName:%s, PlayerID:%d, playerAccount: %s, nContribution:%d", player.szName, player.dwID, player.szAccount, nContribution
	)
	)
	--威望值
	if nPrestige < nPrestigeNum then
		player.AddPrestige( - nPrestige)
		player.AddBuff(0, 99, 7401, 1)
		local nBuffPrestige = nPrestigeNum - nPrestige
		local buff_Prestige = player.GetBuff(7401, 1)
		buff_Prestige.nCustomValue = nBuffPrestige
	else
		player.AddPrestige( - nPrestigeNum)
	end
	RemoteCallToClient(player.dwID, "OnOutputWarningMessage", "MSG_NOTICE_YELLOW", "你因为非法获取威望值，现在扣除部分非法所得", 4)
	player.SendSystemMessage("你因为非法获取威望值，现在扣除部分非法所得。")
	Log(
		string.format(
		"[XIAOAOJIANGHULU_20140120]: PlayerName:%s, PlayerID:%d, playerAccount: %s, nPrestige:%d", player.szName, player.dwID, player.szAccount, nPrestige
	)
	)

	--修为

	if nTrain < nTrainNum then
		player.AddPrestige(-nTrain)
		player.AddBuff(0, 99, 7404, 1)
		local nBuffPrestige = nTrainNum - nTrain
		local buff_Prestige = player.GetBuff(7404, 1)
		buff_Prestige.nCustomValue = nBuffContribution
	else
		player.AddTrain(-nTrainNum)
	end
	RemoteCallToClient(player.dwID, "OnOutputWarningMessage", "MSG_NOTICE_YELLOW", "你因为非法获取威望值，现在扣除部分非法所得", 4)
	player.SendSystemMessage("你因为非法获取威望值，现在扣除部分非法所得。")
	Log(
		string.format(
		"[XIAOAOJIANGHULU_20140120]: PlayerName:%s, PlayerID:%d, playerAccount: %s, nTrain:%d", player.szName, player.dwID,  player.szAccount, nTrain
		)
	)

	--监本
	if nJianben < nJianbenNum then
		player.AddExamPrint( - nJianben)
		player.AddBuff(0, 99, 7402, 1)
		local nBuffJianben = nJianbenNum - nJianben
		local buff_Jianben = player.GetBuff(7402, 1)
		buff_Jianben.nCustomValue = nBuffJianben
	else
		player.AddExamPrint( - nJianbenNum)
	end
	RemoteCallToClient(player.dwID, "OnOutputWarningMessage", "MSG_NOTICE_YELLOW", "你因为非法获取监本印文，现在扣除部分非法所得", 4)
	player.SendSystemMessage("你因为非法获取监本印文，现在扣除部分非法所得。")
	Log(
		string.format(
		"[XIAOAOJIANGHULU_20140120]: PlayerName:%s, PlayerID:%d, playerAccount: %s, nJianben:%d", player.szName, player.dwID, player.szAccount, nJianben
	)
	)
end
--]]

-- 2014年2月竞技场恶性代打惩罚
--[[
function JJC_Punishment_20140220(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn" and GV.VersionEx == "") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2014, 2, 20, 7, 0, 0)
	local nEndTime = DateToTime(2014, 5, 22, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_PUNISHMENT_20140220}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_PUNISHMENT_20140220, true)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_PUNISHMENT_20140220] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_PUNISHMENT_20140220] then
		return
	end

	-- 删除装备
	for _, v in pairs(JJC_EQUIPMENT_400) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end

	-- 清除名剑币、踢出战队
	local nArenaAward = player.nArenaAward
	player.AddArenaAward( - nArenaAward, "OTHER")

	for i = 0, 2 do
		GCCommand("SendGMCommondArenaServer(\"ForceDelMember('" .. player.dwCorpsSystemID .. "','" .. i .. "')\")")
	end

	local szMailText = "：\n　　见信好！\n　　前段时日隐元会查出少侠非法修改客户端或商业代打恶意刷分，为了维护江湖的公平原则，" ..
	"特将少侠已获得的400品、440品和480品名剑大会装备没收，清除所有名剑币，同时清除少侠的名剑战队积分和个人积分！" ..
	"\n　　望少侠以后能谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！\n\n      隐元会敬上。"
	SendSystemMail("隐元会执掌使", szPlayerName, "非法修改客户端处罚", szPlayerName .. szMailText)
	player.SendSystemMessage("因少侠使用非法修改客户端或商业代打恶意刷分，特删除少侠已获得的400品、440品和480品名剑大会装备，清除所有名剑币，" ..
	"同时清除少侠的名剑战队积分和个人积分！望少侠谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！")
	Log(
		string.format(
		"[JJC_PUNISHMENT_20140220]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID
	)
	)
end
--]]

-- 2014年6月竞技场恶性代打惩罚
--[[
function JJC_Punishment_20140616(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2014, 6, 16, 7, 0, 0)
	local nEndTime = DateToTime(2014, 9, 16, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_PUNISHMENT_20140616}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_PUNISHMENT_20140616, true)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_PUNISHMENT_20140616] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_PUNISHMENT_20140616] then
		return
	end

	-- 删除装备
	for _, v in pairs(JJC_EQUIPMENT_480) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end
	for _, v in pairs(JJC_EQUIPMENT_515) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end

	-- 清除名剑币、踢出战队
	local nArenaAward = player.nArenaAward
	player.AddArenaAward( - nArenaAward, "OTHER")

	-- 名剑大会段位和名剑币周上限重置
	player.nArenaLevel2v2 = 0
	player.nArenaLevel3v3 = 0
	player.nArenaLevel5v5 = 0
	local nArenaSpace = player.GetArenaAwardRemainSpace()
	player.AddArenaAwardRemainSpace(1800 - nArenaSpace)

	for i = 0, 2 do
		GCCommand("SendGMCommondArenaServer(\"ForceDelMember('" .. player.dwCorpsSystemID .. "','" .. i .. "')\")")
	end

	local szMailText = "：\n　　见信好！\n　　前段时日隐元会查出少侠非法修改客户端或商业代打恶意刷分，为了维护江湖的公平原则，" ..
	"特将少侠已获得的480品和515品名剑大会装备没收，清除少侠所有名剑币、名剑战队积分和个人积分，同时清零少侠的名剑大会个人段位，且个人名剑币周上限恢复至1800的初始值！" ..
	"\n　　望少侠以后能谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！\n\n      隐元会敬上。"
	SendSystemMail("隐元会执掌使", szPlayerName, "非法修改客户端处罚", szPlayerName .. szMailText)
	player.SendSystemMessage("因少侠使用非法修改客户端或商业代打恶意刷分，特删除少侠已获得的480品和515品名剑大会装备，" ..
	"清除少侠所有名剑币、名剑战队积分和个人积分，同时清零少侠的名剑大会个人段位！望少侠谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！")
	Log(
		string.format(
		"[JJC_PUNISHMENT_20140616]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID
	)
	)
end
--]]

-- 2014年6月竞技场恶性代打惩罚第二次处理
--[[
function JJC_Punishment_20140630(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2014, 6, 30, 7, 0, 0)
	local nEndTime = DateToTime(2014, 9, 30, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_PUNISHMENT_20140630}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_PUNISHMENT_20140630, true)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_PUNISHMENT_20140630] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_PUNISHMENT_20140630] then
		return
	end

	-- 删除装备
	for _, v in pairs(JJC_EQUIPMENT_480) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end
	for _, v in pairs(JJC_EQUIPMENT_515) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end

	-- 清除名剑币、踢出战队
	local nArenaAward = player.nArenaAward
	player.AddArenaAward( - nArenaAward, "OTHER")

	-- 名剑大会段位和名剑币周上限重置
	player.nArenaLevel2v2 = 0
	player.nArenaLevel3v3 = 0
	player.nArenaLevel5v5 = 0
	local nArenaSpace = player.GetArenaAwardRemainSpace()
	player.AddArenaAwardRemainSpace(1800 - nArenaSpace)

	for i = 0, 2 do
		GCCommand("SendGMCommondArenaServer(\"ForceDelMember('" .. player.dwCorpsSystemID .. "','" .. i .. "')\")")
	end

	local szMailText = "：\n　　见信好！\n　　前段时日隐元会查出少侠非法修改客户端或商业代打恶意刷分，为了维护江湖的公平原则，" ..
	"特将少侠已获得的480品和515品名剑大会装备没收，清除少侠所有名剑币、名剑战队积分和个人积分，同时清零少侠的名剑大会个人段位，且个人名剑币周上限恢复至1800的初始值！" ..
	"\n　　望少侠以后能谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！\n\n      隐元会敬上。"
	SendSystemMail("隐元会执掌使", szPlayerName, "非法修改客户端处罚", szPlayerName .. szMailText)
	player.SendSystemMessage("因少侠使用非法修改客户端或商业代打恶意刷分，特删除少侠已获得的480品和515品名剑大会装备，" ..
	"清除少侠所有名剑币、名剑战队积分和个人积分，同时清零少侠的名剑大会个人段位！望少侠谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！")
	Log(
		string.format(
		"[JJC_PUNISHMENT_20140630]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID
	)
	)
end
--]]
-- 2014年7月竞技场恶性代打惩罚
--[[
function JJC_Punishment_20140801(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2014, 8, 1, 7, 0, 0)
	local nEndTime = DateToTime(2014, 11, 1, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_PUNISHEMNT_20140801}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_PUNISHEMNT_20140801, true)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_PUNISHEMNT_20140801] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	local szLog = string.format(
		"[JJC_PUNISHMENT_20140801]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID
	)
	JJC_Punishment_Func(dwPlayerID, szPlayerName, tActivityRosterList, ACTIVITY_MANAGER.JJC_PUNISHEMNT_20140801, szLog)
end
--]]
--JJC惩罚：删480 515装备，清剑币、积分、段位
--[[
function JJC_Punishment_Func(dwPlayerID, szPlayerName, tActivityRosterList, nIndex, szLog)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[nIndex] then
		return
	end

	-- 删除装备
	for _, v in pairs(JJC_EQUIPMENT_480) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end
	for _, v in pairs(JJC_EQUIPMENT_515) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end

	-- 清除名剑币、踢出战队
	local nArenaAward = player.nArenaAward
	player.AddArenaAward( - nArenaAward, "OTHER")

	-- 名剑大会段位和名剑币周上限重置
	player.nArenaLevel2v2 = 0
	player.nArenaLevel3v3 = 0
	player.nArenaLevel5v5 = 0
	local nArenaSpace = player.GetArenaAwardRemainSpace()
	player.AddArenaAwardRemainSpace(1800 - nArenaSpace)

	for i = 0, 2 do
		GCCommand("SendGMCommondArenaServer(\"ForceDelMember('" .. player.dwCorpsSystemID .. "','" .. i .. "')\")")
	end

	local szMailText = "：\n　　见信好！\n　　前段时日隐元会查出少侠非法修改客户端或商业代打恶意刷分，为了维护江湖的公平原则，" ..
	"特将少侠已获得的480品和515品名剑大会装备没收，清除少侠所有名剑币、名剑战队积分和个人积分，同时清零少侠的名剑大会个人段位，且个人名剑币周上限恢复至1800的初始值！" ..
	"\n　　望少侠以后能谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！\n\n      隐元会敬上。"
	SendSystemMail("隐元会执掌使", szPlayerName, "非法修改客户端处罚", szPlayerName .. szMailText)
	player.SendSystemMessage("因少侠使用非法修改客户端或商业代打恶意刷分，特删除少侠已获得的480品和515品名剑大会装备，" ..
	"清除少侠所有名剑币、名剑战队积分和个人积分，同时清零少侠的名剑大会个人段位！望少侠谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！")
	Log(szLog)
end
--]]
-- 2014年8月18日七夕礼物补偿-9月18日
--[[
function QiXi_reward_201408014(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2014, 8, 14, 7, 0, 0)
	local nEndTime = DateToTime(2014, 9, 18, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.QiXi_REWARD_201408014}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.QiXi_REWARD_201408014, true)
end

tActivityRecall[ACTIVITY_MANAGER.QiXi_REWARD_201408014] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.QiXi_REWARD_201408014] then
		return
	end
	local nLianLiID = QiXi_GetCurrentYearLoverID(player)--获得对象身上的结缘玩家
	if nLianLiID ~= 0 then
		local nTime = QiXi_GetCurrentLoverLastYear(player)
		QiXi_SendMail(player, nTime, 0, 0)
		local szLog = string.format(
			"[QiXi_REWARD_201408014]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID
		)
		Log(szLog)
	else
		local szLog = string.format(
			"[QiXi_REWARD_201408014]:No reward. PlayerName:%s, PlayerID:%d", player.szName, player.dwID
		)
		Log(szLog)
	end

end
--]]
function QiXi_GetCurrentLoverLastYear(player)--获得本年度情缘的持续年数
	local nCurrentLoverID = QiXi_GetCurrentYearLoverID(player)
	local nTime = 1
	local tIDTable = QiXi_GetAllIDTable(player)
	for i = 2, #tIDTable - 1 do
		if nCurrentLoverID == tIDTable[i] then
			nTime = nTime + 1
		end
	end
	if (nCurrentLoverID == player.GetCustomInteger4(PLAYER_CUSTOM_VALUE.QIXI_INSCRIPTION_ID_1))or (nCurrentLoverID == player.GetCustomInteger4(PLAYER_CUSTOM_VALUE.QIXI_INSCRIPTION_ID_2))then
		nTime = nTime + 1
	end
	return nTime
end

function QiXi_SendMail(player, nTime, nMost, nMost2)
	if nTime > 3 then
		nTime = 3
	end
	local tCPGift = {
		{{5, 8883, 1}, {5, 6235, 1}, {5, 19315, 1}, }, --默认
	}
	local tCPGift2 = {
		{{5, 8883, 1}, {5, 6235, 1}, {5, 19315, 1}, }, --默认
	}
	local tPlayerGift = {}
	for i = 1, #tCPGift[nMost + 1] do
		table.insert(tPlayerGift, tCPGift[nMost + 1][i])
	end
	for i = 1, #tCPGift2[nMost2 + 1] do
		table.insert(tPlayerGift, tCPGift2[nMost2 + 1][i])
	end
	if nTime > 1 and nTime <= 3 then
		for i = 1, #tPlayerGift do
			tPlayerGift[i][3] = tPlayerGift[i][3] * nTime
		end
	end
	if nTime >= 3 then
		table.insert(tPlayerGift, {5, 17499, 1})
	end
	local szText = ""
	local szText = player.szName .. GetEditorString(6, 7616) ..
	GetEditorString(6, 7609)
	SendSystemMail(GetEditorString(4, 1821), player.szName, GetEditorString(4, 1047), szText, 0, tPlayerGift)
end

-- 2014年8月21日七夕礼物补偿-9月21日
--[[
function QiXi_reward_20140821(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2014, 8, 21, 7, 0, 0)
	local nEndTime = DateToTime(2014, 9, 21, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.QiXi_REWARD_20140821}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.QiXi_REWARD_20140821, true)
end

tActivityRecall[ACTIVITY_MANAGER.QiXi_REWARD_20140821] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.QiXi_REWARD_20140821] then
		return
	end
	local nLianLiID = QiXi_GetCurrentYearLoverID(player)--获得对象身上的结缘玩家
	local nTime = QiXi_GetCurrentLoverLastYear(player)
	if nLianLiID ~= 0 then
		if nTime and nTime >= 3 then
			QiXi_SendMail2(player, nLianLiID)
		end
		local szLog = string.format(
			"[QiXi_REWARD_20140821]: PlayerName:%s, PlayerID:%d,PlayerYear:%d,PlayerLoverID:%d。", player.szName, player.dwID, nTime, nLianLiID
		)
		Log(szLog)
	else
		local szLog = string.format(
			"[QiXi_REWARD_20140821]:No reward. PlayerName:%s, PlayerID:%d,PlayerYear:%d，PlayerLoverID:%d。", player.szName, player.dwID, nTime, nLianLiID
		)
		Log(szLog)
	end

end

function QiXi_SendMail2(player, nLianLiID)
	local tPlayerGift = {{5, 17499, 1}}
	local szText = ""
	local szText = "      缘定三生，黄泉碧落誓相随。\n     " .. player.szName .. "在七夕佳节许下了美好的愿望。\n     但是前几日出了点纰漏，许愿的礼物可能没有寄出……" ..
	"\n     如今补上七夕礼品一份，望笑纳。"
	RemoteCallToCenter("OnSendMultItemsMailByRoleID", "若初", nLianLiID, "七夕大礼", szText, 0, tPlayerGift)
end
--]]

-- 2014年8月竞技场恶性代打惩罚
--[[
function JJC_Punishment_20140901(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2014, 9, 1, 7, 0, 0)
	local nEndTime = DateToTime(2014, 12, 1, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_PUNISHEMNT_20140901}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_PUNISHEMNT_20140901, true)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_PUNISHEMNT_20140901] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_PUNISHEMNT_20140901] then
		return
	end

	-- 删除装备
	for _, v in pairs(JJC_EQUIPMENT_480) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end
	for _, v in pairs(JJC_EQUIPMENT_515) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end

	-- 清除名剑币、踢出战队
	local nArenaAward = player.nArenaAward
	player.AddArenaAward( - nArenaAward, "OTHER")

	-- 名剑大会段位和名剑币周上限重置
	player.nArenaLevel2v2 = 0
	player.nArenaLevel3v3 = 0
	player.nArenaLevel5v5 = 0
	local nArenaSpace = player.GetArenaAwardRemainSpace()
	player.AddArenaAwardRemainSpace(1800 - nArenaSpace)

	for i = 0, 2 do
		GCCommand("SendGMCommondArenaServer(\"ForceDelMember('" .. player.dwCorpsSystemID .. "','" .. i .. "')\")")
	end

	local szMailText = "：\n　　见信好！\n　　前段时日隐元会查出少侠非法修改客户端或商业代打恶意刷分，为了维护江湖的公平原则，" ..
	"特将少侠已获得的480品和515品名剑大会装备没收，清除少侠所有名剑币、名剑战队积分和个人积分，同时清零少侠的名剑大会个人段位，且个人名剑币周上限恢复至1800的初始值！" ..
	"\n　　望少侠以后能谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！\n\n      隐元会敬上。"
	SendSystemMail("隐元会执掌使", szPlayerName, "非法修改客户端处罚", szPlayerName .. szMailText)
	player.SendSystemMessage("因少侠使用非法修改客户端或商业代打恶意刷分，特删除少侠已获得的480品和515品名剑大会装备，" ..
	"清除少侠所有名剑币、名剑战队积分和个人积分，同时清零少侠的名剑大会个人段位！望少侠谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！")
	Log(
		string.format(
		"[JJC_PUNISHMENT_20140616]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID
	)
	)
end

-- 2014年9月竞技场恶性代打惩罚
function JJC_Punishment_20140929(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2014, 9, 29, 7, 0, 0)
	local nEndTime = DateToTime(2014, 12, 29, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_PUNISHEMNT_20140929}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_PUNISHEMNT_20140929, true)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_PUNISHEMNT_20140929] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_PUNISHEMNT_20140929] then
		return
	end

	-- 删除装备
	for _, v in pairs(JJC_EQUIPMENT_480) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end
	for _, v in pairs(JJC_EQUIPMENT_515) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end

	-- 清除名剑币、踢出战队
	local nArenaAward = player.nArenaAward
	player.AddArenaAward( - nArenaAward, "OTHER")

	-- 名剑大会段位和名剑币周上限重置
	player.nArenaLevel2v2 = 0
	player.nArenaLevel3v3 = 0
	player.nArenaLevel5v5 = 0
	local nArenaSpace = player.GetArenaAwardRemainSpace()
	player.AddArenaAwardRemainSpace(1800 - nArenaSpace)

	for i = 0, 2 do
		GCCommand("SendGMCommondArenaServer(\"ForceDelMember('" .. player.dwCorpsSystemID .. "','" .. i .. "')\")")
	end

	local szMailText = "：\n　　见信好！\n　　前段时日隐元会查出少侠非法修改客户端或商业代打恶意刷分，为了维护江湖的公平原则，" ..
	"特将少侠已获得的480品和515品名剑大会装备没收，清除少侠所有名剑币、名剑战队积分和个人积分，同时清零少侠的名剑大会个人段位，且个人名剑币周上限恢复至1800的初始值！" ..
	"\n　　望少侠以后能谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！\n\n      隐元会敬上。"
	SendSystemMail("隐元会执掌使", szPlayerName, "非法修改客户端处罚", szPlayerName .. szMailText)
	player.SendSystemMessage("因少侠使用非法修改客户端或商业代打恶意刷分，特删除少侠已获得的480品和515品名剑大会装备，" ..
	"清除少侠所有名剑币、名剑战队积分和个人积分，同时清零少侠的名剑大会个人段位！望少侠谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！")
	Log(
		string.format(
		"[JJC_PUNISHMENT_20140929]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID
	)
	)
end

-- 2014年9月21日外装调查问卷漏发奖励补偿
function Compensate_20141013(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2014, 10, 13, 7, 0, 0)
	local nEndTime = DateToTime(2014, 11, 13, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.COMPENSATE_20141013}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.COMPENSATE_20141013, true)
end

tActivityRecall[ACTIVITY_MANAGER.COMPENSATE_20141013] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.COMPENSATE_20141013] then
		return
	end

	local tItem_20141013 = {
		{ITEM_TABLE_TYPE.OTHER, 10389, 2, 0}, -- 通达券 * 2
		{ITEM_TABLE_TYPE.OTHER, 21030, 1, 0}, -- 隐元秘宝・五行石(伍) * 1
		{ITEM_TABLE_TYPE.OTHER, 20556, 300, 0}, -- 萤石碎片 * 300
	}
	local szMailText = player.szName .. "：\n　　见信好！\n　　感谢少侠参与《剑网3》问卷调研活动，以及一直以来对《剑网3》的支持。\n　　随信附上调研活动漏发的奖励，请查收。\n\n      隐元会敬上。"
	SendSystemMail("隐元会执掌使", player.szName, "问卷调研奖励", szMailText, 0, tItem_20141013)

	Log(
		string.format(
		"[COMPENSATE_20141013]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID
	)
	)
end

-------------------------------------------------JJC--------------------------------------------------------------------
-- 竞技场赛季奖励 2014.12.02
function JJC_Reward_20141202(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return  -- 只在国内版本（金山&盛大）做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2014, 12, 4, 0, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2015, 3, 4, 0, 0, 0)  -- 暂定处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end
	tActivityIndexList = {ACTIVITY_MANAGER.JJC_REWARD_2V2_20141202}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_REWARD_2V2_20141202, true)

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_REWARD_3V3_20141202}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_REWARD_3V3_20141202, true)

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_REWARD_5V5_20141202}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_REWARD_5V5_20141202, true)
end
-----------------------------------2v2---------------------------------------------------------------------------------
tActivityRecall[ACTIVITY_MANAGER.JJC_REWARD_2V2_20141202] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_2V2_20141202] then
		return
	end

	local nPersonalScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_2V2_20141202][0]
	local nTeamScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_2V2_20141202][1]
	local nTeamRank = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_2V2_20141202][2]

	local szMailText = string.format(
		"　　倚剑狂歌战九州，抹刀不舞定江湖！" ..
		"\n　　恭喜您，【%s】大侠！您的战队在上届名剑大会2对2战中，以%d点积分取得了第%d名的优秀战绩，" ..
		"其中您的个人贡献点为%d（并且不低于队伍积分200点）。" ..
		"\n　　我们特为您发放上届名剑大会赛季排名奖励。" ..
		"\n　　为了给广大侠士提供一个健康公平的游戏环境，此次排名排除了所有在赛季期间利用非法手段不公平竞技的角色排名。" ..
		"让我们共同努力，为维护游戏公平竞技不懈努力！" ..
		"\n　　预祝您在新的名剑大会赛季中战无不胜！ " ..
		"\n\n　　《剑网3》运营团队",
		szPlayerName, nTeamScore, nTeamRank, nPersonalScore
	)

	local nGrade = 1
	local tItem = {
		[1] = {{5, 22564, 1, 0}, {8, 10175, 1, 0}, {8, 10176, 1, 0}},
		[2] = {{5, 22565, 1, 0}, {8, 10175, 1, 0}, {8, 10176, 1, 0}},
		[3] = {{5, 22566, 1, 0}, {8, 10175, 1, 0}},
	}

	if nTeamRank <= 3 then
		nGrade = 1
	elseif nTeamRank <= 50 then
		nGrade = 2
	else
		nGrade = 3
	end

	if not tItem[nGrade] then
		return
	end

	SendSystemMail("《剑网3》运营团队", player.szName, "上届名剑大会赛季排名说明", szMailText, 0, tItem[nGrade])
end
-----------------------------------3v3---------------------------------------------------------------------------------
tActivityRecall[ACTIVITY_MANAGER.JJC_REWARD_3V3_20141202] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_3V3_20141202] then
		return
	end

	local nPersonalScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_3V3_20141202][0]
	local nTeamScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_3V3_20141202][1]
	local nTeamRank = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_3V3_20141202][2]

	local szMailText = string.format(
		"　　倚剑狂歌战九州，抹刀不舞定江湖！" ..
		"\n　　恭喜您，【%s】大侠！您的战队在上届名剑大会3对3战中，以%d点积分取得了第%d名的优秀战绩，" ..
		"其中您的个人贡献点为%d（并且不低于队伍积分200点）。" ..
		"\n　　我们特为您发放上届名剑大会赛季排名奖励。" ..
		"\n　　为了给广大侠士提供一个健康公平的游戏环境，此次排名排除了所有在赛季期间利用非法手段不公平竞技的角色排名。" ..
		"让我们共同努力，为维护游戏公平竞技不懈努力！" ..
		"\n　　预祝您在新的名剑大会赛季中战无不胜！ " ..
		"\n\n　　《剑网3》运营团队",
		szPlayerName, nTeamScore, nTeamRank, nPersonalScore
	)

	local nGrade = 1
	local tItem = {
		[1] = {{5, 22564, 1, 0}, {8, 10175, 1, 0}, {8, 10176, 1, 0}},
		[2] = {{5, 22565, 1, 0}, {8, 10175, 1, 0}, {8, 10176, 1, 0}},
		[3] = {{5, 22566, 1, 0}, {8, 10175, 1, 0}},
	}

	if nTeamRank <= 3 then
		nGrade = 1
	elseif nTeamRank <= 50 then
		nGrade = 2
	else
		nGrade = 3
	end

	if not tItem[nGrade] then
		return
	end

	SendSystemMail("《剑网3》运营团队", player.szName, "上届名剑大会赛季排名说明", szMailText, 0, tItem[nGrade])
end
-----------------------------------5v5---------------------------------------------------------------------------------
tActivityRecall[ACTIVITY_MANAGER.JJC_REWARD_5V5_20141202] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_5V5_20141202] then
		return
	end

	local nPersonalScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_5V5_20141202][0]
	local nTeamScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_5V5_20141202][1]
	local nTeamRank = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_5V5_20141202][2]

	local szMailText = string.format(
		"　　倚剑狂歌战九州，抹刀不舞定江湖！" ..
		"\n　　恭喜您，【%s】大侠！您的战队在上届名剑大会5对5战中，以%d点积分取得了第%d名的优秀战绩，" ..
		"其中您的个人贡献点为%d（并且不低于队伍积分200点）。" ..
		"\n　　我们特为您发放上届名剑大会赛季排名奖励。" ..
		"\n　　为了给广大侠士提供一个健康公平的游戏环境，此次排名排除了所有在赛季期间利用非法手段不公平竞技的角色排名。" ..
		"让我们共同努力，为维护游戏公平竞技不懈努力！" ..
		"\n　　预祝您在新的名剑大会赛季中战无不胜！ " ..
		"\n\n　　《剑网3》运营团队",
		szPlayerName, nTeamScore, nTeamRank, nPersonalScore
	)

	local nGrade = 1
	local tItem = {
		[1] = {{5, 22564, 1, 0}, {8, 10175, 1, 0}, {8, 10176, 1, 0}},
		[2] = {{5, 22565, 1, 0}, {8, 10175, 1, 0}, {8, 10176, 1, 0}},
		[3] = {{5, 22566, 1, 0}, {8, 10175, 1, 0}},
	}

	if nTeamRank <= 3 then
		nGrade = 1
	elseif nTeamRank <= 50 then
		nGrade = 2
	else
		nGrade = 3
	end

	if not tItem[nGrade] then
		return
	end

	SendSystemMail("《剑网3》运营团队", player.szName, "上届名剑大会赛季排名说明", szMailText, 0, tItem[nGrade])
end

-- 2014年6月竞技场恶性代打惩罚
function JJC_Punishment_20141223(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2014, 12, 29, 7, 0, 0)
	local nEndTime = DateToTime(2015, 3, 29, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_PUNISHEMNT_20141223}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_PUNISHEMNT_20141223, true)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_PUNISHEMNT_20141223] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_PUNISHEMNT_20141223] then
		return
	end

	-- 删除装备
	for _, v in pairs(JJC_EQUIPMENT_515) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end
	for _, v in pairs(JJC_EQUIPMENT_555) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end

	-- 清除名剑币、踢出战队
	local nArenaAward = player.nArenaAward
	player.AddArenaAward( - nArenaAward, "OTHER")

	-- 名剑大会段位和名剑币周上限重置
	player.nArenaLevel2v2 = 0
	player.nArenaLevel3v3 = 0
	player.nArenaLevel5v5 = 0
	local nArenaSpace = player.GetArenaAwardRemainSpace()
	player.AddArenaAwardRemainSpace(1800 - nArenaSpace)

	for i = 0, 2 do
		GCCommand("SendGMCommondArenaServer(\"ForceDelMember('" .. player.dwCorpsSystemID .. "','" .. i .. "')\")")
	end

	local szMailText = "：\n　　见信好！\n　　前段时日隐元会查出少侠非法修改客户端或商业代打恶意刷分，为了维护江湖的公平原则，" ..
	"特将少侠已获得的515品和555品名剑大会装备没收，清除少侠所有名剑币、名剑战队积分和个人积分，同时清零少侠的名剑大会个人段位，且个人名剑币周上限恢复至1800的初始值！" ..
	"\n　　望少侠以后能谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！\n\n      隐元会敬上。"
	SendSystemMail("隐元会执掌使", szPlayerName, "非法修改客户端处罚", szPlayerName .. szMailText)
	player.SendSystemMessage("因少侠使用非法修改客户端或商业代打恶意刷分，特删除少侠已获得的515品和555品名剑大会装备，" ..
	"清除少侠所有名剑币、名剑战队积分和个人积分，同时清零少侠的名剑大会个人段位！望少侠谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！")
	Log(
		string.format(
		"[JJC_PUNISHEMNT_20141223]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID
	)
	)
end

-- 2015年1月缘定三生服务器竞技场恶性代打惩罚
function JJC_Punishment_20150107(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2015, 1, 7, 7, 0, 0)
	local nEndTime = DateToTime(2015, 4, 7, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_PUNISHEMNT_20150107}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_PUNISHEMNT_20150107, true)

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_PUNISHEMNT_20150108}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_PUNISHEMNT_20150108, true)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_PUNISHEMNT_20150107] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_PUNISHEMNT_20150107] then
		return
	end

	-- 删除装备
	for _, v in pairs(JJC_EQUIPMENT_515) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end
	for _, v in pairs(JJC_EQUIPMENT_555) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end

	-- 清除名剑币、踢出战队
	local nArenaAward = player.nArenaAward
	nArenaAward = 4800 - nArenaAward
	if nArenaAward > 0 then
		player.AddArenaAwardRemainSpace(nArenaAward)
	end
	player.AddArenaAward(nArenaAward, "OTHER")

	-- 名剑大会段位和名剑币周上限重置
	player.nArenaLevel2v2 = 0
	player.nArenaLevel3v3 = 0
	player.nArenaLevel5v5 = 0
	local nArenaSpace = player.GetArenaAwardRemainSpace()
	player.AddArenaAwardRemainSpace(1800 - nArenaSpace)

	for i = 0, 2 do
		GCCommand("SendGMCommondArenaServer(\"ForceDelMember('" .. player.dwCorpsSystemID .. "','" .. i .. "')\")")
	end

	local szMailText = "：\n　　见信好！\n　　前段时日隐元会查出少侠非法修改客户端或商业代打恶意刷分，为了维护江湖的公平原则，" ..
	"特将少侠已获得的515品和555品名剑大会装备没收，清除少侠所有名剑币（但因清除滞后两周，特补偿少侠4800名剑币）、名剑战队积分和个人积分，同时清零少侠的名剑大会个人段位，且个人名剑币周上限恢复至1800的初始值！" ..
	"\n　　望少侠以后能谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！\n\n      隐元会敬上。"
	SendSystemMail("隐元会执掌使", szPlayerName, "非法修改客户端处罚", szPlayerName .. szMailText)
	player.SendSystemMessage("因少侠使用非法修改客户端或商业代打恶意刷分，特删除少侠已获得的515品和555品名剑大会装备，" ..
	"清除少侠所有名剑币（但因清除滞后两周，特补偿少侠4800名剑币）、名剑战队积分和个人积分，同时清零少侠的名剑大会个人段位！望少侠谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！")
	Log(
		string.format(
		"[JJC_PUNISHEMNT_20150107]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID
	)
	)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_PUNISHEMNT_20150108] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_PUNISHEMNT_20150108] then
		return
	end

	-- 删除装备
	for _, v in pairs(JJC_EQUIPMENT_515) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end
	for _, v in pairs(JJC_EQUIPMENT_555) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end

	-- 清除名剑币、踢出战队
	local nArenaAward = player.nArenaAward
	player.AddArenaAward( - nArenaAward, "OTHER")

	-- 名剑大会段位和名剑币周上限重置
	player.nArenaLevel2v2 = 0
	player.nArenaLevel3v3 = 0
	player.nArenaLevel5v5 = 0
	local nArenaSpace = player.GetArenaAwardRemainSpace()
	player.AddArenaAwardRemainSpace(1800 - nArenaSpace)

	for i = 0, 2 do
		GCCommand("SendGMCommondArenaServer(\"ForceDelMember('" .. player.dwCorpsSystemID .. "','" .. i .. "')\")")
	end

	local szMailText = "：\n　　见信好！\n　　前段时日隐元会查出少侠非法修改客户端或商业代打恶意刷分，为了维护江湖的公平原则，" ..
	"特将少侠已获得的515品和555品名剑大会装备没收，清除少侠所有名剑币、名剑战队积分和个人积分，同时清零少侠的名剑大会个人段位，且个人名剑币周上限恢复至1800的初始值！" ..
	"\n　　望少侠以后能谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！\n\n      隐元会敬上。"
	SendSystemMail("隐元会执掌使", szPlayerName, "非法修改客户端处罚", szPlayerName .. szMailText)
	player.SendSystemMessage("因少侠使用非法修改客户端或商业代打恶意刷分，特删除少侠已获得的515品和555品名剑大会装备，" ..
	"清除少侠所有名剑币、名剑战队积分和个人积分，同时清零少侠的名剑大会个人段位！望少侠谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！")
	Log(
		string.format(
		"[JJC_PUNISHEMNT_20141223]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID
	)
	)
end

-------------------------------------------------JJC--------------------------------------------------------------------
-- 竞技场赛季奖励 2015.04.20
function JJC_Reward_20150420(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return  -- 只在国内版本（金山&盛大）做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2015, 4, 20, 0, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2015, 7, 20, 0, 0, 0)  -- 暂定处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_REWARD_3V3_20150420}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_REWARD_3V3_20150420, true)

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_REWARD_5V5_20150420}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_REWARD_5V5_20150420, true)
end
-----------------------------------3v3---------------------------------------------------------------------------------
tActivityRecall[ACTIVITY_MANAGER.JJC_REWARD_3V3_20150420] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_3V3_20150420] then
		return
	end

	local nPersonalScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_3V3_20150420][0]
	local nTeamScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_3V3_20150420][1]
	local nTeamRank = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_3V3_20150420][2]

	local szMailText = string.format(
		"　　倚剑狂歌战九州，抹刀不舞定江湖！" ..
		"\n　　恭喜您，【%s】大侠！您的战队在上届名剑大会精英赛3对3战中，以%d点积分取得了第%d名的优秀战绩，" ..
		"其中您的个人贡献点为%d（并且个人参与场次不为0次）。" ..
		"\n　　我们特为您发放上届名剑大会赛季排名奖励。" ..
		"\n　　为了给广大侠士提供一个健康公平的游戏环境，此次排名排除了所有在赛季期间利用非法手段不公平竞技的角色排名。" ..
		"让我们共同努力，为维护游戏公平竞技不懈努力！" ..
		"\n　　预祝您在新的名剑大会赛季中战无不胜！ " ..
		"\n\n　　《剑网3》运营团队",
		szPlayerName, nTeamScore, nTeamRank, nPersonalScore
	)

	local nGrade = 1
	local tItem = {
		[1] = {{5, 23043, 1, 0}, {8, 13728, 1, 0}, {8, 13729, 1, 0}},
		[2] = {{5, 23044, 1, 0}, {8, 13728, 1, 0}},
		[3] = {{5, 23045, 1, 0}, {8, 13729, 1, 0}},
	}

	if nTeamRank <= 3 then
		nGrade = 1
	elseif nTeamRank <= 50 then
		nGrade = 2
	else
		nGrade = 3
	end

	if not tItem[nGrade] then
		return
	end

	SendSystemMail("《剑网3》运营团队", player.szName, "上届名剑大会赛季排名说明", szMailText, 0, tItem[nGrade])
end
-----------------------------------5v5---------------------------------------------------------------------------------
tActivityRecall[ACTIVITY_MANAGER.JJC_REWARD_5V5_20150420] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_5V5_20150420] then
		return
	end

	local nPersonalScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_5V5_20150420][0]
	local nTeamScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_5V5_20150420][1]
	local nTeamRank = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_5V5_20150420][2]

	local szMailText = string.format(
		"　　倚剑狂歌战九州，抹刀不舞定江湖！" ..
		"\n　　恭喜您，【%s】大侠！您的战队在上届名剑大会精英赛5对5战中，以%d点积分取得了第%d名的优秀战绩，" ..
		"其中您的个人贡献点为%d（并且个人参与场次不为0次）。" ..
		"\n　　我们特为您发放上届名剑大会赛季排名奖励。" ..
		"\n　　为了给广大侠士提供一个健康公平的游戏环境，此次排名排除了所有在赛季期间利用非法手段不公平竞技的角色排名。" ..
		"让我们共同努力，为维护游戏公平竞技不懈努力！" ..
		"\n　　预祝您在新的名剑大会赛季中战无不胜！ " ..
		"\n\n　　《剑网3》运营团队",
		szPlayerName, nTeamScore, nTeamRank, nPersonalScore
	)

	local nGrade = 1
	local tItem = {
		[1] = {{5, 23043, 1, 0}, {8, 13728, 1, 0}, {8, 13729, 1, 0}},
		[2] = {{5, 23044, 1, 0}, {8, 13728, 1, 0}},
		[3] = {{5, 23045, 1, 0}, {8, 13729, 1, 0}},
	}

	if nTeamRank <= 3 then
		nGrade = 1
	elseif nTeamRank <= 50 then
		nGrade = 2
	else
		nGrade = 3
	end

	if not tItem[nGrade] then
		return
	end

	SendSystemMail("《剑网3》运营团队", player.szName, "上届名剑大会赛季排名说明", szMailText, 0, tItem[nGrade])
end

-------------------------------------------------手办补偿--------------------------------------------------------------------
-- 手办到期补偿 2015.05.12
function GarageKits_20150512(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return  -- 只在国内版本（金山&盛大）做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2015, 5, 14, 0, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2015, 8, 14, 0, 0, 0)  -- 暂定处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end

	tActivityIndexList = {ACTIVITY_MANAGER.GARAGEKITS_20150512}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.GARAGEKITS_20150512, true)

end

tActivityRecall[ACTIVITY_MANAGER.GARAGEKITS_20150512] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.GARAGEKITS_20150512] then
		return
	end

	local tDataList = {}

	local dwPlayerID_2 = tActivityRosterList[ACTIVITY_MANAGER.GARAGEKITS_20150512][0]
	tDataList[1] = tActivityRosterList[ACTIVITY_MANAGER.GARAGEKITS_20150512][1]
	tDataList[2] = tActivityRosterList[ACTIVITY_MANAGER.GARAGEKITS_20150512][2]
	tDataList[3] = tActivityRosterList[ACTIVITY_MANAGER.GARAGEKITS_20150512][3]
	tDataList[4] = tActivityRosterList[ACTIVITY_MANAGER.GARAGEKITS_20150512][4]
	tDataList[5] = tActivityRosterList[ACTIVITY_MANAGER.GARAGEKITS_20150512][5]

	if player.dwID ~= dwPlayerID_2 then

		Log(
			string.format(
			"GARAGEKITS_20150512 %d与%d角色ID不匹配，%s不发放手办补偿",
			player.dwID, dwPlayerID_2, szPlayerName
		)
		)
		return
	end

	local tItemList = {}
	for _, v in pairs(tDataList) do
		if v ~= 0 then
			table.insert(tItemList, {5, v, 1, 0})
		end
	end

	--for i = 1, #tDataList do
		--if tDataList[i] ~= 0 then
			--table.insert(tItemList, {5, tDataList[i], 1, 0})
		--end
	--end

	local szMailText = "：\n　　见信好！" ..
	"\n　　近日突发异象，导致侠士手办道具未及使用便已消失，特为侠士重新发送，因此带来的不便深感抱歉。" ..
	"\n\n      隐元会敬上。"

	SendSystemMail("隐元会执掌使", player.szName, "手办道具", player.szName .. szMailText, 0, tItemList)

	Log(
		string.format(
		"GARAGEKITS_20150512 角色ID：%d，角色名：%s，补偿手办于%d，%d，%d，%d，%d已发送完成。",
		dwPlayerID, szPlayerName, tDataList[1], tDataList[2], tDataList[3], tDataList[4], tDataList[5]
	)
	)

	local tSpecialList = {
		[39] = {
			["叶晚阳"] = {{5, 22896, 1, 0}, {5, 22892, 1, 0}, {5, 22900, 1, 0}, {5, 22900, 1, 0}, {5, 22896, 1, 0}, {5, 22896, 1, 0}},
			["到我的味道的"] = {{5, 22890, 1, 0}, {5, 22890, 1, 0}, {5, 22890, 1, 0}, {5, 22892, 1, 0},
			{5, 22892, 1, 0}, {5, 22906, 1, 0}, {5, 22906, 1, 0}, {5, 22906, 1, 0}}
		},
		[21] = {
			["章中道"] = {{5, 22927, 1, 0}, {5, 22924, 1, 0}, {5, 22926, 1, 0}, {5, 22908, 1, 0}}
		},
		[9] = {
			["琬流"] = {{5, 22892, 1, 0}, {5, 22890, 1, 0}, {5, 22888, 1, 0}},
		},
		[53] = {
			["猥琐的碧蝶"] = {{5, 22908, 1, 0}},
			["岳绯烟"] = {{5, 22898, 1, 0}, {5, 22900, 1, 0}, {5, 22902, 1, 0}, {5, 22906, 1, 0}, {5, 22908, 1, 0}},
		},
		[1] = {
			["夜酒@荻花宫"] = {{5, 22898, 1, 0}, {5, 22906, 1, 0}}
		},
		[8] = {
			["页无笙"] = {{5, 22896, 1, 0}}
		},
		[26] = {
			["莫诗"] = {{5, 22890, 1, 0}}
		}
	}
	local nServerIndex = GetServerIndex()
	if tSpecialList[nServerIndex] and tSpecialList[nServerIndex][player.szName] then
		SendSystemMail("隐元会执掌使", player.szName, "手办道具", player.szName .. szMailText, 0, tSpecialList[nServerIndex][player.szName])
		Log(
			string.format(
			"GARAGEKITS_20150512 角色名：%s，补偿手办特殊处理部分发送完毕。",
			player.szName
		)
		)
	end
end
--]]
-------------------------------------------------竞速本称号奖励--------------------------------------------------------------------
-- 竞速本称号奖励 2015.05.21
--[[
function DungeonTitle_20150521(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return  -- 只在国内版本（金山&盛大）做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2015, 5, 21, 0, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2015, 8, 21, 0, 0, 0)  -- 暂定处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end

	tActivityIndexList = {ACTIVITY_MANAGER.DUNGEONTITLE_20150521}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.DUNGEONTITLE_20150521, true)

end

tActivityRecall[ACTIVITY_MANAGER.DUNGEONTITLE_20150521] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.DUNGEONTITLE_20150521] then
		return
	end

	local tDataList = {}

	local dwPlayerID_2 = tActivityRosterList[ACTIVITY_MANAGER.DUNGEONTITLE_20150521][0]
	tDataList[1] = tActivityRosterList[ACTIVITY_MANAGER.DUNGEONTITLE_20150521][1]
	tDataList[2] = tActivityRosterList[ACTIVITY_MANAGER.DUNGEONTITLE_20150521][2]
	tDataList[3] = tActivityRosterList[ACTIVITY_MANAGER.DUNGEONTITLE_20150521][3]
	tDataList[4] = tActivityRosterList[ACTIVITY_MANAGER.DUNGEONTITLE_20150521][4]

	if player.dwID ~= dwPlayerID_2 then

		Log(
			string.format(
			"DUNGEONTITLE_20150521 %d与%d角色ID不匹配，%s不发放挑战本竞速奖励称号",
			player.dwID, dwPlayerID_2, szPlayerName
		)
		)
		return
	end

	local tItemList = {}
	for _, v in pairs(tDataList) do
		if v ~= 0 then
			table.insert(tItemList, {5, v, 1, 0})
		end
	end

	--for i = 1, #tDataList do
		--if tDataList[i] ~= 0 then
			--table.insert(tItemList, {5, tDataList[i], 1, 0})
		--end
	--end

	local szMailText = "：\n　　见信好！" ..
	"\n　　依据侠士在10人太原之战挑战本竞速赛中的杰出表现，在此奉上对应称号奖励，希望侠士日后再接再厉，引领群雄，匡复大唐。" ..
	"\n\n      隐元会敬上。"

	SendSystemMail("隐元会执掌使", player.szName, "10人太原之战挑战本竞速称号奖励", player.szName .. szMailText, 0, tItemList)

	Log(
		string.format(
		"DUNGEONTITLE_20150521 角色ID：%d，角色名：%s，竞速本奖励称号%d，%d，%d，%d，已发送完成。",
		dwPlayerID, szPlayerName, tDataList[1], tDataList[2], tDataList[3], tDataList[4]
	)
	)
end
--]]
-- 2015年5月竞技场恶性代打惩罚
--[[
function JJC_Punishment_20150615(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2014, 6, 18, 7, 0, 0)
	local nEndTime = DateToTime(2015, 9, 18, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_PUNISHMENT_20150615}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_PUNISHMENT_20150615, true)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_PUNISHMENT_20150615] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_PUNISHMENT_20150615] then
		return
	end

	-- 删除装备
	for _, v in pairs(JJC_EQUIPMENT_555) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end
	for _, v in pairs(JJC_EQUIPMENT_595) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end

	-- 清除名剑币、踢出战队
	local nArenaAward = player.nArenaAward
	player.AddArenaAward( - nArenaAward, "OTHER")

	-- 名剑大会段位和名剑币周上限重置
	player.nArenaLevel2v2 = 0
	player.nArenaLevel3v3 = 0
	player.nArenaLevel5v5 = 0
	local nArenaSpace = player.GetArenaAwardRemainSpace()
	player.AddArenaAwardRemainSpace(1800 - nArenaSpace)

	for i = 0, 2 do
		GCCommand("SendGMCommondArenaServer(\"ForceDelMember('" .. player.dwCorpsSystemID .. "','" .. i .. "')\")")
	end

	local szMailText = "：\n　　见信好！\n　　前段时日隐元会查出少侠非法修改客户端或使用第三方辅助程序，为了维护江湖的公平原则，" ..
	"特将少侠已获得的555品和595品名剑大会装备回收，清除少侠所有名剑币、名剑战队积分和个人积分，同时清零少侠的名剑大会个人段位，且个人名剑币周上限恢复至1800的初始值！" ..
	"\n　　望少侠以后能谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！\n\n      隐元会敬上。"
	SendSystemMail("隐元会执掌使", szPlayerName, "非法修改客户端处罚", szPlayerName .. szMailText)
	player.SendSystemMessage("因少侠非法修改客户端或使用第三方辅助程序，特删除少侠已获得的555品和595品名剑大会装备，" ..
	"清除少侠所有名剑币、名剑战队积分和个人积分，同时清零少侠的名剑大会个人段位！望少侠谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！")
	Log(
		string.format(
		"[JJC_Punishment_20150615]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID
	)
	)
end
--]]
-- 2015年6月竞技场恶性代打惩罚
--[[
function JJC_Punishment_20150716(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2014, 7, 20, 7, 0, 0)
	local nEndTime = DateToTime(2015, 10, 20, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_PUNISHMENT_20150716}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_PUNISHMENT_20150716, true)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_PUNISHMENT_20150716] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_PUNISHMENT_20150716] then
		return
	end

	-- 删除装备
	for _, v in pairs(JJC_EQUIPMENT_555) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end
	for _, v in pairs(JJC_EQUIPMENT_595) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end

	-- 清除名剑币、踢出战队
	local nArenaAward = player.nArenaAward
	player.AddArenaAward( - nArenaAward, "OTHER")

	-- 名剑大会段位和名剑币周上限重置
	player.nArenaLevel2v2 = 0
	player.nArenaLevel3v3 = 0
	player.nArenaLevel5v5 = 0
	local nArenaSpace = player.GetArenaAwardRemainSpace()
	player.AddArenaAwardRemainSpace(1800 - nArenaSpace)

	for i = 0, 2 do
		GCCommand("SendGMCommondArenaServer(\"ForceDelMember('" .. player.dwCorpsSystemID .. "','" .. i .. "')\")")
	end

	local szMailText = "：\n　　见信好！\n　　前段时日隐元会查出少侠非法修改客户端或使用第三方辅助程序，为了维护江湖的公平原则，" ..
	"特将少侠已获得的555品和595品名剑大会装备回收，清除少侠所有名剑币、名剑战队积分和个人积分，同时清零少侠的名剑大会个人段位，且个人名剑币周上限恢复至1800的初始值！" ..
	"\n　　望少侠以后能谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！\n\n      隐元会敬上。"
	SendSystemMail("隐元会执掌使", szPlayerName, "非法修改客户端处罚", szPlayerName .. szMailText)
	player.SendSystemMessage("因少侠非法修改客户端或使用第三方辅助程序，特删除少侠已获得的555品和595品名剑大会装备，" ..
	"清除少侠所有名剑币、名剑战队积分和个人积分，同时清零少侠的名剑大会个人段位！望少侠谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！")
	Log(
		string.format(
		"[JJC_PUNISHMENT_20150716]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID
	)
	)
end
--]]
-- 2015年中秋节补偿玩家的烟花和宴席
--[[
function ZHONGQIU_Yanhua_20150928(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2015, 9, 28, 7, 0, 0)
	local nEndTime = DateToTime(2015, 10, 28, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20150928}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20150928, true)
end

-- 潮升明月补偿
tActivityRecall[ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20150928] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20150928] then
		return
	end
	if tActivityRosterList[ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20150928][0] < 1 then
		Log(
			string.format(
		"[ZHONGQIU_YANHUA_20150928]:  Count == 0!!! PlayerName:%s, PlayerID:%d, szAccount:%s", player.szName, player.dwID, player.szAccount)
		)
		return
	end

	local szMailText = "：\n　　见信好！\n　　近日异象频发，导致出售的【潮升明月】无法使用，隐元会深感歉意。特此将大侠购买时花费的金钱退还于你，请查收。\n\n      隐元会敬上。"
	SendSystemMail("隐元会执掌使", szPlayerName, "【潮升明月】补偿", szPlayerName .. szMailText, 5000000 * tActivityRosterList[ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20150928][0])
	player.SendSystemMessage("近日异象频发，导致出售的【潮升明月】无法使用，隐元会深感歉意。特此将大侠购买时花费的金钱退还于你，请查收邮件。")
	Log(
		string.format(
	"[ZHONGQIU_YANHUA_20150928]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID)
	)

end
--]]
-- 2015年中秋节补偿玩家的烟花和宴席
--[[
function ZHONGQIU_Yanhua_20150928_1(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2015, 9, 28, 7, 0, 0)
	local nEndTime = DateToTime(2015, 10, 28, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20150928_1}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20150928_1, true)
end

--芙蓉出水宴
tActivityRecall[ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20150928_1] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20150928_1] then
		return
	end

	if tActivityRosterList[ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20150928_1][0] < 1 then
		Log(
			string.format(
		"[ZHONGQIU_YANHUA_20150928]:  Count == 0!!! PlayerName:%s, PlayerID:%d, szAccount:%s", player.szName, player.dwID, player.szAccount)
		)
		return
	end
	local nCount = tActivityRosterList[ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20150928_1][0]
	local szMailText = "：\n　　见信好！\n　　近日异象频发，导致出售的【芙蓉出水宴】无法使用，隐元会深感歉意。特补偿大侠数个【吉庆赏钱】与一些金钱，请查收。\n\n      隐元会敬上。"
	SendSystemMail("隐元会执掌使", szPlayerName, "【芙蓉出水宴】补偿", szPlayerName .. szMailText, 10500000 * nCount, {{5, 4922, 120 * nCount, 0}})
	player.SendSystemMessage("近日异象频发，导致出售的【芙蓉出水宴】无法使用，隐元会深感歉意。特补偿大侠数个【吉庆赏钱】与一些金钱，请查收邮件。")
	Log(
		string.format(
	"[ZHONGQIU_YANHUA_20150928]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID)
	)

end
--]]
-- 2015年中秋节补偿玩家 2015-10-6
--[[
function ZHONGQIU_YANHUA_20151006(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2015, 10, 6, 7, 0, 0)
	local nEndTime = DateToTime(2015, 11, 6, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20151006}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20151006, true)
end

-- 潮升明月补偿 2015-10-6
tActivityRecall[ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20151006] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20151006] then
		return
	end
	if tActivityRosterList[ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20151006][0] < 1 then
		Log(
			string.format(
		"[ZHONGQIU_YANHUA_20151006]:  Count == 0!!! PlayerName:%s, PlayerID:%d, szAccount:%s", player.szName, player.dwID, player.szAccount)
		)
		return
	end

	local szMailText = "：\n　　见信好！\n　　近日异象频发，导致出售的【潮升明月】无法使用，隐元会深感歉意。特此将大侠购买时花费的金钱退还于你，请查收。\n\n      隐元会敬上。"
	SendSystemMail("隐元会执掌使", szPlayerName, "【潮升明月】补偿", szPlayerName .. szMailText, 5000000 * tActivityRosterList[ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20151006][0])
	player.SendSystemMessage("近日异象频发，导致出售的【潮升明月】无法使用，隐元会深感歉意。特此将大侠购买时花费的金钱退还于你，请查收邮件。")
	Log(
		string.format(
	"[ZHONGQIU_YANHUA_20151006]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID)
	)

end
--]]
-- 2015年中秋节补偿玩家的烟花和宴席 2015-10-6
--[[
function ZHONGQIU_YANHUA_20151006_1(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2015, 10, 6, 7, 0, 0)
	local nEndTime = DateToTime(2015, 11, 6, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20151006_1}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20151006_1, true)
end

--芙蓉出水宴 2015-10-6
tActivityRecall[ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20151006_1] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20151006_1] then
		return
	end

	if tActivityRosterList[ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20151006_1][0] < 1 then
		Log(
			string.format(
		"[ZHONGQIU_YANHUA_20151006_1]:  Count == 0!!! PlayerName:%s, PlayerID:%d, szAccount:%s", player.szName, player.dwID, player.szAccount)
		)
		return
	end
	local nCount = tActivityRosterList[ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20151006_1][0]
	local szMailText = "：\n　　见信好！\n　　近日异象频发，导致出售的【芙蓉出水宴】无法使用，隐元会深感歉意。特补偿大侠一些金钱，请查收。\n\n      隐元会敬上。"
	SendSystemMail("隐元会执掌使", szPlayerName, "【芙蓉出水宴】补偿", szPlayerName .. szMailText, 10500000 * nCount)
	player.SendSystemMessage("近日异象频发，导致出售的【芙蓉出水宴】无法使用，隐元会深感歉意。特补偿大侠一些金钱，请查收邮件。")
	Log(
		string.format(
	"[ZHONGQIU_YANHUA_20151006_1]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID)
	)

end
--]]
-- 潮升明月补偿 2015-10-18
--[[
function ZHONGQIU_YANHUA_20151018(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2015, 10, 19, 7, 0, 0)
	local nEndTime = DateToTime(2015, 11, 18, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20151018}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20151018, true)
end

-- 潮升明月补偿 2015-10-18
tActivityRecall[ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20151018] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20151018] then
		return
	end
	if tActivityRosterList[ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20151018][0] < 1 then
		Log(
			string.format(
		"[ZHONGQIU_YANHUA_20151018]:  Count == 0!!! PlayerName:%s, PlayerID:%d, szAccount:%s", player.szName, player.dwID, player.szAccount)
		)
		return
	end

	local szMailText = "：\n　　见信好！\n　　近日异象频发，导致出售的【潮升明月】无法使用，隐元会深感歉意。特此将大侠购买时花费的金钱退还于你，请查收。\n\n      隐元会敬上。"
	SendSystemMail("隐元会执掌使", szPlayerName, "【潮升明月】补偿", szPlayerName .. szMailText, 5000000 * tActivityRosterList[ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20151018][0])
	player.SendSystemMessage("近日异象频发，导致出售的【潮升明月】无法使用，隐元会深感歉意。特此将大侠购买时花费的金钱退还于你，请查收邮件。")
	Log(
		string.format(
	"[ZHONGQIU_YANHUA_20151018]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID)
	)

end
--]]
-- 潮升明月补偿 2015-10-23
--[[
function ZHONGQIU_YANHUA_20151023(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2015, 10, 26, 7, 0, 0)
	local nEndTime = DateToTime(2015, 11, 26, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20151023}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20151023, true)
end

-- 潮升明月补偿 2015-10-23
tActivityRecall[ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20151023] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20151023] then
		return
	end
	if tActivityRosterList[ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20151023][0] < 1 then
		Log(
			string.format(
		"[ZHONGQIU_YANHUA_20151023]:  Count == 0!!! PlayerName:%s, PlayerID:%d, szAccount:%s", player.szName, player.dwID, player.szAccount)
		)
		return
	end

	local szMailText = "：\n　　见信好！\n　　近日异象频发，导致出售的【潮升明月】无法使用，隐元会深感歉意。特此将大侠购买时花费的金钱退还于你，请查收。\n\n      隐元会敬上。"
	SendSystemMail("隐元会执掌使", szPlayerName, "【潮升明月】补偿", szPlayerName .. szMailText, 5000000 * tActivityRosterList[ACTIVITY_MANAGER.ZHONGQIU_YANHUA_20151023][0])
	player.SendSystemMessage("近日异象频发，导致出售的【潮升明月】无法使用，隐元会深感歉意。特此将大侠购买时花费的金钱退还于你，请查收邮件。")
	Log(
		string.format(
	"[ZHONGQIU_YANHUA_20151023]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID)
	)

end
--]]
-- 竞技场赛季奖励 2015.11.02
--[[
function JJC_Reward_20151102(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return  -- 只在国内版本（金山&盛大）做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2015, 11, 02, 0, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2016, 2, 02, 0, 0, 0)  -- 暂定处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_REWARD_3V3_20151102}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_REWARD_3V3_20151102, true)

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_REWARD_5V5_20151102}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_REWARD_5V5_20151102, true)
end
-----------------------------------3v3---------------------------------------------------------------------------------
tActivityRecall[ACTIVITY_MANAGER.JJC_REWARD_3V3_20151102] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_3V3_20151102] then
		return
	end

	local nPersonalScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_3V3_20151102][0]
	local nTeamScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_3V3_20151102][1]
	local nTeamRank = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_3V3_20151102][2]

	local szMailText = string.format(
		"　　倚剑狂歌战九州，抹刀不舞定江湖！" ..
		"\n　　恭喜您，【%s】大侠！您的战队在上届名剑大会精英赛3对3战中，以%d点积分取得了第%d名的优秀战绩，" ..
		"其中您的个人贡献点为%d（并且个人参与场次不为0次）。" ..
		"\n　　我们特为您发放上届名剑大会赛季排名奖励。" ..
		"\n　　为了给广大侠士提供一个健康公平的游戏环境，此次排名排除了所有在赛季期间利用非法手段不公平竞技的角色排名。" ..
		"让我们共同努力，为维护游戏公平竞技不懈努力！" ..
		"\n　　预祝您在新的名剑大会赛季中战无不胜！ " ..
		"\n\n　　《剑网3》运营团队",
		szPlayerName, nTeamScore, nTeamRank, nPersonalScore
	)

	local nGrade = 1
	local tItem = {
		[1] = {{5, 25858, 1, 0}, {8, 16685, 1, 0}, {8, 16686, 1, 0}},
		[2] = {{5, 25859, 1, 0}, {8, 16686, 1, 0}},
		[3] = {{5, 25860, 1, 0}, {8, 16685, 1, 0}},
	}

	if nTeamRank <= 3 then
		nGrade = 1
	elseif nTeamRank <= 50 then
		nGrade = 2
	else
		nGrade = 3
	end

	if not tItem[nGrade] then
		return
	end

	SendSystemMail("《剑网3》运营团队", player.szName, "上届名剑大会赛季排名说明", szMailText, 0, tItem[nGrade])
end
-----------------------------------5v5---------------------------------------------------------------------------------
tActivityRecall[ACTIVITY_MANAGER.JJC_REWARD_5V5_20151102] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_5V5_20151102] then
		return
	end

	local nPersonalScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_5V5_20151102][0]
	local nTeamScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_5V5_20151102][1]
	local nTeamRank = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_5V5_20151102][2]

	local szMailText = string.format(
		"　　倚剑狂歌战九州，抹刀不舞定江湖！" ..
		"\n　　恭喜您，【%s】大侠！您的战队在上届名剑大会精英赛5对5战中，以%d点积分取得了第%d名的优秀战绩，" ..
		"其中您的个人贡献点为%d（并且个人参与场次不为0次）。" ..
		"\n　　我们特为您发放上届名剑大会赛季排名奖励。" ..
		"\n　　为了给广大侠士提供一个健康公平的游戏环境，此次排名排除了所有在赛季期间利用非法手段不公平竞技的角色排名。" ..
		"让我们共同努力，为维护游戏公平竞技不懈努力！" ..
		"\n　　预祝您在新的名剑大会赛季中战无不胜！ " ..
		"\n\n　　《剑网3》运营团队",
		szPlayerName, nTeamScore, nTeamRank, nPersonalScore
	)

	local nGrade = 1
	local tItem = {
		[1] = {{5, 25858, 1, 0}, {8, 16685, 1, 0}, {8, 16686, 1, 0}},
		[2] = {{5, 25859, 1, 0}, {8, 16686, 1, 0}},
		[3] = {{5, 25860, 1, 0}, {8, 16685, 1, 0}},
	}

	if nTeamRank <= 3 then
		nGrade = 1
	elseif nTeamRank <= 50 then
		nGrade = 2
	else
		nGrade = 3
	end

	if not tItem[nGrade] then
		return
	end

	SendSystemMail("《剑网3》运营团队", player.szName, "上届名剑大会赛季排名说明", szMailText, 0, tItem[nGrade])
end

-- 台湾竞技场赛季奖励 2015.12.21
function JJC_Reward_20151221(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhtw") then
		return  -- 只在台湾服务器做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2015, 12, 21, 0, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2016, 2, 21, 0, 0, 0)  -- 暂定处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_REWARD_3V3_20151221}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_REWARD_3V3_20151221, true)

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_REWARD_5V5_20151221}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_REWARD_5V5_20151221, true)
end
-----------------------------------3v3---------------------------------------------------------------------------------
tActivityRecall[ACTIVITY_MANAGER.JJC_REWARD_3V3_20151221] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_3V3_20151221] then
		return
	end

	--local nPersonalScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_20151221][0]
	--local nTeamScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_20151221][1]
	local nTeamRank = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_3V3_20151221][0]

	local szMailText = string.format(
		"　　倚剑狂歌战九州，抹刀不舞定江湖！" ..
		"\n　　恭喜您，【%s】大侠！您的战队在上届名剑大会精英赛3对3战中取得了第%d名的优秀战绩（并且个人参与场次不为0次）。" ..
		"\n　　我们特为您发放上届名剑大会赛季排名奖励。" ..
		"\n　　为了给广大侠士提供一个健康公平的游戏环境，此次排名排除了所有在赛季期间利用非法手段不公平竞技的角色排名。" ..
		"让我们共同努力，为维护游戏公平竞技不懈努力！" ..
		"\n　　预祝您在新的名剑大会赛季中战无不胜！ " ..
		"\n\n　　《剑网3》运营团队",
		szPlayerName, nTeamRank
	)

	local nGrade = 1
	local tItem = {
		[1] = {{5, 25858, 1, 0}, {8, 16685, 1, 0}, {8, 16686, 1, 0}},
		[2] = {{5, 25859, 1, 0}, {8, 16686, 1, 0}},
		[3] = {{5, 25860, 1, 0}, {8, 16685, 1, 0}},
	}

	if nTeamRank <= 3 then
		nGrade = 1
	elseif nTeamRank <= 50 then
		nGrade = 2
	else
		nGrade = 3
	end

	if not tItem[nGrade] then
		return
	end

	SendSystemMail("《剑网3》运营团队", player.szName, "上届名剑大会赛季排名说明", szMailText, 0, tItem[nGrade])
end

-----------------------------------5V5---------------------------------------------------------------------------------
tActivityRecall[ACTIVITY_MANAGER.JJC_REWARD_5V5_20151221] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_5V5_20151221] then
		return
	end

	--local nPersonalScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_20151221][0]
	--local nTeamScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_20151221][1]
	local nTeamRank = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_5V5_20151221][0]

	local szMailText = string.format(
		"　　倚剑狂歌战九州，抹刀不舞定江湖！" ..
		"\n　　恭喜您，【%s】大侠！您的战队在上届名剑大会精英赛5对5战中取得了第%d名的优秀战绩（并且个人参与场次不为0次）。" ..
		"\n　　我们特为您发放上届名剑大会赛季排名奖励。" ..
		"\n　　为了给广大侠士提供一个健康公平的游戏环境，此次排名排除了所有在赛季期间利用非法手段不公平竞技的角色排名。" ..
		"让我们共同努力，为维护游戏公平竞技不懈努力！" ..
		"\n　　预祝您在新的名剑大会赛季中战无不胜！ " ..
		"\n\n　　《剑网3》运营团队",
		szPlayerName, nTeamRank
	)

	local nGrade = 1
	local tItem = {
		[1] = {{5, 25858, 1, 0}, {8, 16685, 1, 0}, {8, 16686, 1, 0}},
		[2] = {{5, 25859, 1, 0}, {8, 16686, 1, 0}},
		[3] = {{5, 25860, 1, 0}, {8, 16685, 1, 0}},
	}

	if nTeamRank <= 3 then
		nGrade = 1
	elseif nTeamRank <= 50 then
		nGrade = 2
	else
		nGrade = 3
	end

	if not tItem[nGrade] then
		return
	end

	SendSystemMail("《剑网3》运营团队", player.szName, "上届名剑大会赛季排名说明", szMailText, 0, tItem[nGrade])
end
--]]
-- 台湾共战BUFF补偿 2016.03.07
--[[
function TW_GongZhan_Compensate_20160307(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhtw") then
		return  -- 只在台湾服务器做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2016, 2, 22, 7, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2016, 3, 7, 7, 0, 0)  -- 暂定处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end

	tActivityIndexList = {ACTIVITY_MANAGER.TW_GZ_Compensate_20160307}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.TW_GZ_Compensate_20160307, true)

end
-----------------------------------添加BUFF---------------------------------------------------------------------------------
tActivityRecall[ACTIVITY_MANAGER.TW_GZ_Compensate_20160307] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.TW_GZ_Compensate_20160307] then
		return
	end
	if not player.GetBuff(3219, 10) then
		player.AddBuff(0, 99, 3219, 10, 672 * 360)
	end
end
--]]
-- 2016年2月竞技场恶性代打惩罚
--[[
function JJC_Punishment_20160201(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2016, 3, 1, 7, 0, 0)
	local nEndTime = DateToTime(2016, 6, 1, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_PUNISHMENT_20160301}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_PUNISHMENT_20160301, true)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_PUNISHMENT_20160301] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_PUNISHMENT_20160301] then
		return
	end

	-- 删除装备
	for _, v in pairs(JJC_EQUIPMENT_980) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end
	for _, v in pairs(JJC_EQUIPMENT_1060) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end

	-- 清除名剑币、踢出战队
	local nArenaAward = player.nArenaAward
	player.AddArenaAward( - nArenaAward, "OTHER")

	-- 名剑大会段位和名剑币周上限重置

	local nArenaSpace = player.GetArenaAwardRemainSpace()
	player.AddArenaAwardRemainSpace(1800 - nArenaSpace)

	for i = 0, 2 do
		GCCommand("SendGMCommondArenaServer(\"ForceDelMember('" .. player.dwCorpsSystemID .. "','" .. i .. "')\")")
	end

	player.ResetCorpsSystemID()--全部重置玩家JJC相关数据

	local szMailText = "：\n　　见信好！\n　　前段时日隐元会查出少侠非法修改客户端或使用第三方辅助程序，为了维护江湖的公平原则，" ..
	"特将少侠已获得的980品和1060品名剑大会装备回收，清除少侠所有名剑币、名剑战队积分和个人积分，同时清零少侠的名剑大会个人段位，且个人名剑币周上限恢复至1800的初始值！" ..
	"\n　　望少侠以后能谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！\n\n      隐元会敬上。"
	SendSystemMail("隐元会执掌使", szPlayerName, "非法修改客户端处罚", szPlayerName .. szMailText)
	player.SendSystemMessage("因少侠非法修改客户端或使用第三方辅助程序，特删除少侠已获得的980品和1060品名剑大会装备，" ..
	"清除少侠所有名剑币、名剑战队积分和个人积分，同时清零少侠的名剑大会个人段位！望少侠谨遵名剑大会规则，为江湖营造一个公平公正的竞技环境！")
	Log(
		string.format(
		"[JJC_PUNISHMENT_20160301]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID
	)
	)
end
--]]
--[[
function GUAJIAN_JINGUZHOU_20160303(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2016, 3, 3, 7, 0, 0)
	local nEndTime = DateToTime(2016, 3, 31, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JINGUZHOU_GUAJIA_20160303}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JINGUZHOU_GUAJIA_20160303, true)
end

tActivityRecall[ACTIVITY_MANAGER.JINGUZHOU_GUAJIA_20160303] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JINGUZHOU_GUAJIA_20160303] then
		return
	end
	if not player.IsPendentExist(17235) then
		return
	end

	local tItemList = {
		{ITEM_TABLE_TYPE.OTHER, 26515, 1, 0},
	}

	local szMessage_Login = player.szName .. "：\n　　见信好！\n　　由于近日少侠在立刻购买如意金箍后，该外观会直接装备在少侠身上导致少侠不能另作他用。对此我们深表歉意。" .. "针对此问题我们将回收少侠已装备的如意金箍外观，同时给少侠发放新的如意金箍道具，请查收。\n\n      隐元会敬上。"

	player.RemovePendent(17235)
	SendSystemMail("隐元会", player.szName, "异常事件处理信", szMessage_Login, 0, tItemList)
end
--]]
--[[
function NEW_JINGUZHOU_20160317(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2016, 3, 17, 7, 0, 0)
	local nEndTime = DateToTime(2016, 4, 14, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JINGUZHOU_NEW_20160317}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JINGUZHOU_NEW_20160317, true)
end

tActivityRecall[ACTIVITY_MANAGER.JINGUZHOU_NEW_20160317] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JINGUZHOU_NEW_20160317] then
		return
	end
	if not player.IsPendentExist(17235) then
		return
	end

	local tItemList = {
		{ITEM_TABLE_TYPE.OTHER, 26515, 1, 0},
	}

	local szMessage_Login = player.szName .. "：\n　　见信好！\n　　由于近日少侠在立刻购买如意金箍后，该外观会直接装备在少侠身上导致少侠不能另作他用。对此我们深表歉意。" .. "针对此问题我们将回收少侠已装备的如意金箍外观，同时给少侠发放新的如意金箍道具，请查收。\n\n      隐元会敬上。"

	player.RemovePendent(17235)
	SendSystemMail("隐元会", player.szName, "异常事件处理信", szMessage_Login, 0, tItemList)
end
--]]

--[[
function NianPo20160624(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2016, 6, 27, 7, 0, 0)
	local nEndTime = DateToTime(2016, 9, 27, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.NIANPO_20160624}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.NIANPO_20160624, true)
end

tActivityRecall[ACTIVITY_MANAGER.NIANPO_20160624] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.NIANPO_20160624] then
		return
	end

	if dwPlayerID ~= tActivityRosterList[ACTIVITY_MANAGER.NIANPO_20160624][0] then
		return
	end

	player.AddBuff(player.dwID, player.nLevel, 10863, 1, 30)
	player.SendSystemMessage("你因阵营大战之时消极怠工，对阵营造成极其恶劣影响，特禁止参与据点战和攻防战一个月！")
end
--]]
-------------------------------------------------JJC--------------------------------------------------------------------
-- 竞技场赛季奖励 2017.5.4
function JJC_Reward_20170504(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return  -- 只在国内版本（金山&盛大）做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2017, 5, 4, 0, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2017, 11, 4, 0, 0, 0)  -- 暂定处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_REWARD_2V2_20170504}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_REWARD_2V2_20170504, true)

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_REWARD_3V3_20170504}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_REWARD_3V3_20170504, true)

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_REWARD_5V5_20170504}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_REWARD_5V5_20170504, true)
end
-----------------------------------2v2---------------------------------------------------------------------------------
tActivityRecall[ACTIVITY_MANAGER.JJC_REWARD_2V2_20170504] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_2V2_20170504] then
		return
	end

	local nPersonalScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_2V2_20170504][0]
	local nTeamScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_2V2_20170504][1]
	local nTeamRank = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_2V2_20170504][2]

	local szMailText = string.format(
		GetEditorString(6, 5039) ..
		GetEditorString(4, 6170) ..
		GetEditorString(11, 1823) ..
		GetEditorString(6, 5041) ..
		GetEditorString(4, 6173) ..
		GetEditorString(4, 6174) ..
		GetEditorString(4, 6175) ..
		GetEditorString(4, 6167),
		szPlayerName, nTeamScore, nTeamRank, nPersonalScore
	)

	local nGrade = 1
	local tItem = {
		[1] = {{5, 28437, 1, 0}, {8, 19431, 1, 0}, {8, 19432, 1, 0}},
		[2] = {{5, 28438, 1, 0}, {8, 19431, 1, 0}, {8, 19432, 1, 0}},
		[3] = {{5, 28439, 1, 0}, {8, 19432, 1, 0}},
	}

	if nTeamRank <= 3 then
		nGrade = 1
	elseif nTeamRank <= 50 then
		nGrade = 2
	else
		nGrade = 3
	end

	if not tItem[nGrade] then
		return
	end

	SendSystemMail(GetEditorString(4, 5837), player.szName, GetEditorString(4, 6176), szMailText, 0, tItem[nGrade])
end
-----------------------------------3v3---------------------------------------------------------------------------------
tActivityRecall[ACTIVITY_MANAGER.JJC_REWARD_3V3_20170504] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_3V3_20170504] then
		return
	end

	local nPersonalScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_3V3_20170504][0]
	local nTeamScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_3V3_20170504][1]
	local nTeamRank = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_3V3_20170504][2]

	local szMailText = string.format(
		GetEditorString(6, 5039) ..
		GetEditorString(4, 6177) ..
		GetEditorString(11, 1823) ..
		GetEditorString(6, 5041) ..
		GetEditorString(4, 6173) ..
		GetEditorString(4, 6174) ..
		GetEditorString(4, 6175) ..
		GetEditorString(4, 6167),
		szPlayerName, nTeamScore, nTeamRank, nPersonalScore
	)

	local nGrade = 1
	local tItem = {
		[1] = {{5, 28437, 1, 0}, {8, 19431, 1, 0}, {8, 19432, 1, 0}},
		[2] = {{5, 28438, 1, 0}, {8, 19431, 1, 0}, {8, 19432, 1, 0}},
		[3] = {{5, 28439, 1, 0}, {8, 19432, 1, 0}},
	}

	if nTeamRank <= 3 then
		nGrade = 1
	elseif nTeamRank <= 50 then
		nGrade = 2
	else
		nGrade = 3
	end

	if not tItem[nGrade] then
		return
	end

	SendSystemMail(GetEditorString(4, 5837), player.szName, GetEditorString(4, 6176), szMailText, 0, tItem[nGrade])
end
-----------------------------------5v5---------------------------------------------------------------------------------
tActivityRecall[ACTIVITY_MANAGER.JJC_REWARD_5V5_20170504] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_5V5_20170504] then
		return
	end

	local nPersonalScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_5V5_20170504][0]
	local nTeamScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_5V5_20170504][1]
	local nTeamRank = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_5V5_20170504][2]

	local szMailText = string.format(
		GetEditorString(6, 5039) ..
		GetEditorString(4, 6178) ..
		GetEditorString(11, 1823) ..
		GetEditorString(6, 5041) ..
		GetEditorString(4, 6173) ..
		GetEditorString(4, 6174) ..
		GetEditorString(4, 6175) ..
		GetEditorString(4, 6167),
		szPlayerName, nTeamScore, nTeamRank, nPersonalScore
	)

	local nGrade = 1
	local tItem = {
		[1] = {{5, 28437, 1, 0}, {8, 19431, 1, 0}, {8, 19432, 1, 0}},
		[2] = {{5, 28438, 1, 0}, {8, 19431, 1, 0}, {8, 19432, 1, 0}},
		[3] = {{5, 28439, 1, 0}, {8, 19432, 1, 0}},
	}

	if nTeamRank <= 3 then
		nGrade = 1
	elseif nTeamRank <= 50 then
		nGrade = 2
	else
		nGrade = 3
	end

	if not tItem[nGrade] then
		return
	end

	SendSystemMail(GetEditorString(4, 5837), player.szName, GetEditorString(4, 6176), szMailText, 0, tItem[nGrade])
end

-- 竞技场赛季奖励 2016.10.27 补发正确的挂件奖励
--[[
function JJC_GUAJIANCOMPENSATE_20161027(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return  -- 只在国内版本（金山&盛大）做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2016, 10, 27, 0, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2017, 4, 27, 0, 0, 0)  -- 暂定处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_GUAJIANCOMPENSATE_20161027}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_GUAJIANCOMPENSATE_20161027, false)

end
tActivityRecall[ACTIVITY_MANAGER.JJC_GUAJIANCOMPENSATE_20161027] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_GUAJIANCOMPENSATE_20161027] then
		return
	end

	local SrcItemID = 0
	local DesItemID = 0
	if player.GetItemAmountInAllPackages(8, 19112) >= 1 or player.IsPendentExist(19112) then
		SrcItemID = 19112
		DesItemID = 19113
	end

	if SrcItemID == 0 then
		return
	end

	local nGrade = 1
	local tItem = {}
	local nItemNum = player.GetItemAmountInAllPackages(8, SrcItemID)
	if nItemNum > 0 then
		player.CostItemInAllPackage(8, SrcItemID, nItemNum)
	end
	if player.IsPendentExist(19112) then
		player.RemovePendent(19112)
	end

	tItem[1] = {{8, DesItemID, 1, 0}}
	if not tItem[nGrade] then
		return
	end

	local szMailText = string.format(
		"%s：\n　　见信好！\n　　前段时日异象突发，导致少侠在上届名剑大会获得的挂件奖励出现异常，深感抱歉。" ..
		"\n　　我们特为您补发正确的挂件奖励。" ..
		"\n　　预祝您在新的名剑大会赛季中战无不胜！ " ..
		"\n\n　　《剑网3》运营团队",
		szPlayerName
	)

	SendSystemMail("《剑网3》运营团队", player.szName, "上届名剑大会赛季排名说明", szMailText, 0, tItem[nGrade])

	-- tActivityIndexList = {ACTIVITY_MANAGER.JJC_GUAJIANCOMPENSATE_20161027}
	-- ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_GUAJIANCOMPENSATE_20161027, true, true)
end
--]]

-------------------------------------------------JJC 20161027竞技场赛季前200的漏发、改名、转服的补发奖励 --------------------------------------------------------------------
-- 20161027竞技场赛季前200的漏发、改名、转服的补发奖励
--[[
function JJC_Repair_20161027(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return  -- 只在国内版本（金山&盛大）做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2016, 10, 27, 0, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2017, 4, 27, 0, 0, 0)  -- 暂定处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_REPAIR_2V2_20161027}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_REPAIR_2V2_20161027, true)

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_REPAIR_3V3_20161027}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_REPAIR_3V3_20161027, true)

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_REPAIR_5V5_20161027}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_REPAIR_5V5_20161027, true)
end
-----------------------------------2v2---------------------------------------------------------------------------------
tActivityRecall[ACTIVITY_MANAGER.JJC_REPAIR_2V2_20161027] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_REPAIR_2V2_20161027] then
		return
	end

	local nPersonalScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REPAIR_2V2_20161027][0]
	local nTeamScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REPAIR_2V2_20161027][1]
	local nTeamRank = tActivityRosterList[ACTIVITY_MANAGER.JJC_REPAIR_2V2_20161027][2]

	local szMailText = string.format(
		"　　倚剑狂歌战九州，抹刀不舞定江湖！" ..
		"\n　　恭喜您，【%s】大侠！您的战队在上届名剑大会2对2战中，以%d点积分取得了第%d名的优秀战绩，" ..
		"其中您的个人贡献点为%d（队伍积分与个人贡献点之差不大于200的队伍成员才能获得奖励）。" ..
		"\n　　我们特为您发放上届名剑大会赛季排名奖励。" ..
		"\n　　为了给广大侠士提供一个健康公平的游戏环境，此次排名排除了所有在赛季期间利用非法手段不公平竞技的角色排名。" ..
		"让我们共同努力，为维护游戏公平竞技不懈努力！" ..
		"\n　　预祝您在新的名剑大会赛季中战无不胜！ " ..
		"\n\n　　《剑网3》运营团队",
		szPlayerName, nTeamScore, nTeamRank, nPersonalScore
	)

	local nGrade = 1
	local tItem = {
		[1] = {{5, 27576, 1, 0}, {8, 19112, 1, 0}, {8, 19113, 1, 0}},
		[2] = {{5, 27577, 1, 0}, {8, 19112, 1, 0}, {8, 19113, 1, 0}},
		[3] = {{5, 27578, 1, 0}, {8, 19113, 1, 0}},
	}

	if nTeamRank <= 3 then
		nGrade = 1
	elseif nTeamRank <= 50 then
		nGrade = 2
	else
		nGrade = 3
	end

	if not tItem[nGrade] then
		return
	end

	SendSystemMail("《剑网3》运营团队", player.szName, "上届名剑大会赛季排名说明", szMailText, 0, tItem[nGrade])
end
-----------------------------------3v3---------------------------------------------------------------------------------
tActivityRecall[ACTIVITY_MANAGER.JJC_REPAIR_3V3_20161027] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_REPAIR_3V3_20161027] then
		return
	end

	local nPersonalScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REPAIR_3V3_20161027][0]
	local nTeamScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REPAIR_3V3_20161027][1]
	local nTeamRank = tActivityRosterList[ACTIVITY_MANAGER.JJC_REPAIR_3V3_20161027][2]

	local szMailText = string.format(
		"　　倚剑狂歌战九州，抹刀不舞定江湖！" ..
		"\n　　恭喜您，【%s】大侠！您的战队在上届名剑大会3对3战中，以%d点积分取得了第%d名的优秀战绩，" ..
		"其中您的个人贡献点为%d（队伍积分与个人贡献点之差不大于200的队伍成员才能获得奖励）。" ..
		"\n　　我们特为您发放上届名剑大会赛季排名奖励。" ..
		"\n　　为了给广大侠士提供一个健康公平的游戏环境，此次排名排除了所有在赛季期间利用非法手段不公平竞技的角色排名。" ..
		"让我们共同努力，为维护游戏公平竞技不懈努力！" ..
		"\n　　预祝您在新的名剑大会赛季中战无不胜！ " ..
		"\n\n　　《剑网3》运营团队",
		szPlayerName, nTeamScore, nTeamRank, nPersonalScore
	)

	local nGrade = 1
	local tItem = {
		[1] = {{5, 27576, 1, 0}, {8, 19112, 1, 0}, {8, 19113, 1, 0}},
		[2] = {{5, 27577, 1, 0}, {8, 19112, 1, 0}, {8, 19113, 1, 0}},
		[3] = {{5, 27578, 1, 0}, {8, 19113, 1, 0}},
	}

	if nTeamRank <= 3 then
		nGrade = 1
	elseif nTeamRank <= 50 then
		nGrade = 2
	else
		nGrade = 3
	end

	if not tItem[nGrade] then
		return
	end

	SendSystemMail("《剑网3》运营团队", player.szName, "上届名剑大会赛季排名说明", szMailText, 0, tItem[nGrade])
end
-----------------------------------5v5---------------------------------------------------------------------------------
tActivityRecall[ACTIVITY_MANAGER.JJC_REPAIR_5V5_20161027] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_REPAIR_5V5_20161027] then
		return
	end

	local nPersonalScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REPAIR_5V5_20161027][0]
	local nTeamScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REPAIR_5V5_20161027][1]
	local nTeamRank = tActivityRosterList[ACTIVITY_MANAGER.JJC_REPAIR_5V5_20161027][2]

	local szMailText = string.format(
		"　　倚剑狂歌战九州，抹刀不舞定江湖！" ..
		"\n　　恭喜您，【%s】大侠！您的战队在上届名剑大会5对5战中，以%d点积分取得了第%d名的优秀战绩，" ..
		"其中您的个人贡献点为%d（队伍积分与个人贡献点之差不大于200的队伍成员才能获得奖励）。" ..
		"\n　　我们特为您发放上届名剑大会赛季排名奖励。" ..
		"\n　　为了给广大侠士提供一个健康公平的游戏环境，此次排名排除了所有在赛季期间利用非法手段不公平竞技的角色排名。" ..
		"让我们共同努力，为维护游戏公平竞技不懈努力！" ..
		"\n　　预祝您在新的名剑大会赛季中战无不胜！ " ..
		"\n\n　　《剑网3》运营团队",
		szPlayerName, nTeamScore, nTeamRank, nPersonalScore
	)

	local nGrade = 1
	local tItem = {
		[1] = {{5, 27576, 1, 0}, {8, 19112, 1, 0}, {8, 19113, 1, 0}},
		[2] = {{5, 27577, 1, 0}, {8, 19112, 1, 0}, {8, 19113, 1, 0}},
		[3] = {{5, 27578, 1, 0}, {8, 19113, 1, 0}},
	}

	if nTeamRank <= 3 then
		nGrade = 1
	elseif nTeamRank <= 50 then
		nGrade = 2
	else
		nGrade = 3
	end

	if not tItem[nGrade] then
		return
	end

	SendSystemMail("《剑网3》运营团队", player.szName, "上届名剑大会赛季排名说明", szMailText, 0, tItem[nGrade])
end

function Shop_Repair_20161208(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return  -- 只在国内版本做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2016, 12, 8, 4, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2017, 3, 1, 0, 0, 0)  -- 暂定处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end

	tActivityIndexList = {ACTIVITY_MANAGER.SHOP_REPAIR_20161208}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.SHOP_REPAIR_20161208, true)
end
---------
tActivityRecall[ACTIVITY_MANAGER.SHOP_REPAIR_20161208] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.SHOP_REPAIR_20161208] then
		return
	end

    local nGoldRepair = tActivityRosterList[ACTIVITY_MANAGER.SHOP_REPAIR_20161208][0]

	local szMailText = string.format(
		player.szName .. "\n　　见信好！\n　　近日部分奸商未按规定降低商品价格，导致侠士购买的商品价格偏高。现这批商品价格已被官府勒令整改，特将装备差价返还给侠士，请注意查收。\n\n      隐元会敬上"
	)
	SendSystemMail("隐元会", player.szName, "装备降价异常金币补偿", szMailText,nGoldRepair*10000)
end
--]]
--[[
function JDZD_REPAIR_20161214(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return  -- 只在国内版本做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2016, 12, 15, 4, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2016, 12, 22, 0, 0, 0)  -- 暂定处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JDZD_REPAIR_20161214}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JDZD_REPAIR_20161214, true)
end

tActivityRecall[ACTIVITY_MANAGER.JDZD_REPAIR_20161214] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JDZD_REPAIR_20161214] then
		return
	end

	local szMailText = string.format(
		player.szName .. "\n　　见信好！\n　　前段时日异象突发，据点争夺出现异常，导致少侠无法尽情阵营之战，深感抱歉。隐元会特呈礼品一份，聊表歉意，请查收\n\n      隐元会敬上"
	)
	SendSystemMail("隐元会执掌使", player.szName, "异常事件致歉信", szMailText, 0, ITEM_TABLE_TYPE.OTHER, 26015, 1)
end
--]]
--[[
function JDZD_REPAIR_20170106(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return  -- 只在国内版本做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2017, 1, 9, 7, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2017, 1, 16, 7, 0, 0)  -- 暂定处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JDZD_REPAIR_20170106}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JDZD_REPAIR_20170106, true)
end

tActivityRecall[ACTIVITY_MANAGER.JDZD_REPAIR_20170106] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JDZD_REPAIR_20170106] then
		return
	end

	local tItemList = {
		{5, 24825, 20, 0}, -- 10000不占周上限的威望
		{5, 24804, 50, 0}, -- 5000战阶
	}

	local szMailText = string.format(
		player.szName .. "\n　　见信好！\n　　前段时日异象突发，阵营攻防战出现异常，导致少侠无法尽情阵营之战，深感抱歉。隐元会特呈礼品一份，聊表歉意，请查收\n\n      隐元会敬上"
	)
	SendSystemMail("隐元会执掌使", player.szName, "异常事件致歉信", szMailText, 0, tItemList)
end
--]]
--[[
function JDZD_REPAIR_20170112(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return  -- 只在国内版本做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2017, 1, 12, 7, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2017, 1, 19, 7, 0, 0)  -- 暂定处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JDZD_REPAIR_20170112}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JDZD_REPAIR_20170112, true)
end

tActivityRecall[ACTIVITY_MANAGER.JDZD_REPAIR_20170112] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JDZD_REPAIR_20170112] then
		return
	end

	local tItemList = {
		{5, 24825, 20, 0}, -- 10000不占周上限的威望
		{5, 24804, 50, 0}, -- 5000战阶
	}

	local szMailText = string.format(
		player.szName .. "\n　　见信好！\n　　前段时日异象突发，阵营攻防战出现异常，导致少侠无法尽情阵营之战，深感抱歉。隐元会特呈礼品一份，聊表歉意，请查收\n\n      隐元会敬上"
	)
	SendSystemMail("隐元会执掌使", player.szName, "异常事件致歉信", szMailText, 0, tItemList)
end
--]]

function JJC_MJB_COST_RETRUN_20170505(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return  -- 只在国内版本做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2017, 5, 8, 7, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2017, 7, 20, 7, 0, 0)  -- 暂定处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_MJB_COST_RETRUN_20170505}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_MJB_COST_RETRUN_20170505, true)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_MJB_COST_RETRUN_20170505] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_MJB_COST_RETRUN_20170505] then
		return
	end
	local tJJCLevelUpAward = {
		{ nCoin = 100, tItem = {{5, 24838, 1, 0}, {5, 24445, 3, 0},{5, 24444, 3, 0}}},
		{ nCoin = 200, tItem = {{5, 24838, 2, 0}, {5, 24445, 5, 0}}},
		{ nCoin = 300, tItem = {{5, 24838, 3, 0}, {5, 24446, 1, 0},{5, 24445, 2, 0}}},
		{ nCoin = 400, tItem = {{5, 24838, 4, 0},{5, 24446, 1, 0},{5, 24445, 4, 0}}},
		{ nCoin = 500, tItem = {{5, 24838, 5, 0},{5, 24446, 2, 0},{5, 24445, 1, 0}}},
		{ nCoin = 700, tItem = {{5, 24838, 7, 0},{5, 24446, 2, 0},{5, 24445, 2, 0}}},
		{ nCoin = 900, tItem = {{5, 24838, 9, 0},{5, 24446, 2, 0},{5, 24445, 3, 0}}},
		{ nCoin = 1200, tItem = {{5, 24838, 12, 0},{5, 24446, 2, 0},{5, 24445, 4, 0}}},
		{ nCoin = 1500, tItem = {{5, 24838, 15, 0},{5, 24446, 3, 0},{5, 24445, 1, 0}}},
		{ nCoin = 1800, tItem = {{5, 24838, 18, 0},{5, 24446, 3, 0},{5, 24445, 2, 0}}},
		{ nCoin = 2100, tItem = {{5, 24838, 21, 0}, {5, 24446, 3, 0}, {5, 24445, 4, 0}}},
		{ nCoin = 2600, tItem = {{5, 24838, 26, 0},{5, 24446, 3, 0},{5, 24445, 5, 0}}},
	}
	local nGotLevel = 0
	local nIdx = 1
	local nAreanCoin = 0 -- 拖欠的名剑币
	local tGotLevel = {}

	tGotLevel[1] = player.GetCustomUnsigned1(PLAYER_CUSTOM_VALUE.PLAYER_JJC_LEVEL_AWARD_2V2)
	tGotLevel[2] = player.GetCustomUnsigned1(PLAYER_CUSTOM_VALUE.PLAYER_JJC_LEVEL_AWARD_3V3)
	tGotLevel[3] = player.GetCustomUnsigned1(PLAYER_CUSTOM_VALUE.PLAYER_JJC_LEVEL_AWARD_5V5)
	nGotLevel = tGotLevel[1]
	for i = 1 + 1, #tGotLevel do
		if tGotLevel[i] > nGotLevel then
			nIdx = i
			nGotLevel = tGotLevel[i]
		end
	end
	if nGotLevel == 0 then
		return
	end
	for i = 1, #tGotLevel do
		if nIdx ~= i then
			for j = 1, tGotLevel[i] do
				nAreanCoin = nAreanCoin + tJJCLevelUpAward[j].nCoin
			end
		end
	end
	nAreanCoin = nAreanCoin - tActivityRosterList[ACTIVITY_MANAGER.JJC_MJB_COST_RETRUN_20170505][0] 
	if nAreanCoin > 0 then
		local buff = player.GetBuff(11924, 1)
		local nAddCoin = nAreanCoin
		if buff and buff.nCustomValue > 0 then
			nAddCoin = math.max(nAreanCoin - buff.nCustomValue, 0)
			player.DelBuff(11924, 1)
		end
		if nAddCoin > 0 then
			player.AddArenaAwardRemainSpace(nAddCoin)
			player.AddArenaAward(nAddCoin, "201705_COST_RETRUN")
			local sz = GetEditorString(11, 6327) .. nAddCoin .. GetEditorString(11, 6319)
			player.SendSystemMessage(sz)
			SendSystemMail(GetEditorString(11, 6298), player.szName, GetEditorString(11, 6318), player.szName .. GetEditorString(11, 6299) .. sz .. GetEditorString(11, 6301), 0)
		end
		Log(string.format("[201705_COST_RETRUN]player:%d, nAddAreanCoin:%d, nCostCoin:%d", player.dwID, nAddCoin, tActivityRosterList[ACTIVITY_MANAGER.JJC_MJB_COST_RETRUN_20170505][0]))
	end
end

function JJC_MJB_COST_20170428(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return  -- 只在国内版本做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2017, 4, 29, 7, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2017, 7, 20, 7, 0, 0)  -- 暂定处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_MJB_COST_20170428}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_MJB_COST_20170428, true)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_MJB_COST_20170428] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_MJB_COST_20170428] then
		return
	end
	if player.GetBuff(11924, 1) then
		return
	end
	
	local tJJCLevelUpAward = {
		{ nCoin = 100, tItem = {{5, 24838, 1, 0}, {5, 24445, 3, 0},{5, 24444, 3, 0}}},
		{ nCoin = 200, tItem = {{5, 24838, 2, 0}, {5, 24445, 5, 0}}},
		{ nCoin = 300, tItem = {{5, 24838, 3, 0}, {5, 24446, 1, 0},{5, 24445, 2, 0}}},
		{ nCoin = 400, tItem = {{5, 24838, 4, 0},{5, 24446, 1, 0},{5, 24445, 4, 0}}},
		{ nCoin = 500, tItem = {{5, 24838, 5, 0},{5, 24446, 2, 0},{5, 24445, 1, 0}}},
		{ nCoin = 700, tItem = {{5, 24838, 7, 0},{5, 24446, 2, 0},{5, 24445, 2, 0}}},
		{ nCoin = 900, tItem = {{5, 24838, 9, 0},{5, 24446, 2, 0},{5, 24445, 3, 0}}},
		{ nCoin = 1200, tItem = {{5, 24838, 12, 0},{5, 24446, 2, 0},{5, 24445, 4, 0}}},
		{ nCoin = 1500, tItem = {{5, 24838, 15, 0},{5, 24446, 3, 0},{5, 24445, 1, 0}}},
		{ nCoin = 1800, tItem = {{5, 24838, 18, 0},{5, 24446, 3, 0},{5, 24445, 2, 0}}},
		{ nCoin = 2100, tItem = {{5, 24838, 21, 0}, {5, 24446, 3, 0}, {5, 24445, 4, 0}}},
		{ nCoin = 2600, tItem = {{5, 24838, 26, 0},{5, 24446, 3, 0},{5, 24445, 5, 0}}},
	}
	local nGotLevel = 0
	local nIdx = 1
	local nAreanCoin = 0 -- 拖欠的名剑币
	local tGotLevel = {}

	tGotLevel[1] = player.GetCustomUnsigned1(PLAYER_CUSTOM_VALUE.PLAYER_JJC_LEVEL_AWARD_2V2)
	tGotLevel[2] = player.GetCustomUnsigned1(PLAYER_CUSTOM_VALUE.PLAYER_JJC_LEVEL_AWARD_3V3)
	tGotLevel[3] = player.GetCustomUnsigned1(PLAYER_CUSTOM_VALUE.PLAYER_JJC_LEVEL_AWARD_5V5)
	nGotLevel = tGotLevel[1]
	for i = 1 + 1, #tGotLevel do
		if tGotLevel[i] > nGotLevel then
			nIdx = i
			nGotLevel = tGotLevel[i]
		end
	end
	if nGotLevel == 0 then
		return
	end
	for i = 1, #tGotLevel do
		if nIdx ~= i then
			for j = 1, tGotLevel[i] do
				nAreanCoin = nAreanCoin + tJJCLevelUpAward[j].nCoin
			end
		end
	end
	local nArenaCoin1 = nAreanCoin
	nAreanCoin = nAreanCoin - tActivityRosterList[ACTIVITY_MANAGER.JJC_MJB_COST_20170428][0]
	if nAreanCoin > 0 then
		player.AddBuff(0, 99, 11924, 1)
		local buff = player.GetBuff(11924, 1)
		buff.nCustomValue = nAreanCoin
		local sz = GetEditorString(11, 6294) .. nArenaCoin1 .. GetEditorString(11, 6311) .. tActivityRosterList[ACTIVITY_MANAGER.JJC_MJB_COST_20170428][0] .. GetEditorString(11, 6296)
					.. nAreanCoin .. GetEditorString(11, 6297)
		player.SendSystemMessage(sz)
		SendSystemMail(GetEditorString(11, 6298), player.szName, GetEditorString(11, 6312), player.szName .. GetEditorString(11, 6299) .. sz .. GetEditorString(11, 6313), 0)
	end
end

-- 2017年第八赛季非法宏与外挂封停计划
function JJC_Macros_Punishment_20170504(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2017, 4, 29, 7, 0, 0)
	local nEndTime = DateToTime(2017, 7, 20, 7, 0, 0)
	if nStartTime >= nTime or nTime >= nEndTime then
		return
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_MACROS_PUNISHMENT_20170504}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_MACROS_PUNISHMENT_20170504, true)
end

tActivityRecall[ACTIVITY_MANAGER.JJC_MACROS_PUNISHMENT_20170504] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end

	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_MACROS_PUNISHMENT_20170504] then
		return
	end

	-- 删除1060威望装备
	for _, v in pairs(ZHANJIE_EQUIPMENT_1060) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end
	-- 删除1140威望装备
	for _, v in pairs(ZHANJIE_EQUIPMENT_1140) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end
	-- 删除1060竞技场装备
	for _, v in pairs(JJC_EQUIPMENT_1060) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end
	-- 删除1140竞技场装备
	for _, v in pairs(JJC_EQUIPMENT_1140) do
		local nAmount = player.GetItemAmountInAllPackages(v[1], v[2])
		if nAmount > 0 then
			player.CostItemInAllPackage(v[1], v[2], nAmount)
		end
	end

	-- 清除威望
	local nPrestige = player.nCurrentPrestige
	player.AddPrestige( - nPrestige, "OTHER")
	
	-- 踢出名剑队伍
	for i = 0, 2 do
		GCCommand("SendGMCommondArenaServer(\"ForceDelMember('" .. player.dwCorpsSystemID .. "','" .. i .. "')\")")
	end

	local szMailText = GetEditorString(11, 6291) ..
	GetEditorString(11, 6284) ..
	GetEditorString(11, 6285)
	SendSystemMail(GetEditorString(2, 4611), szPlayerName, GetEditorString(11, 6292),	szPlayerName .. szMailText)
	player.SendSystemMessage(GetEditorString(11, 6293) ..
		GetEditorString(11, 6284)..GetEditorString(11, 6287)
	)
	Log(
		string.format(
		"[JJC_MACROS_PUNISHMENT_20170504]: PlayerName:%s, PlayerID:%d", player.szName, player.dwID
	)
	)
end

-- 竞技场赛季奖励因为转服，改名等发放失败补发 2017.5.4
function JJC_Repair_20170508(player)
	if not player then
		return
	end
	local GV = GetGameVersion()
	if not (GV and GV.VersionLineName == "zhcn") then
		return  -- 只在国内版本（金山&盛大）做处理
	end
	local nTime = GetCurrentTime()
	local nStartTime = DateToTime(2017, 5, 4, 0, 0, 0)  -- 处理开始时间
	local nEndTime = DateToTime(2017, 11, 4, 0, 0, 0)  -- 暂定处理结束时间
	if nStartTime >= nTime or nTime >= nEndTime then
		return  -- 时间限制
	end

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_REWARD_2V2_20170508}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_REWARD_2V2_20170508, true)

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_REWARD_3V3_20170508}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_REWARD_3V3_20170508, true)

	tActivityIndexList = {ACTIVITY_MANAGER.JJC_REWARD_5V5_20170508}
	ActivityRosterCheckRequest(player, tActivityIndexList, ACTIVITY_MANAGER.JJC_REWARD_5V5_20170508, true)
end
-----------------------------------2v2---------------------------------------------------------------------------------
tActivityRecall[ACTIVITY_MANAGER.JJC_REWARD_2V2_20170508] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_2V2_20170508] then
		return
	end

	local nPersonalScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_2V2_20170508][0]
	local nTeamScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_2V2_20170508][1]
	local nTeamRank = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_2V2_20170508][2]

	local szMailText = string.format(
		GetEditorString(6, 5039) ..
		GetEditorString(4, 6170) ..
		GetEditorString(11, 1823) ..
		GetEditorString(6, 5041) ..
		GetEditorString(4, 6173) ..
		GetEditorString(4, 6174) ..
		GetEditorString(4, 6175) ..
		GetEditorString(4, 6167),
		szPlayerName, nTeamScore, nTeamRank, nPersonalScore
	)

	local nGrade = 1
	local tItem = {
		[1] = {{5, 28437, 1, 0}, {8, 19431, 1, 0}, {8, 19432, 1, 0}},
		[2] = {{5, 28438, 1, 0}, {8, 19431, 1, 0}, {8, 19432, 1, 0}},
		[3] = {{5, 28439, 1, 0}, {8, 19432, 1, 0}},
	}

	if nTeamRank <= 3 then
		nGrade = 1
	elseif nTeamRank <= 50 then
		nGrade = 2
	else
		nGrade = 3
	end

	if not tItem[nGrade] then
		return
	end

	SendSystemMail(GetEditorString(4, 5837), player.szName, GetEditorString(4, 6176), szMailText, 0, tItem[nGrade])
end
-----------------------------------3v3---------------------------------------------------------------------------------
tActivityRecall[ACTIVITY_MANAGER.JJC_REWARD_3V3_20170508] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_3V3_20170508] then
		return
	end

	local nPersonalScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_3V3_20170508][0]
	local nTeamScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_3V3_20170508][1]
	local nTeamRank = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_3V3_20170508][2]

	local szMailText = string.format(
		GetEditorString(6, 5039) ..
		GetEditorString(4, 6177) ..
		GetEditorString(11, 1823) ..
		GetEditorString(6, 5041) ..
		GetEditorString(4, 6173) ..
		GetEditorString(4, 6174) ..
		GetEditorString(4, 6175) ..
		GetEditorString(4, 6167),
		szPlayerName, nTeamScore, nTeamRank, nPersonalScore
	)

	local nGrade = 1
	local tItem = {
		[1] = {{5, 28437, 1, 0}, {8, 19431, 1, 0}, {8, 19432, 1, 0}},
		[2] = {{5, 28438, 1, 0}, {8, 19431, 1, 0}, {8, 19432, 1, 0}},
		[3] = {{5, 28439, 1, 0}, {8, 19432, 1, 0}},
	}

	if nTeamRank <= 3 then
		nGrade = 1
	elseif nTeamRank <= 50 then
		nGrade = 2
	else
		nGrade = 3
	end

	if not tItem[nGrade] then
		return
	end

	SendSystemMail(GetEditorString(4, 5837), player.szName, GetEditorString(4, 6176), szMailText, 0, tItem[nGrade])
end
-----------------------------------5v5---------------------------------------------------------------------------------
tActivityRecall[ACTIVITY_MANAGER.JJC_REWARD_5V5_20170508] = function(dwPlayerID, szPlayerName, tActivityRosterList)
	local player = GetPlayer(dwPlayerID)
	if not player then
		return
	end
	if not tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_5V5_20170508] then
		return
	end

	local nPersonalScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_5V5_20170508][0]
	local nTeamScore = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_5V5_20170508][1]
	local nTeamRank = tActivityRosterList[ACTIVITY_MANAGER.JJC_REWARD_5V5_20170508][2]

	local szMailText = string.format(
		GetEditorString(6, 5039) ..
		GetEditorString(4, 6178) ..
		GetEditorString(11, 1823) ..
		GetEditorString(6, 5041) ..
		GetEditorString(4, 6173) ..
		GetEditorString(4, 6174) ..
		GetEditorString(4, 6175) ..
		GetEditorString(4, 6167),
		szPlayerName, nTeamScore, nTeamRank, nPersonalScore
	)

	local nGrade = 1
	local tItem = {
		[1] = {{5, 28437, 1, 0}, {8, 19431, 1, 0}, {8, 19432, 1, 0}},
		[2] = {{5, 28438, 1, 0}, {8, 19431, 1, 0}, {8, 19432, 1, 0}},
		[3] = {{5, 28439, 1, 0}, {8, 19432, 1, 0}},
	}

	if nTeamRank <= 3 then
		nGrade = 1
	elseif nTeamRank <= 50 then
		nGrade = 2
	else
		nGrade = 3
	end

	if not tItem[nGrade] then
		return
	end

	SendSystemMail(GetEditorString(4, 5837), player.szName, GetEditorString(4, 6176), szMailText, 0, tItem[nGrade])
end
 -- by 每天涨停@梦江南 $ Jx3UnPack-PAKV3 jx3.mail@gmail.com